// ==UserScript==
// @name               Booth ItemPage Enhancer
// @name:zh-CN         Booth 商品页面增强
// @namespace          yueby.booth
// @version            0.1.15
// @author             Yueby
// @description        A userscript for enhancing Booth item page experience
// @description:zh-CN  增强 Booth 商品页面的功能体验，包括变体序号、标签管理、自动翻译等功能
// @icon               ./src/assets/icon.png
// @match              https://manage.booth.pm/items*
// @require            https://cdn.jsdelivr.net/npm/vue@3.5.18/dist/vue.global.prod.js
// @require            https://cdn.jsdelivr.net/npm/systemjs@6.15.1/dist/system.min.js
// @require            https://cdn.jsdelivr.net/npm/systemjs@6.15.1/dist/extras/named-register.min.js
// @require            data:application/javascript,%3B(typeof%20System!%3D'undefined')%26%26(System%3Dnew%20System.constructor())%3B
// @connect            raw.githubusercontent.com
// @grant              GM_addStyle
// @grant              GM_getValue
// @grant              GM_notification
// @grant              GM_registerMenuCommand
// @grant              GM_setClipboard
// @grant              GM_setValue
// @grant              GM_xmlhttpRequest
// ==/UserScript==

(e=>{if(typeof GM_addStyle=="function"){GM_addStyle(e);return}const t=document.createElement("style");t.textContent=e,document.head.append(t)})(` .menu-fade-enter-active[data-v-4d60a255]{transition:opacity .15s ease-out,transform .15s ease-out}.menu-fade-leave-active[data-v-4d60a255]{transition:opacity .1s ease-in,transform .1s ease-in}.menu-fade-enter-from[data-v-4d60a255]{opacity:0;transform:scale(.95) translateY(-4px)}.menu-fade-leave-to[data-v-4d60a255]{opacity:0;transform:scale(.95)}.context-menu[data-v-4d60a255]{position:fixed;background:#fff;border:1px solid #e5e7eb;border-radius:6px;box-shadow:0 4px 12px #00000026;z-index:10000;min-width:140px;overflow:hidden;padding:4px 0;transform-origin:top left}.context-menu.no-transition[data-v-4d60a255]{transition:none!important}.menu-item[data-v-4d60a255]{padding:8px 16px;cursor:pointer;transition:all .15s ease;font-size:12px;color:#374151;display:flex;align-items:center;gap:8px}.menu-item[data-v-4d60a255]:hover{background:#f3f4f6}.menu-item-danger[data-v-4d60a255]{color:#ef4444}.menu-item-danger[data-v-4d60a255]:hover{background:#fef2f2}.menu-item-disabled[data-v-4d60a255]{opacity:.5;cursor:not-allowed;pointer-events:none}.menu-icon[data-v-4d60a255]{display:flex;align-items:center;justify-content:center;color:#6b7280;flex-shrink:0}.menu-item-danger .menu-icon[data-v-4d60a255]{color:#ef4444}.menu-icon[data-v-4d60a255] svg{width:14px;height:14px}.menu-label[data-v-4d60a255]{flex:1}.menu-separator[data-v-4d60a255]{height:1px;background:#e5e7eb;margin:4px 0}.file-selector[data-v-43c71f00]{width:100%}.file-grid[data-v-43c71f00]{display:grid;gap:8px;overflow-y:auto;padding:8px;border:1px solid var(--be-color-border);border-radius:var(--be-radius-sm)}.file-item[data-v-43c71f00]{padding:6px 8px;transition:all .15s ease;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.file-item[data-v-43c71f00]:hover{transform:translateY(-1px)}.file-item.is-selected[data-v-43c71f00]{background-color:#3b82f61a;border-color:#3b82f64d}.icon-btn[data-v-996dd7d2]{width:32px;height:32px;display:flex;align-items:center;justify-content:center;border:1px solid transparent;background:transparent;color:#64748b;border-radius:6px;cursor:pointer;transition:all .15s ease;padding:0}.icon-btn[data-v-996dd7d2] svg{width:18px;height:18px;stroke-width:2}.icon-btn[data-v-996dd7d2]:hover{background:#f1f5f9;color:#475569;border-color:#e2e8f0;transform:translateY(-1px)}.icon-btn[data-v-996dd7d2]:active{transform:translateY(1px)}.icon-btn.variant-danger[data-v-996dd7d2]{color:#64748b}.icon-btn.variant-danger[data-v-996dd7d2]:hover{background:#fef2f2;color:#ef4444;border-color:#fee2e2}.modal-overlay[data-v-db693591]{position:fixed;top:0;right:0;bottom:0;left:0;background:#00000080;display:flex;align-items:flex-end;justify-content:center;z-index:10000;padding:0;-webkit-backdrop-filter:blur(2px);backdrop-filter:blur(2px)}.modal-overlay.modal-in-sidebar[data-v-db693591]{position:absolute;z-index:2000}.modal-container[data-v-db693591]{background:#fff;border-radius:16px 16px 0 0;box-shadow:0 10px 25px #0003;width:100%;max-width:500px;max-height:70vh;display:flex;flex-direction:column;overflow:hidden}.modal-overlay.modal-in-sidebar .modal-container[data-v-db693591]{max-height:70%}.modal-header[data-v-db693591]{padding:10px 12px;border-bottom:1px solid #e5e7eb;display:flex;align-items:center;justify-content:space-between;flex-shrink:0;background:#f8fafc}.modal-title[data-v-db693591]{margin:0;font-size:14px;font-weight:600;color:#374151}.modal-header-actions[data-v-db693591]{display:flex;align-items:center;gap:4px}.modal-header .booth-btn[data-v-db693591] svg{width:18px;height:18px;stroke-width:2}.modal-body[data-v-db693591]{padding:8px;overflow-y:auto;flex:1;min-height:0;color:#374151}.modal-footer[data-v-db693591]{padding:10px 12px;border-top:1px solid #e5e7eb;display:grid;grid-auto-flow:column;grid-auto-columns:1fr;gap:8px;flex-shrink:0;background:#f8fafc}.modal-body[data-v-db693591] .section-header-container{padding-left:0!important;padding-right:0!important}.modal-footer .booth-btn[data-v-db693591]{width:100%}.modal-enter-active[data-v-db693591],.modal-leave-active[data-v-db693591]{transition:opacity .3s ease}.modal-enter-active .modal-container[data-v-db693591],.modal-leave-active .modal-container[data-v-db693591]{transition:transform .3s ease}.modal-enter-from[data-v-db693591],.modal-leave-to[data-v-db693591]{opacity:0}.modal-enter-from .modal-container[data-v-db693591],.modal-leave-to .modal-container[data-v-db693591]{transform:translateY(100%)}.modal-body[data-v-db693591]::-webkit-scrollbar{width:6px}.modal-body[data-v-db693591]::-webkit-scrollbar-track{background:#f5f5f5}.modal-body[data-v-db693591]::-webkit-scrollbar-thumb{background:#ccc;border-radius:3px}.modal-body[data-v-db693591]::-webkit-scrollbar-thumb:hover{background:#999}.preview-box[data-v-93d09832]{padding:var(--be-space-sm);background:var(--be-color-bg-secondary);border:1px solid var(--be-color-border);border-radius:var(--be-radius-sm)}.preview-box pre[data-v-93d09832]{font-family:inherit;font-size:inherit;line-height:inherit}.section-header-container[data-v-5643104c]{padding:var(--be-space-sm);padding-bottom:8px;border-bottom:1px solid var(--be-color-border)}.section-header-container.no-header[data-v-5643104c]{padding-bottom:var(--be-space-sm)}.section-header-container.no-border[data-v-5643104c]{border-bottom:none;padding-bottom:var(--be-space-sm)}.section-header[data-v-5643104c]{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px}.actions[data-v-5643104c]{display:flex;gap:var(--be-space-sm);flex-wrap:nowrap;align-items:center}.tab-bar[data-v-ee7eccb8]{display:flex;align-items:center;justify-content:space-between;padding:8px 16px;background:#f8fafc;border-bottom:1px solid #e5e7eb}.tab-list[data-v-ee7eccb8]{display:flex;gap:2px}.tab-btn[data-v-ee7eccb8]{padding:6px 12px;border:1px solid transparent;background:transparent;cursor:pointer;font-size:12px;color:#6b7280;border-radius:6px;transition:all .15s ease;display:flex;align-items:center;gap:6px;font-weight:500}.tab-btn[data-v-ee7eccb8]:hover:not(.active){background:#f3f4f6;color:#374151}.tab-btn.active[data-v-ee7eccb8]{background:#fff;color:#3b82f6;font-weight:600;box-shadow:0 1px 2px #00000014}.tab-icon[data-v-ee7eccb8]{display:flex;align-items:center;justify-content:center}.tab-icon[data-v-ee7eccb8] svg{width:13px;height:13px}.tab-label[data-v-ee7eccb8]{white-space:nowrap}.tab-actions[data-v-ee7eccb8]{display:flex;align-items:center;gap:4px}.template-selector[data-v-08bcafdd]{display:flex;flex-direction:column;gap:4px}.template-selector-label[data-v-08bcafdd]{font-size:var(--be-font-size-sm);font-weight:500;color:var(--be-color-text-primary)}.template-selector-select[data-v-08bcafdd]{width:100%}.tree-item[data-v-fbb1ef76]{-webkit-user-select:none;user-select:none}.tree-node-wrapper[data-v-fbb1ef76]{position:relative;transition:all .15s ease}.tree-node-wrapper[draggable=true][data-v-fbb1ef76]{cursor:move}.tree-node-wrapper[data-v-fbb1ef76]:active{cursor:grabbing}.tree-node-wrapper.drag-over-inside[data-v-fbb1ef76]{background:#eff6ff;border-radius:4px}.tree-node-wrapper.drag-over-inside[data-v-fbb1ef76]:before{content:"";position:absolute;left:0;right:0;top:0;bottom:0;border:2px solid #3b82f6;border-radius:4px;pointer-events:none;animation:pulse-fbb1ef76 1s ease-in-out infinite}@keyframes pulse-fbb1ef76{0%,to{opacity:1}50%{opacity:.5}}.drop-indicator[data-v-fbb1ef76]{position:relative;height:2px;margin:2px 0;pointer-events:none}.drop-indicator[data-v-fbb1ef76]:before{content:"";position:absolute;left:0;right:0;height:2px;background:#3b82f6;box-shadow:0 0 4px #3b82f680}.drop-indicator[data-v-fbb1ef76]:after{content:"";position:absolute;left:0;top:50%;transform:translateY(-50%);width:6px;height:6px;border-radius:50%;background:#3b82f6;box-shadow:0 0 4px #3b82f680}.node-item[data-v-fbb1ef76]{position:relative;border-bottom:1px solid rgba(0,0,0,.06);transition:background .15s ease;cursor:pointer}.node-item.is-editing[data-v-fbb1ef76]{cursor:default}.node-item[data-v-fbb1ef76]:not(.is-editing):after{content:"";position:absolute;top:0;left:0;right:0;bottom:0;background-color:transparent;pointer-events:none;transition:background-color .1s ease;z-index:1}.node-item[data-v-fbb1ef76]:not(.is-editing):hover:after{background-color:#0000000a}.node-item.selected[data-v-fbb1ef76]{background:#bfdbfe}.tree-node-content[data-v-fbb1ef76]{display:flex;align-items:center;padding:4px 8px;min-height:28px;cursor:inherit;transition:background .15s ease}.node-item.has-custom-content .tree-node-content[data-v-fbb1ef76]{padding-bottom:2px}.node-item.is-editing .tree-node-content[data-v-fbb1ef76]{cursor:default}.toggle-area[data-v-fbb1ef76]{display:flex;align-items:center;cursor:pointer;position:relative;z-index:2;transition:opacity .15s ease;margin-right:8px}.toggle-area[data-v-fbb1ef76]:hover{opacity:.7}.toggle-area .expand-icon[data-v-fbb1ef76]{margin-right:4px}.toggle-area .icon[data-v-fbb1ef76]{margin-right:0}.expand-icon[data-v-fbb1ef76]{display:flex;align-items:center;justify-content:center;width:16px;height:16px;margin-right:4px;color:#6b7280;flex-shrink:0;transition:transform .2s ease,opacity .15s ease;position:relative;z-index:2}.expand-icon.placeholder[data-v-fbb1ef76]{visibility:hidden;cursor:default}.node-item.is-editing .expand-icon[data-v-fbb1ef76]:not(.placeholder){cursor:pointer}.node-item.is-editing .expand-icon[data-v-fbb1ef76]:not(.placeholder):hover{opacity:.7}.expand-icon[data-v-fbb1ef76] svg{width:12px;height:12px}.icon[data-v-fbb1ef76]{display:flex;align-items:center;justify-content:center;width:16px;height:16px;margin-right:8px;flex-shrink:0;position:relative;z-index:2}.icon[data-v-fbb1ef76] svg{display:block;width:16px;height:16px;stroke-width:2}.node-custom-content[data-v-fbb1ef76]{padding-top:2px;padding-bottom:4px;padding-right:8px}.node-custom-content[data-v-fbb1ef76]:empty{display:none;padding:0}.node-item.is-editing .node-custom-content[data-v-fbb1ef76]{opacity:.6;pointer-events:none}.node-name-input[data-v-fbb1ef76]{flex:1;padding:2px 6px;border-radius:3px;font-size:13px;font-family:inherit;line-height:1.4}.name[data-v-fbb1ef76]{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:13px;color:#374151;line-height:1.4}.count[data-v-fbb1ef76]{font-size:11px;color:#9ca3af;margin-left:6px;font-weight:400}.node-header-extra[data-v-fbb1ef76]{margin-left:auto;display:flex;align-items:center;gap:8px}.tree-wrapper[data-v-b7665db9]{display:flex;flex-direction:column;height:100%;overflow:hidden}.tree-search[data-v-b7665db9]{display:flex;align-items:center;gap:8px;padding:8px 12px;background:#f8fafc;border-bottom:1px solid #e5e7eb;flex-shrink:0}.tree-toolbar[data-v-b7665db9]{padding:8px 12px;background:#f8fafc;border-bottom:1px solid #e5e7eb;display:flex;align-items:center;gap:8px;flex-shrink:0}.search-input[data-v-b7665db9]{flex:1;border:none;outline:none;background:transparent;font-size:12px;color:#374151}.tree-search-toolbar[data-v-b7665db9]{display:flex;align-items:center;gap:6px;margin-left:auto}.search-input[data-v-b7665db9]::placeholder{color:#9ca3af}.search-results[data-v-b7665db9]{flex:1;overflow-y:auto;min-height:0}.search-empty[data-v-b7665db9]{padding:40px 20px;text-align:center;color:#9ca3af;font-size:13px}.tree-toolbar[data-v-b7665db9]{padding:8px;border-bottom:1px solid #e0e0e0;display:flex;align-items:center;background:#fff;min-height:40px}.node-tree[data-v-b7665db9]{-webkit-user-select:none;user-select:none;flex:1;overflow-y:auto;min-height:0;position:relative}.tree-content[data-v-b7665db9]{position:relative;z-index:1}.empty-state[data-v-b7665db9]{padding:40px 20px;text-align:center;color:#94a3b8;font-size:13px;border:1px dashed #cbd5e1;border-radius:4px;margin:8px;transition:all .15s ease}.draggable-card-list[data-v-6cf94b77]{display:flex;flex-direction:column;gap:6px;padding:var(--be-space-sm);background:#00000005;border:1px solid var(--be-color-border);border-radius:var(--be-radius)}.draggable-card-list .draggable-card-list[data-v-6cf94b77]{background:transparent;border:none;padding:0}.draggable-card[data-v-6cf94b77]{padding:4px;background:var(--be-color-bg-secondary);border:1px solid var(--be-color-border);border-radius:var(--be-radius);cursor:move;transition:var(--be-transition-normal)}.draggable-card[data-v-6cf94b77]:hover{border-color:var(--be-color-border-hover);box-shadow:var(--be-shadow-sm)}.card-actions[data-v-6cf94b77]{display:flex;align-items:center;gap:var(--be-space-xs);padding:4px 0;border-bottom:1px solid var(--be-color-border);margin-bottom:4px;min-height:28px;flex-wrap:nowrap;overflow:hidden}.drag-handle[data-v-6cf94b77]{cursor:grab;color:var(--be-color-text-muted);flex-shrink:0;display:flex;align-items:center}.drag-handle[data-v-6cf94b77]:active{cursor:grabbing}.card-number[data-v-6cf94b77]{font-size:var(--be-font-size-sm);font-weight:600;color:var(--be-color-text-secondary);flex-shrink:0}.actions-content[data-v-6cf94b77]{flex:1;min-width:0;display:flex;align-items:center;gap:var(--be-space-xs);overflow:hidden}.card-content[data-v-6cf94b77]{display:flex;flex-direction:column;gap:var(--be-space-sm)}:root{--be-color-primary: #3b82f6;--be-color-primary-hover: #2563eb;--be-color-primary-active: #1d4ed8;--be-color-success: #10b981;--be-color-success-hover: #059669;--be-color-danger: #ef4444;--be-color-danger-hover: #dc2626;--be-color-warning: #f59e0b;--be-color-info: #3b82f6;--be-color-gray-50: #f8fafc;--be-color-gray-100: #f3f4f6;--be-color-gray-200: #e5e7eb;--be-color-gray-300: #d1d5db;--be-color-gray-400: #9ca3af;--be-color-gray-500: #6b7280;--be-color-gray-600: #4b5563;--be-color-gray-700: #374151;--be-color-gray-800: #1f2937;--be-color-gray-900: #111827;--be-color-text: #374151;--be-color-text-secondary: #6b7280;--be-color-text-muted: #9ca3af;--be-color-text-inverse: #ffffff;--be-color-bg: #ffffff;--be-color-bg-secondary: #f8fafc;--be-color-bg-tertiary: #f3f4f6;--be-color-bg-hover: #f9fafb;--be-color-bg-active: #f3f4f6;--be-color-border: #e5e7eb;--be-color-border-hover: #d1d5db;--be-color-border-light: #f3f4f6;--be-shadow-sm: 0 1px 2px rgba(0, 0, 0, .05);--be-shadow-md: 0 4px 6px rgba(0, 0, 0, .1);--be-shadow-lg: 0 10px 15px rgba(0, 0, 0, .1);--be-shadow-xl: 0 20px 25px rgba(0, 0, 0, .15);--be-space-xs: 4px;--be-space-sm: 8px;--be-space-md: 16px;--be-space-lg: 24px;--be-space-xl: 32px;--be-radius-sm: 4px;--be-radius: 6px;--be-radius-md: 8px;--be-radius-lg: 12px;--be-radius-xl: 16px;--be-radius-full: 9999px;--be-font-size-xs: 10px;--be-font-size-sm: 11px;--be-font-size-base: 12px;--be-font-size-md: 13px;--be-font-size-lg: 14px;--be-font-size-xl: 16px;--be-font-size-2xl: 18px;--be-transition-fast: .1s ease;--be-transition-normal: .15s ease;--be-transition-slow: .3s ease;--be-z-dropdown: 1000;--be-z-modal: 1500;--be-z-toast: 2000;--be-z-tooltip: 2500}.booth-enhancer-sidebar *{box-sizing:border-box}.booth-enhancer-sidebar input,.booth-enhancer-sidebar textarea,.booth-enhancer-sidebar select,.booth-enhancer-sidebar button{font-family:inherit}.booth-btn{display:inline-flex;align-items:center;justify-content:center;border:none;border-radius:6px;font-weight:500;cursor:pointer;transition:all .15s ease;text-decoration:none;white-space:nowrap;-webkit-user-select:none;user-select:none;position:relative;overflow:hidden;font-family:inherit;background:#f3f4f6;color:#374151;border:1px solid #d1d5db}.booth-btn:hover:not(:disabled){background:#e5e7eb;border-color:#9ca3af;transform:translateY(-1px)}.booth-btn:active:not(:disabled){background:#d1d5db;transform:translateY(1px)}.booth-btn:disabled{background:#f3f4f6;color:#9ca3af;cursor:not-allowed;box-shadow:none;opacity:.6}.booth-btn:disabled:hover{background:#f3f4f6;color:#9ca3af;box-shadow:none;transform:none}.booth-btn-sm{padding:4px 8px;font-size:11px;min-height:24px}.booth-btn-md{padding:6px 12px;font-size:12px;min-height:32px}.booth-btn-lg{padding:8px 16px;font-size:14px;min-height:40px}.booth-btn-primary{background:#3b82f6;color:#fff;box-shadow:0 1px 3px #3b82f64d;border:1px solid transparent}.booth-btn-primary:hover:not(:disabled){background:#2563eb;box-shadow:0 2px 4px #3b82f666}.booth-btn-primary:active:not(:disabled){background:#1d4ed8;transform:translateY(1px)}.booth-btn-secondary{background:#f3f4f6;color:#374151;border:1px solid #d1d5db}.booth-btn-secondary:hover:not(:disabled){background:#e5e7eb;border-color:#9ca3af}.booth-btn-secondary:active:not(:disabled){background:#d1d5db;transform:translateY(1px)}.booth-btn-success{background:#10b981;color:#fff;box-shadow:0 1px 3px #10b9814d;border:1px solid transparent}.booth-btn-success:hover:not(:disabled){background:#059669;box-shadow:0 2px 4px #10b98166}.booth-btn-success:active:not(:disabled){background:#047857;transform:translateY(1px)}.booth-btn-danger{background:#ef4444;color:#fff;box-shadow:0 1px 3px #ef44444d;border:1px solid transparent}.booth-btn-danger:hover:not(:disabled){background:#dc2626;box-shadow:0 2px 4px #ef444466}.booth-btn-danger:active:not(:disabled){background:#b91c1c;transform:translateY(1px)}.booth-btn-ghost{background:transparent;color:#64748b;border:1px solid transparent}.booth-btn-ghost:hover:not(:disabled){background:#f1f5f9;color:#475569;border-color:#e2e8f0}.booth-btn-ghost:active:not(:disabled){background:#e2e8f0;transform:translateY(1px)}.booth-btn-icon{padding:6px;min-width:32px;min-height:32px}.booth-btn-icon.booth-btn-sm{padding:4px;min-width:24px;min-height:24px}.booth-btn-icon.booth-btn-lg{padding:8px;min-width:40px;min-height:40px}.booth-btn:focus{outline:none;box-shadow:0 0 0 3px #3b82f61a}.booth-btn:focus:not(:focus-visible){box-shadow:none}.booth-btn-group{display:inline-flex;border-radius:6px;overflow:hidden;box-shadow:0 1px 2px #0000000d}.booth-btn-group .booth-btn{border-radius:0;border-right:1px solid rgba(255,255,255,.2)}.booth-btn-group .booth-btn:first-child{border-top-left-radius:6px;border-bottom-left-radius:6px}.booth-btn-group .booth-btn:last-child{border-top-right-radius:6px;border-bottom-right-radius:6px;border-right:none}.booth-btn-loading{position:relative;color:transparent}.booth-btn-loading:after{content:"";position:absolute;top:50%;left:50%;width:16px;height:16px;margin:-8px 0 0 -8px;border:2px solid transparent;border-top-color:currentColor;border-radius:50%;animation:booth-btn-spin .6s linear infinite}@keyframes booth-btn-spin{to{transform:rotate(360deg)}}.booth-toggle{display:flex;align-items:center;gap:12px;cursor:pointer;position:relative}.booth-toggle input[type=checkbox]{position:absolute;opacity:0;width:0;height:0}.booth-toggle .toggle-slider{position:relative;width:36px;height:20px;background:#d1d5db;border-radius:10px;transition:all .15s ease}.booth-toggle .toggle-slider:before{content:"";position:absolute;top:2px;left:2px;width:16px;height:16px;background:#fff;border-radius:50%;transition:transform .3s;box-shadow:0 2px 4px #0003}.booth-toggle input[type=checkbox]:checked+.toggle-slider{background:#3b82f6}.booth-toggle input[type=checkbox]:checked+.toggle-slider:before{transform:translate(16px)}.booth-toggle .toggle-label{font-size:14px;color:#374151;font-weight:400}.booth-toggle:hover .toggle-slider{background:#9ca3af;transform:translateY(-1px)}.booth-toggle:hover .toggle-label{color:#1f2937}.booth-toggle input[type=checkbox]:active+.toggle-slider{transform:translateY(1px)}.booth-toggle input[type=checkbox]:active+.toggle-slider:before{transform:translate(2px)}.booth-toggle input[type=checkbox]:checked:active+.toggle-slider:before{transform:translate(16px)}.booth-toggle-sm .toggle-slider{width:36px;height:20px}.booth-toggle-sm .toggle-slider:before{width:16px;height:16px}.booth-toggle-sm input[type=checkbox]:checked+.toggle-slider:before{transform:translate(16px)}.booth-toggle-lg .toggle-slider{width:52px;height:28px}.booth-toggle-lg .toggle-slider:before{width:24px;height:24px}.booth-toggle-lg input[type=checkbox]:checked+.toggle-slider:before{transform:translate(24px)}.booth-enhancer-sidebar input:not([type=checkbox]):not([type=radio]),.booth-enhancer-sidebar textarea,.booth-enhancer-sidebar select{width:100%;padding:6px 12px;margin:0;border:1px solid #d1d5db;border-radius:6px;font-size:12px;color:#374151;background:#fff;box-shadow:0 1px 2px #0000000d;outline:none;transition:all .15s ease;box-sizing:border-box;display:block;line-height:1.5;-webkit-appearance:none;-moz-appearance:none;appearance:none}.booth-enhancer-sidebar select{padding-right:32px;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 8px center;background-size:16px 16px}.booth-enhancer-sidebar input:not([type=checkbox]):not([type=radio]):hover,.booth-enhancer-sidebar textarea:hover,.booth-enhancer-sidebar select:hover{border-color:#9ca3af}.booth-enhancer-sidebar input:not([type=checkbox]):not([type=radio]):focus,.booth-enhancer-sidebar textarea:focus,.booth-enhancer-sidebar select:focus{border-color:#3b82f6;box-shadow:0 0 0 3px #3b82f61a}.booth-enhancer-sidebar input::placeholder,.booth-enhancer-sidebar textarea::placeholder{color:#9ca3af}.booth-enhancer-sidebar textarea{min-height:1.25em;resize:vertical}.modal-content{display:flex;flex-direction:column;gap:var(--be-space-sm)}.modal-content p{margin:0;line-height:1.6;color:#6b7280}.form-group{margin-bottom:var(--be-space-sm)}.form-group:last-child{margin-bottom:0}.form-group label{display:block;margin-bottom:4px;font-size:12px;font-weight:500;color:#374151}.form-group .required{color:#ef4444;margin-left:4px}.label-hint{font-size:var(--be-font-size-xs);color:var(--be-color-text-muted);font-weight:400;font-style:italic}.form-hint{margin:2px 0 0;font-size:var(--be-font-size-xs);color:var(--be-color-text-secondary)}.empty-hint{padding:var(--be-space-md);text-align:center;color:var(--be-color-text-secondary);font-size:var(--be-font-size-md);background:var(--be-color-bg-secondary);border-radius:var(--be-radius)}.hint-text{font-size:var(--be-font-size-base);color:var(--be-color-text-secondary)}.tab-nav{display:flex;gap:var(--be-space-xs);border-bottom:1px solid var(--be-color-border);margin-bottom:var(--be-space-sm)}.tab-btn{padding:var(--be-space-xs) var(--be-space-sm);font-size:var(--be-font-size-base);font-weight:500;color:var(--be-color-text-secondary);background:transparent;border:none;border-bottom:2px solid transparent;cursor:pointer;transition:var(--be-transition-normal)}.tab-btn:hover{color:var(--be-color-text);background:var(--be-color-bg-secondary)}.tab-btn.active{color:var(--be-color-primary);border-bottom-color:var(--be-color-primary)}.tab-content{flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:var(--be-space-sm)}.form-group input,.form-group textarea,.form-group select{width:100%;padding:6px 12px;border:1px solid #d1d5db;border-radius:6px;font-size:12px;color:#374151;background:#fff;box-shadow:0 1px 2px #0000000d;outline:none;box-sizing:border-box;line-height:1.5;transition:all .15s ease;-webkit-appearance:none;-moz-appearance:none;appearance:none}.form-group select{padding-right:32px;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 8px center;background-size:16px 16px}.form-group input:hover,.form-group textarea:hover,.form-group select:hover{border-color:#9ca3af}.form-group input:focus,.form-group textarea:focus,.form-group select:focus{border-color:#3b82f6;box-shadow:0 0 0 3px #3b82f61a}.form-group textarea{min-height:1.25em;resize:vertical}.booth-enhancer-sidebar ::-webkit-scrollbar{width:6px;height:6px}.booth-enhancer-sidebar ::-webkit-scrollbar-track{background:#f5f5f5;border-radius:3px}.booth-enhancer-sidebar ::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px}.booth-enhancer-sidebar ::-webkit-scrollbar-thumb:hover{background:#94a3b8}.be-m-0{margin:0!important}.be-mt-0{margin-top:0!important}.be-mr-0{margin-right:0!important}.be-mb-0{margin-bottom:0!important}.be-ml-0{margin-left:0!important}.be-m-xs{margin:var(--be-space-xs)!important}.be-m-sm{margin:var(--be-space-sm)!important}.be-m-md{margin:var(--be-space-md)!important}.be-m-lg{margin:var(--be-space-lg)!important}.be-p-0{padding:0!important}.be-pt-0{padding-top:0!important}.be-pr-0{padding-right:0!important}.be-pb-0{padding-bottom:0!important}.be-pl-0{padding-left:0!important}.be-p-xs{padding:var(--be-space-xs)!important}.be-p-sm{padding:var(--be-space-sm)!important}.be-p-md{padding:var(--be-space-md)!important}.be-p-lg{padding:var(--be-space-lg)!important}.be-px-xs{padding-left:var(--be-space-xs)!important;padding-right:var(--be-space-xs)!important}.be-px-sm{padding-left:var(--be-space-sm)!important;padding-right:var(--be-space-sm)!important}.be-px-md{padding-left:var(--be-space-md)!important;padding-right:var(--be-space-md)!important}.be-px-lg{padding-left:var(--be-space-lg)!important;padding-right:var(--be-space-lg)!important}.be-pt-xs{padding-top:var(--be-space-xs)!important}.be-pt-sm{padding-top:var(--be-space-sm)!important}.be-pt-md{padding-top:var(--be-space-md)!important}.be-pt-lg{padding-top:var(--be-space-lg)!important}.be-pb-xs{padding-bottom:var(--be-space-xs)!important}.be-pb-sm{padding-bottom:var(--be-space-sm)!important}.be-pb-md{padding-bottom:var(--be-space-md)!important}.be-pb-lg{padding-bottom:var(--be-space-lg)!important}.be-mb-xs{margin-bottom:var(--be-space-xs)!important}.be-mb-sm{margin-bottom:var(--be-space-sm)!important}.be-mb-md{margin-bottom:var(--be-space-md)!important}.be-mb-lg{margin-bottom:var(--be-space-lg)!important}.be-flex{display:flex!important}.be-flex-column{flex-direction:column!important}.be-flex-row{flex-direction:row!important}.be-justify-start{justify-content:flex-start!important}.be-justify-center{justify-content:center!important}.be-justify-end{justify-content:flex-end!important}.be-justify-between{justify-content:space-between!important}.be-align-start{align-items:flex-start!important}.be-align-center{align-items:center!important}.be-align-end{align-items:flex-end!important}.be-flex-1{flex:1!important}.be-flex-grow{flex-grow:1!important}.be-flex-shrink-0{flex-shrink:0!important}.be-min-w-0{min-width:0!important}.be-gap-xs{gap:var(--be-space-xs)!important}.be-gap-sm{gap:var(--be-space-sm)!important}.be-gap-md{gap:var(--be-space-md)!important}.be-gap-lg{gap:var(--be-space-lg)!important}.be-text-left{text-align:left!important}.be-text-center{text-align:center!important}.be-text-right{text-align:right!important}.be-text-xs{font-size:var(--be-font-size-xs)!important}.be-text-sm{font-size:var(--be-font-size-sm)!important}.be-text-md{font-size:var(--be-font-size-md)!important}.be-text-lg{font-size:var(--be-font-size-lg)!important}.be-font-normal{font-weight:400!important}.be-font-medium{font-weight:500!important}.be-font-bold{font-weight:600!important}.be-text-primary{color:var(--be-color-text)!important}.be-text-secondary{color:var(--be-color-text-secondary)!important}.be-text-muted{color:var(--be-color-text-muted)!important}.be-text-danger{color:var(--be-color-danger)!important}.be-text-success{color:var(--be-color-success)!important}.be-hidden{display:none!important}.be-visible{visibility:visible!important}.be-invisible{visibility:hidden!important}.be-block{display:block!important}.be-inline{display:inline!important}.be-inline-block{display:inline-block!important}.be-w-full{width:100%!important}.be-w-auto{width:auto!important}.be-h-full{height:100%!important}.be-grid{display:grid!important}.be-grid-cols-2{grid-template-columns:repeat(2,1fr)!important}.be-grid-cols-3{grid-template-columns:repeat(3,1fr)!important}.be-grid-cols-4{grid-template-columns:repeat(4,1fr)!important}.be-border{border:1px solid var(--be-color-border)!important}.be-border-0{border:none!important}.be-border-t{border-top:1px solid var(--be-color-border)!important}.be-border-r{border-right:1px solid var(--be-color-border)!important}.be-border-b{border-bottom:1px solid var(--be-color-border)!important}.be-border-l{border-left:1px solid var(--be-color-border)!important}.be-rounded-sm{border-radius:var(--be-radius-sm)!important}.be-rounded-md{border-radius:var(--be-radius-md)!important}.be-rounded-lg{border-radius:var(--be-radius-lg)!important}.be-rounded-full{border-radius:9999px!important}.be-bg{background:var(--be-color-bg)!important}.be-bg-secondary{background:var(--be-color-bg-secondary)!important}.be-bg-tertiary{background:var(--be-color-bg-tertiary)!important}.be-shadow-sm{box-shadow:var(--be-shadow-sm)!important}.be-shadow-md{box-shadow:var(--be-shadow-md)!important}.be-shadow-lg{box-shadow:var(--be-shadow-lg)!important}.be-shadow-none{box-shadow:none!important}.be-cursor-pointer{cursor:pointer!important}.be-cursor-default{cursor:default!important}.be-cursor-not-allowed{cursor:not-allowed!important}.be-overflow-hidden{overflow:hidden!important}.be-overflow-auto{overflow:auto!important}.be-overflow-scroll{overflow:scroll!important}.be-whitespace-nowrap{white-space:nowrap!important}.be-text-ellipsis{text-overflow:ellipsis!important;overflow:hidden!important}.be-relative{position:relative!important}.be-absolute{position:absolute!important}.be-fixed{position:fixed!important}.be-sticky{position:sticky!important}.be-transition{transition:all var(--be-transition-normal)!important}.be-transition-fast{transition:all var(--be-transition-fast)!important}.be-transition-slow{transition:all var(--be-transition-slow)!important}@media (max-width: 768px){.booth-btn-md{padding:5px 10px;font-size:11px;min-height:28px}.booth-btn-lg{padding:7px 14px;font-size:13px;min-height:36px}.booth-toggle .toggle-label{font-size:12px}.form-group label{font-size:11px}.booth-enhancer-sidebar input:not([type=checkbox]):not([type=radio]),.booth-enhancer-sidebar textarea,.booth-enhancer-sidebar select{font-size:11px}}@media (max-width: 480px){:root{--be-space-md: 12px;--be-space-lg: 16px}.booth-btn-sm{padding:3px 6px;font-size:10px;min-height:20px}.booth-btn-md{padding:4px 8px;font-size:10px;min-height:24px}.booth-btn-lg{padding:6px 12px;font-size:12px;min-height:32px}.booth-toggle .toggle-slider{width:36px;height:20px}.booth-toggle .toggle-slider:before{width:16px;height:16px}.booth-toggle input[type=checkbox]:checked+.toggle-slider:before{transform:translate(16px)}.booth-toggle .toggle-label{font-size:11px}}.booth-enhancer-sidebar[data-v-2b9f00bf]{position:relative;width:100%;height:100%;display:flex;flex-direction:column;background:#fffffffa;border:1px solid #e0e0e0;border-radius:12px 0 0 12px;box-shadow:-4px 0 12px #0000001a;font-size:12px;color:#333;overflow:hidden}.sidebar-content[data-v-2b9f00bf]{flex:1;overflow:hidden;display:flex;flex-direction:column;background:#fff;min-height:0;position:relative}.tab-slide-enter-active[data-v-2b9f00bf]{transition:opacity .2s ease-out,transform .2s ease-out}.tab-slide-leave-active[data-v-2b9f00bf]{transition:opacity .15s ease-in,transform .15s ease-in}.tab-slide-enter-from[data-v-2b9f00bf]{opacity:0;transform:translate(15px)}.tab-slide-leave-to[data-v-2b9f00bf]{opacity:0;transform:translate(-10px)}.tab-slide-enter-to[data-v-2b9f00bf],.tab-slide-leave-from[data-v-2b9f00bf]{opacity:1;transform:translate(0)}.sidebar-content[data-v-2b9f00bf]>*{width:100%;height:100%}.tag-preset-tab[data-v-7caba342]{height:100%;display:flex;flex-direction:column;background:#fff}.toolbar[data-v-7caba342]{flex-shrink:0;background:#fff;border-bottom:1px solid #e0e0e0}.tree-container[data-v-7caba342]{flex:1;overflow-y:auto;padding:4px;min-height:0;scrollbar-width:thin;scrollbar-color:#cbd5e1 #f5f5f5}.tree-container[data-v-7caba342]::-webkit-scrollbar{width:6px}.tree-container[data-v-7caba342]::-webkit-scrollbar-track{background:#f5f5f5;border-radius:3px}.tree-container[data-v-7caba342]::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px}.tree-container[data-v-7caba342]::-webkit-scrollbar-thumb:hover{background:#94a3b8}.folder-content[data-v-7caba342]{display:flex;align-items:center;width:100%;padding:6px 8px}.folder-content .icon[data-v-7caba342]{color:#fbbf24;display:flex;align-items:center;justify-content:center;margin-right:8px;flex-shrink:0}.folder-content .name[data-v-7caba342]{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:14px;color:#334155}.folder-content .count[data-v-7caba342]{font-size:12px;color:#94a3b8;margin-left:4px}.tag-custom-content[data-v-7caba342]{width:100%}.tag-badges-wrapper[data-v-7caba342]{display:flex;flex-wrap:wrap;gap:4px}.tag-badge[data-v-7caba342]{display:inline-flex;align-items:center;gap:4px;padding:2px 6px;background:#eff6ff;border:1px solid #bfdbfe;border-radius:8px;font-size:10px;color:#2563eb;line-height:1.2;white-space:nowrap;transition:all .15s ease}.tag-badge[data-v-7caba342]:hover{background:#dbeafe;border-color:#93c5fd}.tag-text[data-v-7caba342]{flex-shrink:0}.tag-delete-btn[data-v-7caba342]{flex-shrink:0;width:14px;height:14px;padding:0;display:flex;align-items:center;justify-content:center;background:transparent;border:none;border-radius:50%;color:#3b82f6;cursor:pointer;transition:all .15s ease;opacity:.7}.tag-delete-btn[data-v-7caba342]:hover{opacity:1;background:#3b82f6;color:#fff;transform:scale(1.1)}.modal-message[data-v-7caba342]{color:#6b7280;font-size:13px;line-height:1.6;margin:0}.modal-message-with-margin[data-v-7caba342]{color:#6b7280;font-size:13px;line-height:1.6;margin:0 0 12px}.modal-textarea-code[data-v-7caba342]{font-family:Consolas,Monaco,monospace;line-height:1.5}.modal-textarea-code-small[data-v-7caba342]{font-family:Consolas,Monaco,monospace;line-height:1.5;font-size:11px}.form-hint-small[data-v-7caba342]{display:block;margin-top:6px;color:#6b7280;font-size:11px}.item-data-tab[data-v-6c6b3856]{height:100%;display:flex;flex-direction:column;background:#fff}.item-custom-content[data-v-6c6b3856]{display:flex;align-items:center;gap:6px;font-size:11px;color:#94a3b8;line-height:1.4}.item-field[data-v-6c6b3856]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.item-separator[data-v-6c6b3856]{flex-shrink:0}.modal-message[data-v-6c6b3856]{color:#6b7280;font-size:13px;line-height:1.6;margin:0}.modal-message-with-margin[data-v-6c6b3856]{color:#6b7280;font-size:13px;line-height:1.6;margin:0 0 12px}.modal-textarea-code[data-v-6c6b3856]{font-family:Consolas,Monaco,monospace;line-height:1.5}.template-grid[data-v-b9c3c0a1]{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;max-height:300px;overflow-y:auto;padding:8px;border:1px solid var(--be-color-border);border-radius:var(--be-radius-sm)}.template-item[data-v-b9c3c0a1]{padding:8px;transition:all .15s ease}.template-item[data-v-b9c3c0a1]:hover{transform:translateY(-1px)}.empty-hint[data-v-268f4e4d]{padding:var(--be-space-md);text-align:center;color:var(--be-color-text-secondary);font-size:var(--be-font-size-md);background:var(--be-color-bg-secondary);border-radius:var(--be-radius)}.tag-badges-wrapper[data-v-f3247bf3]{display:flex;flex-wrap:wrap;gap:4px}.tag-badge[data-v-f3247bf3]{display:inline-flex;align-items:center;gap:4px;padding:2px 6px;background:#eff6ff;border:1px solid #bfdbfe;border-radius:8px;font-size:10px;color:#2563eb;line-height:1.2;white-space:nowrap;transition:all .15s ease}.tag-badge[data-v-f3247bf3]:hover{background:#dbeafe;border-color:#93c5fd}.tag-text[data-v-f3247bf3]{flex-shrink:0}.tag-delete-btn[data-v-f3247bf3]{flex-shrink:0;width:14px;height:14px;padding:0;display:flex;align-items:center;justify-content:center;background:transparent;border:none;border-radius:50%;color:#3b82f6;cursor:pointer;transition:all .15s ease;opacity:.7}.tag-delete-btn[data-v-f3247bf3]:hover{opacity:1;background:#3b82f6;color:#fff;transform:scale(1.1)}.discount-config[data-v-9e5fca5f]{display:flex;flex-direction:column;gap:var(--be-space-sm);margin-top:var(--be-space-sm)}.empty-hint[data-v-526d6f5f]{padding:var(--be-space-md);text-align:center;color:var(--be-color-text-secondary);font-size:var(--be-font-size-md);background:var(--be-color-bg-secondary);border-radius:var(--be-radius)}.item-cards-grid[data-v-526d6f5f]{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-top:4px}.item-cards-grid.single-item[data-v-526d6f5f]{grid-template-columns:1fr}.item-card[data-v-526d6f5f]{display:flex;flex-direction:column;background:var(--be-color-bg);border:1px solid var(--be-color-border);border-radius:var(--be-radius-md);overflow:hidden}.item-card-header[data-v-526d6f5f]{display:flex;align-items:center;justify-content:space-between;padding:6px 8px;background:var(--be-color-bg-secondary);border-bottom:1px solid var(--be-color-border);gap:4px}.item-card-title[data-v-526d6f5f]{flex:1;font-size:11px;font-weight:600;color:var(--be-color-text);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.item-card-delete-btn[data-v-526d6f5f]{flex-shrink:0;width:16px;height:16px;padding:0;display:flex;align-items:center;justify-content:center;background:transparent;border:none;border-radius:50%;color:var(--be-color-text-secondary);cursor:pointer;opacity:.6}.item-card-delete-btn[data-v-526d6f5f]:hover{opacity:1;background:var(--be-color-bg-hover)}.item-card-content[data-v-526d6f5f]{padding:6px 8px}.item-select-btn[data-v-526d6f5f]{width:100%;display:flex;align-items:center;gap:6px;padding:6px 8px;background:var(--be-color-bg);border:1px dashed var(--be-color-border);border-radius:var(--be-radius-sm);font-size:10px;color:var(--be-color-text-secondary);cursor:pointer}.item-select-btn[data-v-526d6f5f]:hover,.item-select-btn.has-item[data-v-526d6f5f]{border-style:solid}.item-select-text[data-v-526d6f5f]{flex:1;text-align:left;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.empty-state[data-v-d8a8cfef]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;padding:var(--be-space-xl);text-align:center}.empty-icon[data-v-d8a8cfef]{color:var(--be-color-text-muted);margin-bottom:var(--be-space-lg);opacity:.5}.empty-state p[data-v-d8a8cfef]{margin:0 0 var(--be-space-lg);font-size:var(--be-font-size-base);color:var(--be-color-text-secondary);max-width:400px}.empty-hint[data-v-d8a8cfef]{padding:var(--be-space-md);text-align:center;color:var(--be-color-text-secondary);font-size:var(--be-font-size-md);background:var(--be-color-bg-secondary);border-radius:var(--be-radius)}.edit-tab[data-v-d8a8cfef]{display:flex;flex-direction:column;height:100%;position:relative}.edit-tab-scrollable[data-v-d8a8cfef]{flex:1;overflow-y:auto;display:flex;flex-direction:column}.item-select-list[data-v-d8a8cfef]{max-height:400px;overflow-y:auto}.item-select-btn[data-v-d8a8cfef]{width:100%;justify-content:flex-start;padding:var(--be-space-sm)}.item-select-btn[data-v-d8a8cfef]:hover{background:var(--be-color-bg-hover)} `);

System.addImportMap({ imports: {"vue":"user:vue"} });
System.set("user:vue", (()=>{const _=Vue;('default' in _)||(_.default=_);return _})());

System.register("./__entry.js", ['./__monkey.entry-cNiwjrQq.js'], (function (exports, module) {
	'use strict';
	return {
		setters: [null],
		execute: (function () {



		})
	};
}));

System.register("./__monkey.entry-cNiwjrQq.js", ['vue'], (function (exports, module) {
	'use strict';
	var defineComponent, ref, watch, nextTick, createBlock, onUnmounted, openBlock, Teleport, createVNode, Transition, withCtx, createElementBlock, createCommentVNode, normalizeStyle, normalizeClass, Fragment, renderList, createElementVNode, toDisplayString, onMounted, renderSlot, unref, defineAsyncComponent, computed, createTextVNode, resolveDynamicComponent, createApp;
	return {
		setters: [module => {
			defineComponent = module.defineComponent;
			ref = module.ref;
			watch = module.watch;
			nextTick = module.nextTick;
			createBlock = module.createBlock;
			onUnmounted = module.onUnmounted;
			openBlock = module.openBlock;
			Teleport = module.Teleport;
			createVNode = module.createVNode;
			Transition = module.Transition;
			withCtx = module.withCtx;
			createElementBlock = module.createElementBlock;
			createCommentVNode = module.createCommentVNode;
			normalizeStyle = module.normalizeStyle;
			normalizeClass = module.normalizeClass;
			Fragment = module.Fragment;
			renderList = module.renderList;
			createElementVNode = module.createElementVNode;
			toDisplayString = module.toDisplayString;
			onMounted = module.onMounted;
			renderSlot = module.renderSlot;
			unref = module.unref;
			defineAsyncComponent = module.defineAsyncComponent;
			computed = module.computed;
			createTextVNode = module.createTextVNode;
			resolveDynamicComponent = module.resolveDynamicComponent;
			createApp = module.createApp;
		}],
		execute: (function () {

			exports({
				C: Ct,
				f: ft,
				g: gt,
				w: wt,
				x: xt
			});

			var t=Object.defineProperty,n=(n,e,i)=>((n,e,i)=>e in n?t(n,e,{enumerable:true,configurable:true,writable:true,value:i}):n[e]=i)(n,"symbol"!=typeof e?e+"":e,i);class E{static input(t,n){var e,i;let o;t instanceof HTMLInputElement?o=null==(e=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value"))?void 0:e.set:t instanceof HTMLTextAreaElement&&(o=null==(i=Object.getOwnPropertyDescriptor(window.HTMLTextAreaElement.prototype,"value"))?void 0:i.set),o?o.call(t,n):t.value=n;const s=new Event("input",{bubbles:true});t.dispatchEvent(s);}static keyDown(t,n){const e=new KeyboardEvent("keydown",{bubbles:true,cancelable:true,key:"Enter",code:"Enter",keyCode:n,which:n,shiftKey:false,ctrlKey:false,metaKey:false});t.dispatchEvent(e);}static pressEnter(t){this.keyDown(t,13);}static click(t){const n=new MouseEvent("click",{bubbles:true,cancelable:true});t.dispatchEvent(n);}}class S{constructor(){n(this,"_isReady",false),n(this,"_readyCallbacks",[]),this.shouldActivate()&&this.initialize();}async initialize(){try{await this.waitForDOMReady(),await this.load(),this.t=!0,this.triggerReadyCallbacks();}catch(t){}}waitForDOMReady(){return "complete"===document.readyState?Promise.resolve():new Promise(t=>window.addEventListener("load",()=>t(),{once:true}))}triggerReadyCallbacks(){this.i.forEach(t=>{try{t(this);}catch(n){}}),this.i=[];}onReady(t){this.t?t(this):this.i.push(t);}ready(){return this.t}isActivated(){return this.shouldActivate()}}class j extends S{constructor(){super(),n(this,"_data",{nameInput:null,descriptionTextarea:null,tags:[],tagElements:null}),n(this,"_newSectionCallback"),n(this,"_newVariationCallback"),n(this,"_sectionRemovedCallback"),n(this,"_variationRemovedCallback"),n(this,"_tempSectionAddedCallback"),n(this,"_tempVariationAddedCallback"),n(this,"_tempSectionRemovedCallback"),n(this,"_tempVariationRemovedCallback");}get sections(){return this.parseSections()}get variations(){return this.parseVariations()}shouldActivate(){const t=window.location.pathname;return /^\/items\/\d+\/edit(_pre)?$/.test(t)}waitForElements(t=1e4){return new Promise(n=>{const e=()=>{const t=document.querySelector("#name input");return t&&t.value.trim().length>0};if(e())return void n();const i=setTimeout(()=>{o.disconnect(),n();},t),o=new MutationObserver(()=>{e()&&(clearTimeout(i),o.disconnect(),n());});o.observe(document.body,{childList:true,subtree:true});})}async load(){await this.waitForElements(),this.loadName(),this.loadDescription(),this.loadTagElements(),this.setupListObserver();}loadName(){const t=document.querySelector("#name input");this.o.nameInput=t||null;}loadDescription(){const t=document.querySelector("#description textarea");this.o.descriptionTextarea=t||null;}findAllListContainers(){const t=new Set;return document.querySelectorAll("section.bg-white.desktop\\:px-24.desktop\\:pt-24.desktop\\:rounded-t-4 ul").forEach(n=>t.add(n)),document.querySelectorAll("ul.grid.gap-16").forEach(n=>t.add(n)),Array.from(t).filter(t=>t.querySelector("li .variation-box-head"))}getListItems(t){return Array.from(t.children).filter(t=>"li"===t.tagName.toLowerCase())}parseSections(){return this.findAllListContainers().filter(t=>this.isSectionList(t)).flatMap(t=>this.getListItems(t).flatMap(n=>{const e=n.querySelector("input.charcoal-text-field-input"),i=n.querySelector("textarea.charcoal-text-area-textarea");return e&&i?[{element:n,container:t,headlineInput:e,bodyTextarea:i,deleteButton:this.findDeleteButton(n)}]:[]}))}parseVariations(){return this.findAllListContainers().filter(t=>!this.isSectionList(t)).flatMap(t=>this.getListItems(t).flatMap(n=>{const e=n.querySelector('div[id^="variationName-"]'),i=n.querySelector('div[id^="variationDigitalPrice-"]'),o=null==e?void 0:e.querySelector("input.charcoal-text-field-input"),s=null==i?void 0:i.querySelector("input.charcoal-text-field-input");return o&&s?[{element:n,container:t,nameInput:o,priceInput:s,deleteButton:this.findDeleteButton(n)}]:[]}))}isSectionList(t){const n=t.closest("section");return !!n&&n.classList.contains("bg-white")&&n.classList.contains("desktop:px-24")&&n.classList.contains("desktop:pt-24")&&n.classList.contains("desktop:rounded-t-4")}loadTagElements(){const t=document.querySelector("#item_tag"),n=document.querySelector(".js-item-tags-array"),e=document.querySelector("#item_tag .item-search-input__container");t&&n&&e&&(this.o.tagElements={container:t,input:n,inputContainer:e});}addSectionElement(t,n){var e;const i=t.querySelector("input.charcoal-text-field-input"),o=t.querySelector("textarea.charcoal-text-area-textarea");if(!i||!o)return;const s={element:t,container:n,headlineInput:i,bodyTextarea:o,deleteButton:this.findDeleteButton(t)};null==(e=this.l)||e.call(this,s),this.h&&(this.h(),this.h=void 0);}addVariationElement(t,n){var e;const i=t.querySelector('div[id^="variationName-"]'),o=t.querySelector('div[id^="variationDigitalPrice-"]'),s=null==i?void 0:i.querySelector("input.charcoal-text-field-input"),r=null==o?void 0:o.querySelector("input.charcoal-text-field-input");if(!s||!r)return;const a={element:t,container:n,nameInput:s,priceInput:r,deleteButton:this.findDeleteButton(t)};null==(e=this.u)||e.call(this,a),this.p&&(this.p(),this.p=void 0);}handleItemAdded(t,n){this.isSectionList(n)?this.addSectionElement(t,n):this.addVariationElement(t,n);}isTargetListContainer(t){return "UL"===t.tagName&&t.classList.contains("grid")&&t.classList.contains("gap-16")}setupListObserver(){new MutationObserver(t=>{var n,e;for(const i of t){for(const t of Array.from(i.addedNodes))if(t instanceof HTMLElement)if(this.isTargetListContainer(t)&&t.querySelector("li .variation-box-head"))Array.from(t.children).filter(t=>"li"===t.tagName.toLowerCase()).forEach(n=>this.handleItemAdded(n,t));else if("li"===t.tagName.toLowerCase()){const n=t.parentElement;n&&this.isTargetListContainer(n)&&t.querySelector(".variation-box-head")&&this.handleItemAdded(t,n);}for(const t of Array.from(i.removedNodes)){if(!(t instanceof HTMLElement))continue;if("li"!==t.tagName.toLowerCase())continue;const o=i.target;this.isSectionList(o)?(null==(n=this.m)||n.call(this,t),this.v&&(this.v(),this.v=void 0)):(null==(e=this.k)||e.call(this,t),this.T&&(this.T(),this.T=void 0));}}}).observe(document.body,{childList:true,subtree:true});}get data(){return this.o.tags=this.getTags(),{...this.o,sections:this.sections,variations:this.variations}}get tagElements(){return this.o.tagElements}onSectionAdded(t){this.l=t;}onVariationAdded(t){this.u=t;}getTags(){const t=[];return document.querySelectorAll("#item_tag .bg-secondary500 .font-bold").forEach(n=>{var e;const i=null==(e=n.textContent)?void 0:e.trim();i&&t.push({text:i,element:n});}),t}getTagTexts(){return this.getTags().map(t=>t.text)}hasTag(t){return this.getTagTexts().includes(t)}getTagDeleteButtons(){return Array.from(document.querySelectorAll('#item_tag .bg-secondary500 a.flex pixiv-icon[name="32/BoothClose"]')).map(t=>t.closest("a")).filter(Boolean)}get name(){var t;return (null==(t=this.o.nameInput)?void 0:t.value)||""}set name(t){this.o.nameInput&&E.input(this.o.nameInput,t);}get description(){var t;return (null==(t=this.o.descriptionTextarea)?void 0:t.value)||""}set description(t){this.o.descriptionTextarea&&E.input(this.o.descriptionTextarea,t);}setName(t){this.name=t;}setDescription(t){this.description=t;}updateSection(t,n){const e=this.sections[t];e&&(void 0!==n.headline&&e.headlineInput&&E.input(e.headlineInput,n.headline),void 0!==n.body&&e.bodyTextarea&&E.input(e.bodyTextarea,n.body));}updateVariation(t,n){const e=this.variations[t];e&&(void 0!==n.name&&e.nameInput&&E.input(e.nameInput,n.name),void 0!==n.price&&e.priceInput&&E.input(e.priceInput,n.price));}async addTags(t){if(!this.o.tagElements)return;const{input:n}=this.o.tagElements;for(const e of t){if(this.hasTag(e))continue;E.input(n,e);const t=new KeyboardEvent("keydown",{key:"Enter",code:"Enter",keyCode:13,bubbles:true,cancelable:true});n.dispatchEvent(t),await new Promise(t=>setTimeout(t,10));}}async removeTags(t){if(!this.o.tagElements)return;const n=new Set(t),e=this.getTagTexts(),i=[];if(e.forEach((t,e)=>{n.has(t)&&i.push(e);}),0===i.length)return;const o=this.getTagDeleteButtons();for(let s=i.length-1;s>=0;s--){const t=i[s];o[t]&&(o[t].click(),await new Promise(t=>setTimeout(t,10)));}}onNameChange(t){this.o.nameInput&&this.o.nameInput.addEventListener("input",n=>{t(n.target.value);});}onDescriptionChange(t){this.o.descriptionTextarea&&this.o.descriptionTextarea.addEventListener("input",n=>{t(n.target.value);});}addInputListeners(t,n){t.forEach(t=>{null==t||t.addEventListener("input",()=>n());});}onSectionsChange(t){this.sections.forEach(n=>{this.addInputListeners([n.headlineInput,n.bodyTextarea],t);});const n=this.l;this.l=e=>{this.addInputListeners([e.headlineInput,e.bodyTextarea],t),null==n||n(e),t();};}onVariationsChange(t){this.variations.forEach(n=>{this.addInputListeners([n.nameInput,n.priceInput],t);});const n=this.u;this.u=e=>{this.addInputListeners([e.nameInput,e.priceInput],t),null==n||n(e),t();};}findDeleteButton(t){const n=t.querySelectorAll("button");return 2>n.length?null:n[1]}findAddSectionButton(){var t;const n=document.querySelectorAll("div.cursor-pointer");for(const e of n){const n=e.querySelector(".icon-plus"),i=null==(t=e.textContent)?void 0:t.trim();if(n&&(null==i?void 0:i.includes("段落")))return e}return null}findAddVariationButton(){var t;const n=document.querySelectorAll("button.flex.flex-col.justify-between.items-center");for(const e of n){const n=e.querySelector('pixiv-icon[name="16/Download"]'),i=null==(t=e.textContent)?void 0:t.trim();if(n&&(null==i?void 0:i.includes("Digital")))return e}return null}clickAddSectionButton(){const t=this.findAddSectionButton();return !!t&&(t.click(),true)}clickAddVariationButton(){const t=this.findAddVariationButton();return !!t&&(t.click(),true)}createWaitPromise(t,n,e){return new Promise(i=>{const o=setTimeout(()=>{n(),i(false);},e);t(()=>{clearTimeout(o),i(true);});})}async addSection(t=5e3){return !!this.clickAddSectionButton()&&this.createWaitPromise(t=>{this.h=t;},()=>{this.h=void 0;},t)}async addVariation(t=5e3){return !!this.clickAddVariationButton()&&this.createWaitPromise(t=>{this.p=t;},()=>{this.p=void 0;},t)}setupAddSectionButtonListener(t){const n=()=>{const n=this.findAddSectionButton();n&&!n.dataset.listenerAttached&&(n.dataset.listenerAttached="true",n.addEventListener("click",()=>{t();}));};n(),new MutationObserver(()=>{n();}).observe(document.body,{childList:true,subtree:true});}setupAddVariationButtonListener(t){const n=()=>{const n=this.findAddVariationButton();n&&!n.dataset.listenerAttached&&(n.dataset.listenerAttached="true",n.addEventListener("click",()=>{t();}));};n(),new MutationObserver(()=>{n();}).observe(document.body,{childList:true,subtree:true});}deleteSectionByElement(t){return t.deleteButton||(t.deleteButton=this.findDeleteButton(t.element)),!!t.deleteButton&&(t.deleteButton.click(),true)}deleteSectionByIndex(t){const n=this.sections[t];return !!n&&this.deleteSectionByElement(n)}async removeSection(t,n=5e3){const e=this.sections[t];return !!e&&(e.deleteButton||(e.deleteButton=this.findDeleteButton(e.element)),!!e.deleteButton&&(e.deleteButton.click(),this.createWaitPromise(t=>{this.v=t;},()=>{this.v=void 0;},n)))}deleteAllSections(){let t=0;for(;this.sections.length>0&&this.deleteSectionByIndex(this.sections.length-1);)t++;return t}deleteVariationByElement(t){return t.deleteButton||(t.deleteButton=this.findDeleteButton(t.element)),!!t.deleteButton&&(t.deleteButton.click(),true)}deleteVariationByIndex(t){const n=this.variations[t];return !!n&&this.deleteVariationByElement(n)}async removeVariation(t,n=5e3){const e=this.variations[t];return !!e&&(e.deleteButton||(e.deleteButton=this.findDeleteButton(e.element)),!!e.deleteButton&&(e.deleteButton.click(),this.createWaitPromise(t=>{this.T=t;},()=>{this.T=void 0;},n)))}deleteAllVariations(){let t=0;for(;this.variations.length>0&&this.deleteVariationByIndex(this.variations.length-1);)t++;return t}getVariationFiles(t){const n=this.variations[t];if(!n)return [];const e=n.element.querySelectorAll('a[href*="/downloadables/"]'),i=[];return e.forEach(t=>{const n=t.href.match(/\/downloadables\/(\d+)/);n&&i.push(n[1]);}),i}get files(){return this.getAllFiles().map(t=>({id:t.id,name:t.name}))}getAllFiles(){var t;const n=document.querySelectorAll(".font-booth-demi");let e=null;for(const o of Array.from(n))if(null==(t=o.textContent)?void 0:t.includes("Add/Edit Files")){e=o.closest(".bg-white");break}if(!e)return [];const i=e.querySelector("ul.list-none");return i?this.parseFileListFromContainer(i):[]}parseFileListFromContainer(t){const n=t.querySelectorAll("li"),e=[];return n.forEach(t=>{var n;const i=t.querySelector('input.charcoal-checkbox-input[type="checkbox"]'),o=t.querySelector('a[href*="/downloadables/"]');if(i&&o){const t=o.href.match(/\/downloadables\/(\d+)/),s=t?t[1]:"",r=(null==(n=o.textContent)?void 0:n.trim())||"";e.push({id:s,name:r,checkbox:i,checked:i.checked});}}),e}findVariationEditButton(t){var n;const e=this.variations[t];if(!e)return null;const i=e.element.querySelector("i.icon-downloadables");if(i){const t=i.closest("div.cursor-pointer");if(null==(n=null==t?void 0:t.textContent)?void 0:n.includes("Add/Edit Files"))return t}const o=e.element.querySelector("div:nth-child(3)");if(o){const t=Array.from(o.querySelectorAll("button")).find(t=>{var n;const e=(null==(n=t.textContent)?void 0:n.trim())||"";return "Edit"===e||e.includes("Edit")&&!e.includes("Delete")});if(t)return t}return null}async openVariationEditPanel(t,n=5e3){const e=this.findVariationEditButton(t);return e?(E.click(e),await new Promise(t=>setTimeout(t,100)),new Promise(t=>{let e=null;const i=setTimeout(()=>{null==e||e.disconnect(),t(null);},n),o=()=>{const n=this.findVariationEditPanel();return !!n&&(clearTimeout(i),null==e||e.disconnect(),t(n),true)};o()||(e=new MutationObserver(o),e.observe(document.body,{childList:true,attributes:true,attributeFilter:["class","style"],subtree:true}));})):null}findVariationEditPanel(){const t=document.querySelectorAll("body > div.fixed.top-0.left-0.right-0"),n=Array.from(t).find(t=>{var n;return null==(n=t.textContent)?void 0:n.includes("Add/Edit Files")});if(!n)return null;const e=n.classList.contains("hidden"),i=null!==n.querySelector("ul.list-none");if(e&&!i)return null;const o=Array.from(n.querySelectorAll("button")).find(t=>t.querySelector('pixiv-icon[name="32/BoothClose"]'))||null;return {container:n,closeButton:o,files:this.parseFileList(n)}}parseFileList(t){const n=t.querySelectorAll("ul.list-none > li"),e=[];return n.forEach(t=>{var n;const i=t.querySelector('input.charcoal-checkbox-input[type="checkbox"]'),o=t.querySelector('a[href*="/downloadables/"]');if(i&&o){const t=o.href.match(/\/downloadables\/(\d+)/),s=t?t[1]:"",r=(null==(n=o.textContent)?void 0:n.trim())||"";e.push({id:s,name:r,checkbox:i,checked:i.checked});}}),e}selectFiles(t,n,e="replace"){t.files.forEach(t=>{const i=n.includes(t.id);("replace"===e?t.checked!==i:i&&!t.checked)&&t.checkbox.click();});}closeVariationEditPanel(t){t.closeButton&&t.closeButton.click();}getSelectedFileIds(t){return t.files.filter(t=>t.checked).map(t=>t.id)}getVariationSelectedFileIds(t){const n=this.variations[t];if(!n)return [];const e=n.element.querySelector("div:nth-child(3)");if(!e)return [];const i=e.querySelector("div.grid.gap-12 > div > ul");if(!i)return [];const o=i.querySelectorAll('a[href*="/downloadables/"]'),s=[];return o.forEach(t=>{const n=t.href.match(/\/downloadables\/(\d+)/);n&&s.push(n[1]);}),s}async setVariationFiles(t,n,e="replace"){const i=this.getVariationSelectedFileIds(t).sort(),o=[...new Set(n)].sort();if("replace"===e&&i.length===o.length&&i.every((t,n)=>t===o[n]))return {success:true,updated:false};const s=await this.openVariationEditPanel(t);return s?(this.selectFiles(s,n,e),await new Promise(t=>setTimeout(t,100)),this.closeVariationEditPanel(s),{success:true,updated:true}):{success:false,updated:false}}}class A{constructor(t){n(this,"context"),n(this,"path"),n(this,"api"),this.context=t,this.path=window.location.pathname;}async execute(){this.api=this.createAPI(),this.api?await new Promise(t=>{this.api.onReady(async()=>{await this.initialize(),t();});}):await this.initialize();}getAPI(){return this.api}}const L=function(){const t="undefined"!=typeof document&&document.createElement("link").relList;return t&&t.supports&&t.supports("modulepreload")?"modulepreload":"preload"}(),z={},O=function(t,n,e){let i=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const t=document.querySelector("meta[property=csp-nonce]"),e=(null==t?void 0:t.nonce)||(null==t?void 0:t.getAttribute("nonce"));i=Promise.allSettled(n.map(t=>{if((t=function(t){return "/"+t}(t))in z)return;z[t]=true;const n=t.endsWith(".css"),i=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${t}"]${i}`))return;const o=document.createElement("link");return o.rel=n?"stylesheet":L,n||(o.as="script"),o.crossOrigin="",o.href=t,e&&o.setAttribute("nonce",e),document.head.appendChild(o),n?new Promise((n,e)=>{o.addEventListener("load",n),o.addEventListener("error",()=>e(Error("Unable to preload CSS for "+t)));}):void 0}));}function o(t){const n=new Event("vite:preloadError",{cancelable:true});if(n.payload=t,window.dispatchEvent(n),!n.defaultPrevented)throw t}return i.then(n=>{for(const t of n||[])"rejected"===t.status&&o(t.reason);return t().catch(o)})},D={key:0,class:"menu-separator"},V=["onClick"],N=["innerHTML"],P={class:"menu-label"},F={key:2,class:"menu-separator"},H=(t,n)=>{const e=t.C||t;for(const[i,o]of n)e[i]=o;return e},$=H(defineComponent({_:"ContextMenu",props:{show:{type:Boolean},x:{},y:{},items:{}},emits:["close"],setup(t,{emit:n}){const e=t,y=n,k=ref(null),T=ref({x:0,y:0}),C=ref(false);watch(()=>[e.show,e.x,e.y],([t])=>{t&&(async()=>{if(C.value=true,T.value={x:e.x,y:e.y},await nextTick(),await nextTick(),!k.value)return void(C.value=false);const t=k.value.getBoundingClientRect(),n=document.querySelector(".booth-enhancer-sidebar");let i,o,s;n?(i=n.getBoundingClientRect(),o=i.width,s=i.height):(o=document.documentElement.clientWidth,s=document.documentElement.clientHeight,i=new DOMRect(0,0,o,s));let r=e.x,a=e.y;const l=i.left+o;r+t.width>l-8&&(r=Math.max(i.left+8,l-t.width-8)),r<i.left+8&&(r=i.left+8);const c=i.top+s;a+t.height>c-8&&(a=Math.max(i.top+8,c-t.height-8)),a<i.top+8&&(a=i.top+8),T.value={x:r,y:a},await nextTick(),C.value=false;})();});const _=t=>{k.value&&!k.value.contains(t.target)&&y("close");};return watch(()=>e.show,t=>{t?setTimeout(()=>{document.addEventListener("click",_);},0):document.removeEventListener("click",_);}),onUnmounted(()=>{document.removeEventListener("click",_);}),(t,n)=>(openBlock(),createBlock(Teleport,{to:"body"},[createVNode(Transition,{name:"menu-fade"},{default:withCtx(()=>[t.show?(openBlock(),createElementBlock("div",{key:0,ref_key:"menuRef",ref:k,class:normalizeClass(["context-menu",{"no-transition":C.value}]),style:normalizeStyle({left:T.value.x+"px",top:T.value.y+"px"})},[(openBlock(true),createElementBlock(Fragment,null,renderList(t.items,(t,n)=>(openBlock(),createElementBlock(Fragment,{key:n},["-"===t.label?(openBlock(),createElementBlock("div",D)):(openBlock(),createElementBlock("div",{key:1,class:normalizeClass(["menu-item",{"menu-item-danger":t.danger,"menu-item-disabled":t.disabled}]),onClick:n=>(t=>{t.disabled||(t.action(),y("close"));})(t)},[t.icon?(openBlock(),createElementBlock("span",{key:0,class:"menu-icon",innerHTML:t.icon},null,8,N)):createCommentVNode("",true),createElementVNode("span",P,toDisplayString(t.label),1)],10,V)),t.separator?(openBlock(),createElementBlock("div",F)):createCommentVNode("",true)],64))),128))],6)):createCommentVNode("",true)]),I:1})]))}}),[["__scopeId","data-v-4d60a255"]]),J=["title"],R=["innerHTML"],q=H(defineComponent({_:"IconButton",props:{icon:{},title:{},variant:{}},emits:["click"],setup(t,{emit:n}){const e=n,i=t=>{e("click",t);};return (t,n)=>(openBlock(),createElementBlock("button",{class:normalizeClass(["icon-btn",{["variant-"+t.variant]:t.variant}]),title:t.title,onClick:i},[createElementVNode("span",{innerHTML:t.icon},null,8,R)],10,J))}}),[["__scopeId","data-v-996dd7d2"]]),G=(t,n,e)=>{let i=t.replace("<svg ",`<svg width="${n}" height="${n}" `);return void 0!==e&&(i=i.replace(/stroke-width="[\d.]+"/g,`stroke-width="${e}"`)),i},U={chevronLeft:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <polyline points="15 18 9 12 15 6"></polyline>\n  </svg>',chevronRight:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <polyline points="9 18 15 12 9 6"></polyline>\n  </svg>',chevronUp:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <polyline points="18 15 12 9 6 15"></polyline>\n  </svg>',chevronDown:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <polyline points="6 9 12 15 18 9"></polyline>\n  </svg>',download:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>\n    <polyline points="7 10 12 15 17 10"></polyline>\n    <line x1="12" y1="15" x2="12" y2="3"></line>\n  </svg>',upload:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>\n    <polyline points="17 8 12 3 7 8"></polyline>\n    <line x1="12" y1="3" x2="12" y2="15"></line>\n  </svg>',send:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <line x1="22" y1="2" x2="11" y2="13"></line>\n    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>\n  </svg>',close:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <line x1="18" y1="6" x2="6" y2="18"></line>\n    <line x1="6" y1="6" x2="18" y2="18"></line>\n  </svg>',plus:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <line x1="12" y1="5" x2="12" y2="19"></line>\n    <line x1="5" y1="12" x2="19" y2="12"></line>\n  </svg>',edit:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>\n    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>\n  </svg>',trash:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <polyline points="3 6 5 6 21 6"></polyline>\n    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>\n  </svg>',copy:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>\n    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>\n  </svg>',folderEmpty:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>\n  </svg>',folderFilled:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" stroke="none" stroke-width="0" stroke-linecap="round" stroke-linejoin="round">\n    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>\n  </svg>',folder:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>\n  </svg>',folderOpen:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2v11z"></path>\n  </svg>',file:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path>\n    <polyline points="13 2 13 9 20 9"></polyline>\n  </svg>',files:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <path d="M12 7H5a2 2 0 0 0-2 2v11a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2V12z" fill="currentColor"></path>\n    <polyline points="12 7 12 12 16 12" fill="currentColor"></polyline>\n    <path d="M17 2H10a2 2 0 0 0-2 2v11a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2V7z" fill="white"></path>\n    <polyline points="17 2 17 7 21 7" fill="white"></polyline>\n  </svg>',search:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <circle cx="11" cy="11" r="8"></circle>\n    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>\n  </svg>',tag:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>\n    <line x1="7" y1="7" x2="7.01" y2="7"></line>\n  </svg>',settings:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <circle cx="12" cy="12" r="3"></circle>\n    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>\n  </svg>',eye:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>\n    <circle cx="12" cy="12" r="3"></circle>\n  </svg>',check:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <polyline points="20 6 9 17 4 12"></polyline>\n  </svg>',alertCircle:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <circle cx="12" cy="12" r="10"></circle>\n    <line x1="12" y1="8" x2="12" y2="12"></line>\n    <line x1="12" y1="16" x2="12.01" y2="16"></line>\n  </svg>',info:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <circle cx="12" cy="12" r="10"></circle>\n    <line x1="12" y1="16" x2="12" y2="12"></line>\n    <line x1="12" y1="8" x2="12.01" y2="8"></line>\n  </svg>',magic:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <path d="M12 2l2.5 7.5L22 12l-7.5 2.5L12 22l-2.5-7.5L2 12l7.5-2.5L12 2z"></path>\n    <path d="M7.5 4.5l.5 1.5 1.5.5-1.5.5-.5 1.5-.5-1.5L5.5 6.5l1.5-.5.5-1.5z"></path>\n    <path d="M18.5 14.5l.5 1.5 1.5.5-1.5.5-.5 1.5-.5-1.5-1.5-.5 1.5-.5.5-1.5z"></path>\n  </svg>',moreVertical:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <circle cx="12" cy="12" r="1"></circle>\n    <circle cx="12" cy="5" r="1"></circle>\n    <circle cx="12" cy="19" r="1"></circle>\n  </svg>',moreHorizontal:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n    <circle cx="12" cy="12" r="1"></circle>\n    <circle cx="19" cy="12" r="1"></circle>\n    <circle cx="5" cy="12" r="1"></circle>\n  </svg>'},Y={class:"modal-header"},X={class:"modal-title"},K={class:"modal-header-actions"},W=["innerHTML"],Z={class:"modal-body"},Q={key:0,class:"modal-footer"},tt=["onClick"],nt=H(defineComponent({_:"Modal",props:{show:{type:Boolean},title:{},width:{},buttons:{},closeOnClickOutside:{type:Boolean,default:true},closeOnEsc:{type:Boolean,default:true},teleportTo:{default:"body"}},emits:["close","action"],setup(t,{emit:n}){const e=t,i=n,o=()=>{i("close");},b=t=>{e.closeOnClickOutside&&t.target===t.currentTarget&&o();},C=t=>{e.closeOnEsc&&"Escape"===t.key&&e.show&&o();};return onMounted(()=>{document.addEventListener("keydown",C);}),onUnmounted(()=>{document.removeEventListener("keydown",C);}),(t,n)=>(openBlock(),createBlock(Teleport,{to:t.teleportTo,disabled:"body"!==t.teleportTo},[createVNode(Transition,{name:"modal"},{default:withCtx(()=>[t.show?(openBlock(),createElementBlock("div",{key:0,class:normalizeClass(["modal-overlay",{"modal-in-sidebar":"body"!==t.teleportTo}]),onClick:b},[createElementVNode("div",{class:"modal-container",style:normalizeStyle({width:t.width||"400px"})},[createElementVNode("div",Y,[createElementVNode("div",X,toDisplayString(t.title||"提示"),1),createElementVNode("div",K,[renderSlot(t.$slots,"header-actions",{},void 0,true),createElementVNode("button",{class:"booth-btn booth-btn-ghost booth-btn-icon booth-btn-sm",onClick:o,type:"button",title:"关闭"},[createElementVNode("span",{innerHTML:unref(U).close},null,8,W)])])]),createElementVNode("div",Z,[renderSlot(t.$slots,"default",{},void 0,true)]),t.$slots.footer||t.buttons&&t.buttons.length>0?(openBlock(),createElementBlock("div",Q,[renderSlot(t.$slots,"footer",{},()=>[(openBlock(true),createElementBlock(Fragment,null,renderList(t.buttons,t=>(openBlock(),createElementBlock("button",{key:t.action,class:normalizeClass(["booth-btn booth-btn-md",["booth-btn-"+(t.variant||"secondary")]]),onClick:n=>{return e=t.action,void i("action",e);var e;},type:"button"},toDisplayString(t.text),11,tt))),128))],true)])):createCommentVNode("",true)],4)],2)):createCommentVNode("",true)]),I:3})],8,["to","disabled"]))}}),[["__scopeId","data-v-db693591"]]),et={class:"tab-bar"},it={class:"tab-list"},ot=["onClick"],st=["innerHTML"],rt={class:"tab-label"},at={key:0,class:"tab-actions"},lt=H(defineComponent({_:"TabBar",props:{tabs:{},activeTab:{}},emits:["update:activeTab"],setup(t,{emit:n}){const e=n;return (t,n)=>(openBlock(),createElementBlock("div",et,[createElementVNode("div",it,[(openBlock(true),createElementBlock(Fragment,null,renderList(t.tabs,n=>(openBlock(),createElementBlock("button",{key:n.id,class:normalizeClass(["tab-btn",{active:t.activeTab===n.id}]),onClick:t=>{return i=n.id,void e("update:activeTab",i);var i;}},[n.icon?(openBlock(),createElementBlock("span",{key:0,class:"tab-icon",innerHTML:n.icon},null,8,st)):createCommentVNode("",true),createElementVNode("span",rt,toDisplayString(n.label),1)],10,ot))),128))]),t.$slots.actions?(openBlock(),createElementBlock("div",at,[renderSlot(t.$slots,"actions",{},void 0,true)])):createCommentVNode("",true)]))}}),[["__scopeId","data-v-ee7eccb8"]]); exports({ H, $, G, U, n: nt });var ct=(()=>"undefined"!=typeof GM_getValue?GM_getValue:void 0)(),dt=(()=>"undefined"!=typeof GM_notification?GM_notification:void 0)(),ht=(()=>"undefined"!=typeof GM_registerMenuCommand?GM_registerMenuCommand:void 0)(),ut=(()=>"undefined"!=typeof GM_setClipboard?GM_setClipboard:void 0)(),pt=(()=>"undefined"!=typeof GM_setValue?GM_setValue:void 0)(),mt=(()=>"undefined"!=typeof GM_xmlhttpRequest?GM_xmlhttpRequest:void 0)();function gt(t){return function(t){return {itemId:t,itemName:"",itemType:"normal",itemTypeName:"Item",useSmartLogic:true,selectedTemplates:{nameTemplateId:"default-name",descriptionTemplateId:"default-desc",discountTemplateId:"default-discount"},customDescription:"",discount:{enabled:false,discountPercent:0},pricing:{normalVariationPrice:0,fullsetPrice:0},sections:[],variations:[],tagNodeIds:[]}}(t)}function vt(t,n){if(!t||0===t.length)return "";let e;return n&&(e=t.find(t=>t.id===n)),e||(e=t.find(t=>t.isDefault)||t[0]),(null==e?void 0:e.template)||""}function ft(t,n){var e;return vt(t.nameTemplates,null==(e=n.selectedTemplates)?void 0:e.nameTemplateId)}function wt(t,n){var e;return vt(t.descriptionTemplates,null==(e=n.selectedTemplates)?void 0:e.descriptionTemplateId)}function xt(t,n){var e;return vt(t.discountTemplates,null==(e=n.selectedTemplates)?void 0:e.discountTemplateId)}const bt="booth-enhancer-config-v4",yt=class t{constructor(){n(this,"_data"),n(this,"_saveTimer",null),this.o=ref(this.load()),watch(this.o,()=>this.saveWithDebounce(),{deep:true});}static getInstance(){return t.instance||(t.instance=new t),t.instance}get data(){return this.o}load(){try{const t=ct(bt,null);if(t)return JSON.parse(t)}catch(t){}return {tagTree:{rootIds:[],nodes:{}},itemTree:{rootIds:[],nodes:{}},globalTemplates:{nameTemplates:[{id:"default-name",name:"默认商品名",template:"{商品名}",isDefault:true},{id:"smart-auto",name:"智能商品名（推荐）",template:"{智能标题}",isDefault:false},{id:"smart-with-discount",name:"智能商品名（含折扣标识）",template:"{折扣标识}{智能标题}",isDefault:false},{id:"always-show-count",name:"总是显示数量",template:"{支持数} {商品类型复数} | {首个变体名}",isDefault:false}],descriptionTemplates:[{id:"default-desc",name:"默认描述",template:"",isDefault:true}],discountTemplates:[{id:"default-discount",name:"默认打折",template:"【セール中】\n通常価格: ¥{原价} → セール価格: ¥{折扣价} ({折扣百分比}% OFF)",isDefault:true},{id:"fullset-discount",name:"含 Fullset",template:"◆[セール開催中]◆\n- フルセット : {Fullset原价} JPY >> {Fullset折扣价} JPY\n- 単品: {原价} JPY >> {折扣价} JPY\n⏰ {折扣开始时间} - {折扣结束时间}\n({折扣百分比}% OFF)",isDefault:false}],logTemplates:[{id:"default-log",name:"默认日志",template:"⟡ {日期}\n　・ {内容}",isDefault:true}],itemInfoTemplates:[{id:"default-item-info",name:"默认商品信息",template:"⟡ {作者名}\nʚ {商品名} ɞ\n- {商品链接} -",isDefault:true}],sectionTemplates:[]},itemConfigs:{},ui:{sidebarOpen:false,activeTab:"tags"}}}save(){try{pt(bt,JSON.stringify(this.o.value));}catch(t){}}saveWithDebounce(){this.M&&window.clearTimeout(this.M),this.M=window.setTimeout(()=>{this.save(),this.M=null;},500);}createNode(t,n,e,i=null){const o=crypto.randomUUID(),s={id:o,parentId:i,name:n,children:[],expanded:true,data:e,createdAt:Date.now(),updatedAt:Date.now()};if(t.nodes[o]=s,i){const n=t.nodes[i];n&&n.children.push(o);}else t.rootIds.push(o);return this.saveWithDebounce(),s}deleteNode(t,n){const e=t.nodes[n];if(e){if([...e.children].forEach(n=>this.deleteNode(t,n)),e.parentId){const i=t.nodes[e.parentId];i&&(i.children=i.children.filter(t=>t!==n));}else t.rootIds=t.rootIds.filter(t=>t!==n);delete t.nodes[n],this.saveWithDebounce();}}moveNode(t,n,e){const i=t.nodes[n];if(i&&i.id!==e){if(e){let i=t.nodes[e];for(;i;){if(i.id===n)return;if(!i.parentId)break;i=t.nodes[i.parentId];}}if(i.parentId){const e=t.nodes[i.parentId];e&&(e.children=e.children.filter(t=>t!==n));}else t.rootIds=t.rootIds.filter(t=>t!==n);if(e){const i=t.nodes[e];i&&i.children.push(n);}else t.rootIds.push(n);i.parentId=e,i.updatedAt=Date.now(),this.saveWithDebounce();}}insertNodeAt(t,n,e,i){const o=t.nodes[n];if(o){if(e){if(n===e)return;let i=t.nodes[e];for(;i;){if(i.id===n)return;if(!i.parentId)break;i=t.nodes[i.parentId];}}if(o.parentId){const e=t.nodes[o.parentId];e&&(e.children=e.children.filter(t=>t!==n));}else t.rootIds=t.rootIds.filter(t=>t!==n);if(e){const o=t.nodes[e];o&&o.children.splice(i,0,n);}else t.rootIds.splice(i,0,n);o.parentId=e,o.updatedAt=Date.now(),this.saveWithDebounce();}}renameNode(t,n,e){const i=t.nodes[n];i&&(i.name=e,i.updatedAt=Date.now(),this.saveWithDebounce());}exportTags(){return {tagTree:this.o.value.tagTree}}exportItems(){return {itemTree:this.o.value.itemTree}}exportTemplates(){return {globalTemplates:this.o.value.globalTemplates}}exportSingleItem(t){return this.o.value.itemConfigs[t]||null}exportAllItems(){return {...this.o.value.itemConfigs}}importTags(t){if(!t.tagTree||!t.tagTree.nodes)throw Error("无效的标签数据格式");this.o.value.tagTree=t.tagTree;}importItems(t){if(!t.itemTree||!t.itemTree.nodes)throw Error("无效的商品数据格式");this.o.value.itemTree=t.itemTree;}importTemplates(t){if(!t.globalTemplates)throw Error("无效的模板数据格式");this.o.value.globalTemplates=t.globalTemplates;}importSingleItem(t,n){if(!t.itemId)throw Error("商品配置缺少 itemId");return !(this.o.value.itemConfigs[t.itemId]&&!(null==n?void 0:n.replace)||(this.o.value.itemConfigs[t.itemId]=t,0))}importAllFromZip(t){const n=[];if(t["tags.json"])try{this.importTags(t["tags.json"]);}catch(e){n.push("标签数据");}if(t["items.json"])try{this.importItems(t["items.json"]);}catch(e){n.push("商品列表");}if(t["templates.json"])try{this.importTemplates(t["templates.json"]);}catch(e){n.push("全局模板");}for(const[i,o]of Object.entries(t))if(i.startsWith("item-")&&i.endsWith(".json"))try{this.importSingleItem(o,{replace:!0});}catch(e){n.push("商品配置 "+i);}if(n.length>0)throw Error("以下数据导入失败: "+n.join("、"))}importAllFromJSON(t){const n=[];if(!t.data)throw Error("无效的备份文件格式");const{tags:e,items:i,templates:o,itemConfigs:s}=t.data;if(e)try{this.importTags(e);}catch(r){n.push("标签数据");}if(i)try{this.importItems(i);}catch(r){n.push("商品列表");}if(o)try{this.importTemplates(o);}catch(r){n.push("全局模板");}if(s)for(const[a,l]of Object.entries(s))try{this.importSingleItem(l,{replace:!0});}catch(r){n.push("商品配置 "+a);}if(n.length>0)throw Error("以下数据导入失败: "+n.join("、"))}exportData(){return JSON.stringify(this.o.value,null,2)}importData(t){try{const n=JSON.parse(t);if(!n.tagTree||!n.itemTree)throw Error("Invalid data structure");return this.o.value=n,this.save(),!0}catch(n){return  false}}};n(yt,"instance");let kt=exports("k", yt);const Tt=exports("T", new class{constructor(){n(this,"container",null),n(this,"toasts",new Set),n(this,"targetContainer",null),n(this,"iconMap",{success:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>',error:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>',warning:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>',info:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>'});}setContainer(t){this.targetContainer=t,this.container&&(this.container.remove(),this.container=null);}ensureContainer(){return this.container||(this.container=document.createElement("div"),this.container.className="booth-toast-container",this.targetContainer?this.container.setAttribute("data-position","relative"):this.container.setAttribute("data-position","fixed"),this.injectStyles(),(this.targetContainer||document.body).appendChild(this.container)),this.container}injectStyles(){if(document.getElementById("booth-toast-styles"))return;const t=document.createElement("style");t.id="booth-toast-styles",t.textContent='\n      /* Toast 容器基础样式 */\n      .booth-toast-container {\n        display: flex;\n        gap: 8px;\n        pointer-events: none;\n        z-index: 1000;\n      }\n\n      /* Toast 容器在 body 中时 - 固定在右上角 */\n      .booth-toast-container[data-position="fixed"] {\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        flex-direction: column;\n        z-index: 10001;\n      }\n\n      /* Toast 容器在其他元素中时 - 绝对定位在底部 */\n      .booth-toast-container[data-position="relative"] {\n        position: absolute;\n        bottom: 20px;\n        left: 20px;\n        right: 20px;\n        flex-direction: column-reverse;\n      }\n\n      .booth-toast {\n        min-width: 200px;\n        max-width: 400px;\n        padding: 14px 16px;\n        background: white;\n        border-radius: 8px;\n        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);\n        font-size: 14px;\n        line-height: 1.5;\n        pointer-events: auto;\n        opacity: 0;\n        transition: all 0.3s ease;\n        word-wrap: break-word;\n        display: flex;\n        align-items: flex-start;\n        gap: 10px;\n      }\n\n      .toast-icon {\n        flex-shrink: 0;\n        width: 20px;\n        height: 20px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .toast-icon svg {\n        width: 100%;\n        height: 100%;\n      }\n\n      .toast-message {\n        flex: 1;\n        padding-top: 1px;\n        color: #333;\n      }\n\n      /* Toast 在固定容器中时从右侧滑入 */\n      .booth-toast-container[data-position="fixed"] .booth-toast {\n        transform: translateX(20px);\n      }\n\n      .booth-toast-container[data-position="fixed"] .booth-toast.show {\n        opacity: 1;\n        transform: translateX(0);\n      }\n\n      /* Toast 在相对容器中时从下往上滑入 */\n      .booth-toast-container[data-position="relative"] .booth-toast {\n        transform: translateY(20px);\n      }\n\n      .booth-toast-container[data-position="relative"] .booth-toast.show {\n        opacity: 1;\n        transform: translateY(0);\n      }\n\n      .booth-toast-success {\n        background: #f0fdf4;\n        border: 1px solid #86efac;\n      }\n      \n      .booth-toast-success .toast-icon {\n        color: #22c55e;\n      }\n\n      .booth-toast-error {\n        background: #fef2f2;\n        border: 1px solid #fecaca;\n      }\n      \n      .booth-toast-error .toast-icon {\n        color: #ef4444;\n      }\n\n      .booth-toast-warning {\n        background: #fffbeb;\n        border: 1px solid #fde68a;\n      }\n      \n      .booth-toast-warning .toast-icon {\n        color: #f59e0b;\n      }\n\n      .booth-toast-info {\n        background: #eff6ff;\n        border: 1px solid #93c5fd;\n      }\n      \n      .booth-toast-info .toast-icon {\n        color: #3b82f6;\n      }\n\n      @media (max-width: 768px) {\n        .booth-toast-container[data-position="fixed"] {\n          top: 10px;\n          left: 10px;\n          right: 10px;\n        }\n\n        .booth-toast {\n          min-width: 0;\n          max-width: none;\n          width: 100%;\n          padding: 10px 14px;\n          font-size: 13px;\n        }\n      }\n    ',document.head.appendChild(t);}show(t){const{message:n,type:e="info",duration:i=3e3,onClose:o}=t,s=this.ensureContainer(),r=document.createElement("div");r.className="booth-toast booth-toast-"+e,r.innerHTML=`\n      <div class="toast-icon">${this.iconMap[e]}</div>\n      <div class="toast-message">${n}</div>\n    `,s.appendChild(r),this.toasts.add(r),requestAnimationFrame(()=>{r.classList.add("show");}),setTimeout(()=>{this.remove(r,o);},i);}remove(t,n){t.classList.remove("show"),setTimeout(()=>{t.parentElement&&t.parentElement.removeChild(t),this.toasts.delete(t),n&&n(),0===this.toasts.size&&this.container&&(this.container.remove(),this.container=null);},300);}success(t,n){this.show({message:t,type:"success",duration:n});}error(t,n){this.show({message:t,type:"error",duration:n});}warning(t,n){this.show({message:t,type:"warning",duration:n});}info(t,n){this.show({message:t,type:"info",duration:n});}});function Ct(){const t=kt.getInstance();return {storage:t,data:t.data,exportTags:()=>t.exportTags(),exportItems:()=>t.exportItems(),exportTemplates:()=>t.exportTemplates(),exportSingleItem:n=>t.exportSingleItem(n),exportAllItems:()=>t.exportAllItems(),importTags:n=>t.importTags(n),importItems:n=>t.importItems(n),importTemplates:n=>t.importTemplates(n),importSingleItem:(n,e)=>t.importSingleItem(n,e),importAllFromZip:n=>t.importAllFromZip(n),importAllFromJSON:n=>t.importAllFromJSON(n),createNode:(n,e,i,o)=>t.createNode(n,e,i,o),renameNode:(n,e,i)=>t.renameNode(n,e,i),deleteNode:(n,e)=>t.deleteNode(n,e),moveNode:(n,e,i)=>t.moveNode(n,e,i)}}function _t(t,n){const e=JSON.stringify(t,null,2);!function(t,n){const e=URL.createObjectURL(t),i=document.createElement("a");i.href=e,i.download=n,i.click(),URL.revokeObjectURL(e);}(new Blob([e],{type:"application/json"}),n);}function It(t){return new Promise((n,e)=>{const i=new FileReader;i.onload=t=>{var i;try{const e=JSON.parse(null==(i=t.target)?void 0:i.result);n(e);}catch(o){e(Error("无效的 JSON 格式"));}},i.onerror=()=>e(Error("文件读取失败")),i.readAsText(t);})}function Mt(t,n){const e=document.createElement("input");e.type="file",e.accept=t,e.onchange=t=>{var e;const i=null==(e=t.target.files)?void 0:e[0];i&&n(i);},e.click();}const Bt={class:"modal-content"},Et=["innerHTML"],St=["innerHTML"],jt={class:"sidebar-content"},At=H(defineComponent({_:"App",props:{api:{},itemId:{}},setup(t){const n=t,e=defineAsyncComponent(()=>O(()=>module.import('./TagTab-BWhxAzYP-BU1Pytah.js'),void 0)),l=defineAsyncComponent(()=>O(()=>module.import('./ItemTab-DUKS-646-D6sp1L6a.js'),void 0)),d=defineAsyncComponent(()=>O(()=>module.import('./EditTab-R0NUwsoO-CPQSm_db.js'),void 0)),{data:m,exportTags:g,exportItems:v,exportTemplates:f,exportAllItems:b,importAllFromJSON:k,importTags:B,importItems:E,exportSingleItem:S,importSingleItem:j}=Ct();function A(){switch(m.value.ui.activeTab){case "tags":default:return e;case "items":return l;case "edit":return d}}const L=ref(null);function z(t){"edit"===m.value.ui.activeTab&&(L.value=t);}async function D(){if(L.value)try{await L.value.applyAll();}catch(t){}else Tt.error("EditTab 未加载");}const V=ref(null),N=ref(false),P=ref({x:0,y:0}),F=ref(false),H=ref(null),J=[{id:"tags",label:"标签"},{id:"items",label:"商品"},{id:"edit",label:"编辑"}];watch(()=>m.value.ui.sidebarOpen,t=>{const n=document.getElementById("booth-enhancer-panel-root"),e=document.querySelector(".booth-enhancer-toggle");n&&(t?n.classList.add("panel-open"):n.classList.remove("panel-open")),e&&(e.innerHTML=t?U.chevronRight:U.chevronLeft);});const R=()=>{m.value.ui.sidebarOpen=false;},Y=t=>{m.value.ui.activeTab=t;};function X(){return (new Date).toISOString().slice(0,10)}const K=async()=>{try{_t({version:"1.0",exportTime:Date.now(),data:{tags:g(),items:v(),templates:f(),itemConfigs:b()}},`booth-backup-${X()}.json`),Tt.success("导出成功");}catch(t){Tt.error("导出失败："+t.message);}},W=()=>{Mt(".json,application/json",async t=>{try{const n=await It(t);k(n),Tt.success("导入成功");}catch(n){Tt.error("导入失败："+n.message);}});},Z=t=>{const n=t.currentTarget.getBoundingClientRect();P.value={x:n.left-100,y:n.bottom+4},N.value=!N.value;},Q=()=>{N.value=false;};function tt(){const t=m.value.ui.activeTab;if("edit"!==t)try{const n=X();_t("tags"===t?g():v(),`booth-${t}-${n}.json`),Tt.success(it.value+"数据导出成功");}catch(n){Tt.error("导出失败："+n.message);}}function et(){const t=m.value.ui.activeTab;"edit"!==t&&Mt(".json,application/json",async n=>{try{const e=await It(n);"tags"===t?B(e):E(e),Tt.success(it.value+"数据导入成功");}catch(e){Tt.error("导入失败："+e.message);}});}const it=computed(()=>{switch(m.value.ui.activeTab){case "tags":return "标签";case "items":return "商品";case "edit":return "编辑";default:return ""}});function ot(){if(n.itemId)try{const t=S(n.itemId);if(!t)return void Tt.error("当前商品没有配置数据");const e=X();_t(t,`booth-item-${n.itemId}-${e}.json`),Tt.success("商品配置导出成功");}catch(t){Tt.error("导出失败："+t.message);}else Tt.error("无法获取当前商品ID");}function st(){Mt(".json,application/json",async t=>{try{const n=await It(t);j(n,{replace:!1})?Tt.success("商品配置导入成功"):(H.value=n,F.value=!0);}catch(n){Tt.error("导入失败："+n.message);}});}function rt(){H.value&&(j(H.value,{replace:true}),Tt.success("商品配置导入成功")),F.value=false,H.value=null;}function at(){F.value=false,H.value=null;}const ct=computed(()=>{const t="edit"===m.value.ui.activeTab;return [{label:"导出完整备份 (JSON)",icon:G(U.upload,14),action:K},{label:"导入完整备份 (JSON)",icon:G(U.download,14),action:W},{label:"-",icon:"",action:()=>{}},{label:t?"导出当前商品 (JSON)":`导出${it.value}数据 (JSON)`,icon:G(U.upload,14),action:t?ot:tt},{label:t?"导入商品配置 (JSON)":`导入${it.value}数据 (JSON)`,icon:G(U.download,14),action:t?st:et}]});return onMounted(()=>{V.value&&Tt.setContainer(V.value);}),onUnmounted(()=>{Tt.setContainer(null);}),(t,e)=>(openBlock(),createElementBlock("div",{ref_key:"sidebarRef",ref:V,class:"booth-enhancer-sidebar"},[createVNode(unref(lt),{"active-tab":unref(m).ui.activeTab,tabs:J,"onUpdate:activeTab":Y},{actions:withCtx(()=>["edit"===unref(m).ui.activeTab?(openBlock(),createBlock(unref(q),{key:0,icon:unref(U).send,title:"应用所有",onClick:D},null,8,["icon"])):createCommentVNode("",true),createVNode(unref(q),{icon:unref(U).moreVertical,title:"更多操作",onClick:Z},null,8,["icon"]),createVNode(unref(q),{icon:unref(U).close,title:"关闭",onClick:R},null,8,["icon"])]),I:1},8,["active-tab"]),createVNode($,{show:N.value,x:P.value.x,y:P.value.y,items:ct.value,onClose:Q},null,8,["show","x","y","items"]),createVNode(unref(nt),{show:F.value,title:"导入确认","teleport-to":".booth-enhancer-sidebar",onClose:at,width:"400px"},{footer:withCtx(()=>[createElementVNode("button",{class:"booth-btn booth-btn-md booth-btn-icon booth-btn-secondary",onClick:at,title:"取消"},[createElementVNode("span",{innerHTML:unref(G)(unref(U).close,18)},null,8,Et)]),createElementVNode("button",{class:"booth-btn booth-btn-md booth-btn-icon booth-btn-danger",onClick:rt,title:"替换"},[createElementVNode("span",{innerHTML:unref(G)(unref(U).check,18)},null,8,St)])]),default:withCtx(()=>{var t;return [createElementVNode("div",Bt,[createElementVNode("p",null,[e[0]||(e[0]=createTextVNode("商品 ID ",-1)),createElementVNode("strong",null,toDisplayString(null==(t=H.value)?void 0:t.itemId),1),e[1]||(e[1]=createTextVNode(" 已存在配置。",-1))]),e[2]||(e[2]=createElementVNode("p",null,"是否要替换现有配置？",-1))])]}),I:1},8,["show"]),createElementVNode("div",jt,[(openBlock(),createBlock(resolveDynamicComponent(A()),{ref:z,key:unref(m).ui.activeTab+"-"+Date.now(),api:n.api},null,8,["api"]))])],512))}}),[["__scopeId","data-v-2b9f00bf"]]);class Lt{constructor(t){n(this,"api"),this.api=t,this.api.onReady(t=>{this.initialize(t);});}}class zt extends Lt{constructor(t){super(t);}initialize(){this.enhanceFilePanel();}enhanceFilePanel(){const t=this.findFilePanel();if(!t)return;if(t.hasAttribute("data-file-manager-enhanced"))return;t.setAttribute("data-file-manager-enhanced","true");const n=t.querySelector(".font-heavy-sans.text-\\[14px\\]");n&&this.addActionButtons(n);}findFilePanel(){var t;const n=document.querySelectorAll(".font-booth-demi");for(const e of Array.from(n))if(null==(t=e.textContent)?void 0:t.includes("Add/Edit Files"))return e.closest(".bg-white");return null}addActionButtons(t){var n;const e=document.createElement("div");e.className="flex gap-8 py-12 px-16 border-b border-b-border300",e.style.cssText="background: #f8f9fa;";const i=document.createElement("button");i.type="button",i.className="btn calm small",i.textContent="全选",i.onclick=()=>this.selectAllFiles();const o=document.createElement("button");o.type="button",o.className="btn calm small",o.textContent="全不选",o.onclick=()=>this.unselectAllFiles(),e.appendChild(i),e.appendChild(o),null==(n=t.parentElement)||n.insertBefore(e,t.nextSibling);}selectAllFiles(){this.setAllCheckboxes(true);}unselectAllFiles(){this.setAllCheckboxes(false);}setAllCheckboxes(t){const n=document.querySelectorAll('ul.list-none input.charcoal-checkbox-input[type="checkbox"]');Array.from(n).forEach(n=>{const e=n;e.checked!==t&&E.click(e);});}}class Ot extends Lt{constructor(t){super(t),n(this,"_observedContainers");}get observedContainers(){return this.B||(this.B=new WeakMap),this.B}initialize(t){const n=new Set;t.sections.forEach(t=>n.add(t.container)),t.variations.forEach(t=>n.add(t.container)),n.forEach(t=>{this.addNumbersToList(t);}),t.onSectionAdded(t=>{this.observedContainers.has(t.container)||this.addNumbersToList(t.container);}),t.onVariationAdded(t=>{this.observedContainers.has(t.container)||this.addNumbersToList(t.container);});}addNumbersToList(t){Array.from(t.children).filter(t=>"li"===t.tagName.toLowerCase()).forEach((t,n)=>{this.addNumberToItem(t,n+1);}),this.setupListObserver(t);}addNumberToItem(t,n){const e=t.querySelector(".variation-number");null==e||e.remove();const i=t.querySelector(".variation-box-head .flex.items-center.gap-4");if(!i)return;const o=document.createElement("span");o.className="variation-number typography-14 inline-block font-semibold",o.style.cssText="margin-right: 8px; color: #666;",o.textContent="#"+n,i.insertBefore(o,i.firstChild);}setupListObserver(t){const n=this.observedContainers.get(t);n&&n.disconnect();const e=new MutationObserver(()=>{Array.from(t.children).filter(t=>"li"===t.tagName.toLowerCase()).forEach((t,n)=>{this.addNumberToItem(t,n+1);});});e.observe(t,{childList:true,subtree:false}),this.observedContainers.set(t,e);}}function Dt(t,n){if(n)try{n();}catch(e){}}class Vt{static throttle(t,n){const e=t.toString();if(!this.throttleCache.has(e)){let i;const o=function(...e){i||(t.apply(this,e),i=true,setTimeout(()=>i=false,n));};this.throttleCache.set(e,o);}return this.throttleCache.get(e)}static sleep(t){return new Promise(n=>setTimeout(n,t))}static async waitForDOMReady(){"loading"===document.readyState&&await new Promise(t=>document.addEventListener("DOMContentLoaded",t));}static updateButtonState(t,n=true,e){if(!t)return;const i=n?'<i class="icon-check"></i><span class="cmd-label">已完成</span>':e;t.innerHTML=i,t.classList.toggle("calm",!n),t.classList.toggle("primary",n),n&&setTimeout(()=>{t.innerHTML=e,t.classList.add("calm"),t.classList.remove("primary");},1e3);}}n(Vt,"throttleCache",new Map);class Nt extends Lt{constructor(t){super(t);}initialize(t){this.waitForTagContainer(t);}waitForTagContainer(t){const n=t.tagElements;if(n)return void this.addTagButtons(n.inputContainer);const e=new MutationObserver(()=>{const n=t.tagElements;n&&(this.addTagButtons(n.inputContainer),e.disconnect());});e.observe(document.body,{childList:true,subtree:true});}addTagButtons(t){if(t.querySelector(".tag-action-buttons"))return;const n=document.createElement("div");n.className="flex gap-2 tag-action-buttons",n.style.cssText="\n            align-items: center;\n            position: absolute;\n            right: 8px;\n            top: 50%;\n            transform: translateY(-50%);\n        ";const e=document.createElement("a");e.className="btn calm small",e.innerHTML="复制标签",e.onclick=()=>this.copyTags();const i=document.createElement("a");i.className="btn calm small",i.innerHTML="粘贴标签",i.onclick=()=>this.pasteTags();const o=document.createElement("a");o.className="btn calm small",o.innerHTML="清空标签",o.onclick=()=>this.clearTags(),n.appendChild(e),n.appendChild(i),n.appendChild(o),t.appendChild(n);}copyTags(){try{const t=this.api.getTagTexts();if(0===t.length)return void Tt.warning("没有找到标签");navigator.clipboard.writeText(JSON.stringify(t)).then(()=>{const t=document.querySelector(".tag-action-buttons .btn:first-child");t instanceof HTMLElement&&Vt.updateButtonState(t,!0,t.innerHTML);});}catch(t){Dt();}}async pasteTags(){try{const n=await navigator.clipboard.readText(),e=JSON.parse(n);if(!Array.isArray(e)||0===e.length)throw Error("无效的标签数据");const i=this.api.tagElements;if(!i)throw Error("找不到标签容器");const{input:o,container:s}=i,r=this.api.getTagTexts(),a=e.filter(t=>!r.includes(t));if(0===a.length)return void Tt.info("所有标签都已存在，无需添加");const l=this.createProgressTip(s);try{for(let n=0;n<a.length;n++)l.updateProgress(n+1,a.length),o.focus(),E.input(o,a[n]),await Vt.sleep(1),E.pressEnter(o),await Vt.sleep(1);l.complete(`处理完成！已添加 ${a.length} 个新标签，跳过 ${e.length-a.length} 个已存在的标签。`);const t=document.querySelector(".tag-action-buttons .btn:nth-child(2)");t instanceof HTMLElement&&Vt.updateButtonState(t,!0,t.innerHTML);}catch(t){throw l.remove(),t}}catch(t){Dt(0,()=>{Tt.error("粘贴标签失败："+(t instanceof Error?t.message:t+""));});}}async clearTags(){try{if(!window.confirm("确定要清空所有标签吗？"))return;const n=this.api.tagElements;if(!n)throw Error("找不到标签容器");const e=this.api.getTagDeleteButtons();if(0===e.length)return void Tt.warning("没有找到需要清空的标签");const i=this.createProgressTip(n.container);try{for(let n=e.length-1;n>=0;n--)i.updateProgress(e.length-n,e.length),e[n].click(),await Vt.sleep(1);i.complete(`处理完成！已清空 ${e.length} 个标签。`);const t=document.querySelector(".tag-action-buttons .btn:nth-child(3)");t instanceof HTMLElement&&Vt.updateButtonState(t,!0,t.innerHTML);}catch(t){throw i.remove(),t}}catch(t){Dt();}}createProgressTip(t){const n=document.createElement("div");n.style.cssText="\n            margin-bottom: 12px;\n            background: #f5f7fa;\n            border-radius: 4px;\n            padding: 12px;\n            position: relative;\n        ";const e=document.createElement("div");e.style.cssText="color: #666; font-size: 14px; margin-bottom: 8px;";const i=document.createElement("div");i.style.cssText="\n            background: #e4e7ed;\n            height: 6px;\n            border-radius: 3px;\n            overflow: hidden;\n        ";const o=document.createElement("div");o.style.cssText="\n            width: 0%;\n            height: 100%;\n            background: #409EFF;\n            transition: width 0.3s ease;\n            border-radius: 3px;\n        ",i.appendChild(o),n.appendChild(e),n.appendChild(i);const s=t.querySelector(".item-search-input__container");return (null==s?void 0:s.parentElement)?s.parentElement.insertBefore(n,s):t.insertBefore(n,t.firstChild),{container:n,progressBar:o,textElement:e,updateProgress:(t,n,i)=>{const s=t/n*100;o.style.width=s+"%",e.textContent=i||`处理中... (${t}/${n})`;},complete:t=>{o.style.width="100%",o.style.background="#67C23A",e.textContent=t,setTimeout(()=>n.remove(),2e3);},remove:()=>n.remove()}}}class Pt extends A{constructor(t){super(t),n(this,"modules",[]),n(this,"app",null),n(this,"container",null),n(this,"toggleBtn",null);}shouldExecute(){const t=window.location.pathname;return /^\/items\/\d+\/edit(_pre)?$/.test(t)}createAPI(){return new j}async initialize(){this.api&&(this.modules.push(new Ot(this.api),new Nt(this.api),new zt(this.api)),this.injectStyles(),this.createToggleButton(),this.createPanelContainer(),this.mountVueApp());}injectStyles(){if(document.querySelector("#booth-enhancer-styles"))return;const t=document.createElement("style");t.id="booth-enhancer-styles",t.textContent="\n            .booth-enhancer-toggle {\n                position: fixed;\n                right: 0;\n                top: 50%;\n                transform: translateY(-50%);\n                width: 30px;\n                height: 60px;\n                background: rgba(255, 255, 255, 0.95);\n                border: 1px solid #e0e0e0;\n                border-right: none;\n                border-radius: 8px 0 0 8px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                box-shadow: -2px 0 4px rgba(0, 0, 0, 0.1);\n                cursor: pointer;\n                transition: all 0.2s ease;\n                z-index: 999;\n                font-size: 12px;\n                color: #666;\n                user-select: none;\n            }\n\n            .booth-enhancer-toggle:hover {\n                background: #f8f9fa;\n                box-shadow: -2px 0 6px rgba(0, 0, 0, 0.15);\n            }\n\n            #booth-enhancer-panel-root {\n                position: fixed;\n                top: 50%;\n                right: 0;\n                transform: translateY(-50%) translateX(100%);\n                width: 400px;\n                min-width: 300px;\n                max-width: 500px;\n                height: 80vh;\n                max-height: 80vh;\n                z-index: 1000;\n                transition: transform 0.3s ease;\n                pointer-events: none;\n                box-sizing: border-box;\n            }\n\n            #booth-enhancer-panel-root.panel-open {\n                transform: translateY(-50%) translateX(0);\n                pointer-events: auto;\n            }\n\n            @media (max-width: 768px) {\n                #booth-enhancer-panel-root {\n                    width: 100%;\n                    max-width: 400px;\n                    height: 70vh;\n                    max-height: 70vh;\n                }\n                \n                .booth-enhancer-toggle {\n                    width: 40px;\n                    height: 60px;\n    }\n            }\n\n            @media (max-width: 480px) {\n                #booth-enhancer-panel-root {\n                    width: 100%;\n                    height: 85vh;\n                    max-height: 85vh;\n                }\n            }\n        ",document.head.appendChild(t);}updateSidebarState(t,n,e){this.toggleBtn&&(this.toggleBtn.innerHTML=t?n:e),this.container&&this.container.classList.toggle("panel-open",t);}createToggleButton(){this.toggleBtn=document.createElement("div"),this.toggleBtn.className="booth-enhancer-toggle",this.toggleBtn.title="配置面板";const t=G(U.chevronLeft,20,2.5),n=G(U.chevronRight,20,2.5);this.toggleBtn.innerHTML=t,this.toggleBtn.addEventListener("click",()=>{const e=kt.getInstance(),i=!e.data.value.ui.sidebarOpen;e.data.value.ui.sidebarOpen=i,this.updateSidebarState(i,n,t);}),document.body.appendChild(this.toggleBtn);}createPanelContainer(){this.container=document.createElement("div"),this.container.id="booth-enhancer-panel-root";const t=kt.getInstance().data.value.ui.sidebarOpen;if(t){const n=G(U.chevronRight,20,2.5),e=G(U.chevronLeft,20,2.5);this.updateSidebarState(t,n,e);}document.body.appendChild(this.container);}mountVueApp(){if(!this.container||!this.api)return;const t=window.location.pathname.match(/\/items\/(\d+)\/edit/),n=t?t[1]:"";this.app=createApp(At,{api:this.api,itemId:n}),this.app.mount(this.container);}}class Ft{extractId(t){var n;const e=t.getAttribute("data-id");if(e)return e;const i=((null==(n=t.querySelector(".nav"))?void 0:n.getAttribute("href"))||"").match(/\/items\/(\d+)/);return i?i[1]:""}parseVariations(t){const n=[];return t.querySelectorAll(".dashboard-items-variation .row").forEach(t=>{var e,i,o,s;const r=t.querySelector(".dashboard-items-variation-label");let a="";if(r){const t=r.textContent||"",n=t.match(/#\d+\s*(.+)/);a=n?n[1].trim():t.trim();}const l=t.querySelector(".price"),c=(null==(e=null==l?void 0:l.textContent)?void 0:e.trim())||"0",d=parseInt(c.replace(/[^\d]/g,""),10)||0,h=(null==(o=null==(i=t.querySelector(".sales_quantity .count"))?void 0:i.textContent)?void 0:o.trim())||"0",u=parseInt(h,10)||0,p=t.querySelector(".sales_subtotal"),m=(null==(s=null==p?void 0:p.textContent)?void 0:s.trim())||"0",g=parseInt(m.replace(/[^\d]/g,""),10)||0;n.push({data:{name:a,price:d,salesCount:u,revenue:g},element:t});}),n}parseTags(t){const n=[];return t.querySelectorAll(".dashboard-items-tags li").forEach(t=>{var e;const i=t.querySelector(".tag-text"),o=null==(e=null==i?void 0:i.textContent)?void 0:e.trim();o&&n.push({text:o,element:t});}),n}parseItem(t){var n,e,i,o;try{const s=this.extractId(t);if(!s)return null;const r=(null==(e=null==(n=t.querySelector(".nav"))?void 0:n.textContent)?void 0:e.trim())||"",a=(null==(i=t.querySelector(".nav"))?void 0:i.getAttribute("href"))||"",l=(null==(o=t.querySelector(".thumbnail img"))?void 0:o.src)||"",c=this.parseTags(t).map(t=>t.text),d=this.parseVariations(t).map(t=>t.data),h=t.querySelector(".item-stat.favs .count");return {id:s,name:r,url:a,thumbnail:l,tags:c,variations:d,favoritesCount:h&&parseInt(h.textContent||"0",10)||0}}catch(s){return null}}}class Ht extends S{constructor(){super(),n(this,"_items",[]),n(this,"_parser"),this.S=new Ft;}shouldActivate(){const t=window.location.pathname;return ("/items"===t||"/items/"===t)&&!t.match(/\/items\/\d+\/(edit|edit_pre)/)}waitForElements(t=5e3){return new Promise((n,e)=>{if(document.querySelector(".item-wrapper"))return void n();const i=setTimeout(()=>{o.disconnect(),e(Error("等待商品元素超时"));},t),o=new MutationObserver(()=>{document.querySelector(".item-wrapper")&&(clearTimeout(i),o.disconnect(),n());});o.observe(document.body,{childList:true,subtree:true});})}async load(){await this.waitForElements(),this.j=[],document.querySelectorAll(".item-wrapper").forEach(t=>{const n=t,e=this.S.parseItem(t);if(e){const t=n.querySelector(".dashboard-items-variation"),i=n.querySelector(".dashboard-items-tags"),o=this.S.parseVariations(n),s=this.S.parseTags(n);this.j.push({data:e,element:n,variationsUl:t,tagsUl:i,variations:o,tags:s});}});}getItems(){return [...this.j]}getItemsData(){return this.j.map(t=>t.data)}getItem(t){return this.j.find(n=>n.data.id===t)}getItemData(t){var n;return null==(n=this.j.find(n=>n.data.id===t))?void 0:n.data}getItemElement(t){var n;return null==(n=this.j.find(n=>n.data.id===t))?void 0:n.element}refresh(){this.load();}async copyItemTags(t){const n=this.getItem(t);if(!n)return  false;const e=n.data.tags;if(0===e.length)return alert("没有找到标签"),false;try{return await navigator.clipboard.writeText(JSON.stringify(e)),!0}catch(i){return  false}}}class $t extends Lt{constructor(t){super(t);}initialize(t){t.getItems().forEach(t=>{this.addToItem(t.element);});}addToItem(t){try{if(t.querySelector(".tag-copy-btn")||t.querySelector(".item-delete-btn-x"))return;this.addDeleteButton(t),this.addCopyTagsButton(t);}catch(n){Dt();}}addDeleteButton(t){const n=t.getAttribute("data-id");if(!n)return;const e=document.createElement("button");e.className="item-delete-btn-x",e.innerHTML='\n            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path d="M12 4L4 12M4 4L12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n            </svg>\n        ',e.title="删除商品",e.onclick=async e=>{e.preventDefault(),await this.handleDeleteItem(t,n);},"static"===getComputedStyle(t).position&&(t.style.position="relative"),this.injectDeleteButtonStyles(),t.appendChild(e);}injectDeleteButtonStyles(){if(document.getElementById("item-delete-btn-styles"))return;const t=document.createElement("style");t.id="item-delete-btn-styles",t.textContent="\n            .item-delete-btn-x {\n                position: absolute;\n                top: 8px;\n                right: 8px;\n                z-index: 10;\n                width: 28px;\n                height: 28px;\n                padding: 0;\n                border: none;\n                border-radius: 50%;\n                background-color: #fff;\n                color: #666;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n                transition: all 0.2s ease;\n            }\n\n            .item-delete-btn-x svg {\n                width: 16px;\n                height: 16px;\n                display: block;\n            }\n\n            .item-delete-btn-x:hover {\n                background-color: #ff5252;\n                color: #fff;\n                box-shadow: 0 4px 8px rgba(255, 82, 82, 0.3);\n                transform: scale(1.1);\n            }\n\n            .item-delete-btn-x:active {\n                transform: scale(0.95);\n            }\n        ",document.head.appendChild(t);}addCopyTagsButton(t){const n=t.querySelector(".dashboard-items-tags"),e=t.querySelector(".dashboard-item-footer-actions"),i=t.getAttribute("data-id");if(n&&e&&i){const t=document.createElement("a");t.className="btn calm small tag-copy-btn mr-8",t.innerHTML="复制标签",t.onclick=async n=>{n.preventDefault(),await this.api.copyItemTags(i)&&Vt.updateButtonState(t,true,t.innerHTML);},e.insertBefore(t,e.firstChild);}}async handleDeleteItem(t,n){var e,i,o;try{if(!confirm("确定要删除这个商品吗？此操作不可恢复。"))return;const s=(null==(i=null==(e=t.querySelector(".nav"))?void 0:e.textContent)?void 0:i.trim())||"未知商品";if(!confirm(`再次确认删除商品：\n${s}\nID: ${n}`))return;const r=null==(o=document.querySelector('meta[name="csrf-token"]'))?void 0:o.getAttribute("content");if(!r)throw Error("无法获取CSRF token");const a=await fetch("https://manage.booth.pm/items/"+n,{method:"DELETE",headers:{accept:"application/json, text/javascript, */*; q=0.01","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","x-requested-with":"XMLHttpRequest","x-csrf-token":r},referrer:window.location.href,referrerPolicy:"strict-origin-when-cross-origin",mode:"cors",credentials:"include"});if(!a.ok){const t=await a.text();throw Error(`删除失败: ${a.status}\n${t}`)}t.remove();}catch(s){Dt(0,()=>{alert("删除商品失败，请刷新页面重试");});}}}class Jt extends Lt{constructor(t){super(t),n(this,"_processedItems"),n(this,"stylesInjected",false);}get processedItems(){return this.A||(this.A=new Set),this.A}initialize(t){this.injectStyles(),t.getItems().forEach(t=>{this.addToItem(t);});}addToItem(t){var n,e;try{const{element:i,variationsUl:o,tagsUl:s,variations:r}=t;if(this.processedItems.has(i))return;this.processedItems.add(i);const a=[];if(o&&r.length>0&&!(null==(n=o.previousElementSibling)?void 0:n.classList.contains("item-collapse-header"))){const n=this.createVariationHeader(t);a.push({header:n,target:o});}if(s&&t.tags.length>0&&!(null==(e=s.previousElementSibling)?void 0:e.classList.contains("item-collapse-header"))){const t=this.createTagHeader(s);a.push({header:t,target:s});}a.forEach(({header:t,target:n})=>{var e;null==(e=n.parentElement)||e.insertBefore(t,n),n.classList.add("item-collapsible","collapsed");});}catch(i){Dt();}}setupCollapseToggle(t,n){const e=t.querySelector(".item-collapse-icon");let i=true;t.onclick=()=>{i=!i,n.classList.toggle("collapsed",i),e.classList.toggle("collapsed",i);};}createBaseHeader(t,n){const e=document.createElement("div");e.className="item-collapse-header";const i=document.createElement("div");if(i.className="item-collapse-title",i.innerHTML=`\n            <span class="item-collapse-icon collapsed">▼</span>\n            <span>${t}</span>\n        `,e.appendChild(i),n){const t=document.createElement("div");t.className="item-collapse-badges",t.innerHTML=n,e.appendChild(t);}return e}createVariationHeader(t){const{variations:n,variationsUl:e}=t,i=`\n            <span class="item-badge item-badge-count">变体: <strong>${n.length}</strong></span>\n            <span class="item-badge item-badge-sales">销量: <strong>${n.reduce((t,n)=>t+n.data.salesCount,0)}</strong></span>\n            <span class="item-badge item-badge-revenue">收益: <strong>${n.reduce((t,n)=>t+n.data.revenue,0).toLocaleString()}</strong></span>\n        `,o=this.createBaseHeader("变体列表",i);return this.setupCollapseToggle(o,e),o}createTagHeader(t){const n=this.createBaseHeader("标签列表");return this.setupCollapseToggle(n,t),n}injectStyles(){if(this.stylesInjected)return;this.stylesInjected=true;const t=document.createElement("style");t.id="booth-item-collapse-styles",t.textContent="\n            /* 折叠图标样式 */\n            .item-collapse-icon {\n                display: inline-flex;\n                align-items: center;\n                justify-content: center;\n                width: 16px;\n                height: 16px;\n                margin-right: 6px;\n                font-size: 10px;\n                color: #666;\n                flex-shrink: 0;\n                transition: transform 0.2s ease;\n            }\n\n            .item-collapse-icon.collapsed {\n                transform: rotate(-90deg);\n            }\n\n            /* 折叠容器样式 - 使用 GPU 加速属性 */\n            .item-collapsible {\n                overflow: hidden;\n                max-height: 5000px;\n                will-change: max-height, opacity; /* 提示浏览器优化 */\n                contain: layout style paint; /* 限制重排范围 */\n            }\n\n            .item-collapsible.collapsed {\n                max-height: 0 !important;\n                opacity: 0;\n                margin-top: 0 !important;\n                margin-bottom: 0 !important;\n                padding-top: 0 !important;\n                padding-bottom: 0 !important;\n                /* 使用 transform 代替部分属性，GPU 加速 */\n                transform: translateZ(0);\n            }\n\n            /* 折叠标题容器 */\n            .item-collapse-header {\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                padding: 8px 12px;\n                margin-bottom: 8px;\n                font-weight: 500;\n                font-size: 13px;\n                color: #333;\n                user-select: none;\n                border-bottom: 1px solid #e0e0e0;\n                cursor: pointer;\n                transition: background-color 0.2s ease;\n                gap: 12px;\n            }\n            \n            .item-collapse-header:hover {\n                background-color: #f5f5f5;\n            }\n            \n            .item-collapse-header:first-of-type {\n                margin-top: 8px;\n            }\n\n            /* 标题部分 */\n            .item-collapse-title {\n                display: flex;\n                align-items: center;\n                flex-shrink: 0;\n            }\n\n            /* Badges 容器 */\n            .item-collapse-badges {\n                display: flex;\n                align-items: center;\n                gap: 8px;\n                margin-left: auto;\n                flex-wrap: wrap;\n                justify-content: flex-end;\n            }\n\n            /* Badge 基础样式 */\n            .item-badge {\n                display: inline-flex;\n                align-items: center;\n                padding: 4px 10px;\n                font-size: 11px;\n                font-weight: 400;\n                border-radius: 12px;\n                white-space: nowrap;\n            }\n\n            .item-badge strong {\n                font-weight: 600;\n            }\n\n            /* Badge 变体数量 */\n            .item-badge-count {\n                background-color: #e3f2fd;\n                color: #1976d2;\n            }\n\n            /* Badge 销量 */\n            .item-badge-sales {\n                background-color: #f3e5f5;\n                color: #7b1fa2;\n            }\n\n            /* Badge 收益 */\n            .item-badge-revenue {\n                background-color: #e8f5e9;\n                color: #388e3c;\n            }\n        ",document.head.appendChild(t);}}class Rt extends Lt{constructor(t){super(t),n(this,"navigationContainer",null),n(this,"toggleButton",null),n(this,"items",[]),n(this,"isExpanded",false),n(this,"searchInput",null),n(this,"filteredItems",[]),n(this,"isScrolling",false),n(this,"scrollTimeout",null),n(this,"hoverTimeout",null);}initialize(t){this.items=t.getItems(),this.injectStyles(),setTimeout(()=>{this.createNavigation();},1e3);}createNavigation(){try{if(document.querySelector(".item-navigation"))return;if(0===this.items.length)return;this.injectStyles(),this.createToggleButton(),this.createNavigationContainer(),this.createNavigationItems(),this.setupScrollListener();}catch(t){Dt();}}injectStyles(){if(document.querySelector("#booth-navigation-styles"))return;const t=document.createElement("style");t.id="booth-navigation-styles",t.textContent="\n            .navigation-toggle-button {\n            position: fixed;\n            right: 0;\n            top: 50%;\n            transform: translateY(-50%);\n                width: 30px;\n                height: 60px;\n            background: rgba(255, 255, 255, 0.95);\n            border: 1px solid #e0e0e0;\n            border-right: none;\n            border-radius: 8px 0 0 8px;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            box-shadow: -2px 0 4px rgba(0, 0, 0, 0.1);\n            cursor: pointer;\n            transition: all 0.2s ease;\n                z-index: 999;\n                font-size: 12px;\n                color: #666;\n            }\n\n            .navigation-toggle-button:hover {\n                background: #f8f9fa;\n                box-shadow: -2px 0 6px rgba(0, 0, 0, 0.15);\n            }\n\n            .item-navigation {\n                position: fixed;\n                top: 50%;\n                right: 0;\n                transform: translateY(-50%) translateX(100%);\n                width: 400px;\n                min-width: 300px;\n                max-width: 500px;\n                height: 80vh;\n                max-height: 80vh;\n                z-index: 1000;\n                transition: transform 0.3s ease;\n                pointer-events: none;\n                box-sizing: border-box;\n            }\n\n            .item-navigation.expanded {\n                transform: translateY(-50%) translateX(0);\n            }\n\n            .navigation-content {\n            width: 100%;\n            height: 100%;\n            background: rgba(255, 255, 255, 0.98);\n            border: 1px solid #e0e0e0;\n            border-radius: 12px 0 0 12px;\n            box-shadow: -4px 0 12px rgba(0, 0, 0, 0.1);\n            display: flex;\n            flex-direction: column;\n            overflow: hidden;\n                pointer-events: auto;\n            }\n\n            /* 导航项样式 */\n            .navigation-item {\n                padding: 6px 8px;\n                margin-bottom: 1px;\n                border-radius: 4px;\n                cursor: pointer;\n                transition: all 0.2s ease;\n                border-left: 2px solid transparent;\n                background: #fff;\n                border: 1px solid transparent;\n                display: flex;\n                align-items: flex-start;\n                gap: 8px;\n            }\n\n            /* 导航项hover效果 */\n            .navigation-item:hover:not(.active) {\n                background-color: #f8f9fa;\n                border-color: #e9ecef;\n            }\n\n            /* 导航项active状态 */\n            .navigation-item.active {\n                background-color: #e3f2fd !important;\n                border-left-color: #2196f3 !important;\n                border-color: #bbdefb !important;\n            }\n\n            /* PC端：hover显示（通过JavaScript处理，这里只处理样式） */\n            @media (hover: hover) and (pointer: fine) {\n                .item-navigation:hover {\n                    pointer-events: auto;\n                }\n            }\n\n            /* 移动端：点击切换 */\n            @media (max-width: 768px) {\n                .item-navigation {\n                    width: 100%;\n                    max-width: 400px;\n                    height: 70vh;\n                    max-height: 70vh;\n                }\n\n                .navigation-toggle-button {\n                    width: 40px;\n                    height: 60px;\n                }\n            }\n\n            /* 小屏幕移动端 */\n            @media (max-width: 480px) {\n                .item-navigation {\n                    width: 100%;\n                    height: 85vh;\n                    max-height: 85vh;\n                    top: 50%;\n                    transform: translateY(-50%) translateX(100%);\n                }\n\n                .item-navigation.expanded {\n                    transform: translateY(-50%) translateX(0);\n                }\n            }\n\n            /* 头部样式 */\n            .navigation-header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 12px 16px;\n            border-bottom: 1px solid #e0e0e0;\n            background: #f8f9fa;\n            flex-shrink: 0;\n                pointer-events: auto;\n            }\n\n            .navigation-header-title {\n            font-weight: 600;\n            color: #333;\n            font-size: 14px;\n            }\n\n            /* 关闭按钮样式 */\n            .navigation-close-button {\n                width: 24px;\n                height: 24px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                cursor: pointer;\n                color: #666;\n                font-size: 20px;\n                line-height: 1;\n                border-radius: 4px;\n                transition: all 0.2s ease;\n            }\n\n            .navigation-close-button:hover {\n                background-color: #e0e0e0;\n                color: #333;\n            }\n\n            /* 搜索容器样式 */\n            .navigation-search {\n            padding: 12px 16px;\n            border-bottom: 1px solid #e0e0e0;\n            background: #fff;\n            flex-shrink: 0;\n            width: 100%;\n                min-width: 0;\n                box-sizing: border-box;\n                display: block;\n            }\n\n            /* 搜索输入框样式 */\n            .navigation-search-input {\n                width: 100% !important;\n                height: 32px;\n            padding: 8px 12px;\n                margin: 0;\n            border: 1px solid #ddd;\n            border-radius: 6px;\n            font-size: 12px;\n            outline: none;\n            transition: border-color 0.2s;\n                box-sizing: border-box;\n                line-height: 1;\n                display: block;\n                max-width: none;\n                min-width: 0;\n            }\n\n            .navigation-search-input:focus {\n                border-color: #2196f3;\n            }\n\n            /* 列表容器样式 */\n            .navigation-items-container {\n            flex: 1;\n            overflow-y: auto;\n            padding: 4px;\n            min-height: 0;\n            scrollbar-width: thin;\n            scrollbar-color: #ccc #f5f5f5;\n            }\n\n            /* 空状态样式 */\n            .navigation-empty-state {\n                text-align: center;\n                color: #666;\n                padding: 20px;\n                font-style: italic;\n            }\n\n            /* 缩略图容器样式 */\n            .navigation-thumbnail {\n                width: 40px;\n                height: 40px;\n                flex-shrink: 0;\n                border-radius: 4px;\n                overflow: hidden;\n                background: #f5f5f5;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n\n            .navigation-thumbnail img {\n                width: 100%;\n                height: 100%;\n                object-fit: cover;\n            }\n\n            /* 商品信息容器样式 */\n            .navigation-item-info {\n                display: flex;\n                flex-direction: column;\n                gap: 2px;\n                flex: 1;\n                min-width: 0;\n            }\n\n            .navigation-item-name-row {\n                display: flex;\n                justify-content: space-between;\n                align-items: flex-start;\n                gap: 8px;\n            }\n\n            .navigation-item-name {\n                flex: 1;\n                margin-right: 6px;\n                font-weight: 500;\n                font-size: 11px;\n                line-height: 1.3;\n                word-wrap: break-word;\n                min-width: 0;\n            }\n\n            .navigation-item-variant-count {\n                color: #666;\n                font-size: 9px;\n                flex-shrink: 0;\n                background: #f0f0f0;\n                padding: 1px 4px;\n                border-radius: 8px;\n            }\n\n            .navigation-item-stats-row {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                font-size: 10px;\n                color: #666;\n            }\n\n            .navigation-item-stats-left {\n                display: flex;\n                gap: 8px;\n                align-items: center;\n            }\n\n            .navigation-item-sales {\n                font-weight: 500;\n            }\n\n            .navigation-item-sales.has-sales {\n                color: #28a745;\n            }\n\n            .navigation-item-sales.no-sales {\n                color: #999;\n            }\n\n            .navigation-item-favorites {\n                font-weight: 500;\n            }\n\n            .navigation-item-favorites.has-favorites {\n                color: #f48fb1;\n            }\n\n            .navigation-item-favorites.no-favorites {\n                color: #999;\n            }\n\n            .navigation-item-index {\n                color: #999;\n                font-size: 9px;\n            }\n        ",document.head.appendChild(t);}createToggleButton(){document.querySelector(".navigation-toggle-button")||(this.toggleButton=document.createElement("div"),this.toggleButton.className="navigation-toggle-button",this.toggleButton.innerHTML="◀",this.toggleButton.onclick=t=>{t.stopPropagation(),this.toggleNavigation();},this.toggleButton.onmouseenter=()=>{window.matchMedia("(hover: hover) and (pointer: fine)").matches&&this.showNavigation();},document.body.appendChild(this.toggleButton));}createNavigationContainer(){this.navigationContainer=document.createElement("div"),this.navigationContainer.className="item-navigation",this.createContentContainer(),document.body.appendChild(this.navigationContainer),this.setupPCHoverBehavior();}setupPCHoverBehavior(){this.navigationContainer&&this.toggleButton&&window.matchMedia("(hover: hover) and (pointer: fine)").matches&&(this.navigationContainer.onmouseenter=()=>{this.hoverTimeout&&(clearTimeout(this.hoverTimeout),this.hoverTimeout=null);},this.navigationContainer.onmouseleave=()=>{this.hoverTimeout&&clearTimeout(this.hoverTimeout),this.hoverTimeout=window.setTimeout(()=>{const t=this.toggleButton.getBoundingClientRect(),n=window.lastMouseX||0,e=window.lastMouseY||0;(n<t.left||n>t.right||e<t.top||e>t.bottom)&&this.hideNavigation();},200);},document.addEventListener("mousemove",t=>{window.lastMouseX=t.clientX,window.lastMouseY=t.clientY;}));}createContentContainer(){const t=document.createElement("div");t.className="navigation-content";const n=document.createElement("div");n.className="navigation-header";const e=document.createElement("div");e.className="navigation-header-title",e.textContent=`商品导航 (${this.items.length})`,n.appendChild(e);const i=document.createElement("div");i.className="navigation-close-button",i.innerHTML="×",i.onclick=()=>{this.hideNavigation();},n.appendChild(i);const o=document.createElement("div");o.className="navigation-search",this.searchInput=document.createElement("input"),this.searchInput.type="text",this.searchInput.className="navigation-search-input",this.searchInput.placeholder="搜索商品...",this.searchInput.oninput=()=>this.filterItems(),o.appendChild(this.searchInput);const s=document.createElement("div");if(s.className="navigation-items-container",!document.querySelector("#navigation-scrollbar-style")){const t=document.createElement("style");t.id="navigation-scrollbar-style",t.textContent="\n                .navigation-items-container::-webkit-scrollbar {\n                    width: 6px;\n                }\n                .navigation-items-container::-webkit-scrollbar-track {\n                    background: #f5f5f5;\n                    border-radius: 3px;\n                }\n                .navigation-items-container::-webkit-scrollbar-thumb {\n                    background: #ccc;\n                    border-radius: 3px;\n                }\n                .navigation-items-container::-webkit-scrollbar-thumb:hover {\n                    background: #999;\n                }\n            ",document.head.appendChild(t);}t.appendChild(n),t.appendChild(o),t.appendChild(s),this.navigationContainer.appendChild(t);}toggleNavigation(){this.navigationContainer&&(this.isExpanded=!this.isExpanded,this.isExpanded?this.showNavigation():this.hideNavigation());}showNavigation(){this.navigationContainer&&(this.navigationContainer.classList.add("expanded"),this.isExpanded=true,this.toggleButton&&(this.toggleButton.innerHTML="▶"));}hideNavigation(){this.navigationContainer&&(this.navigationContainer.classList.remove("expanded"),this.isExpanded=false,this.toggleButton&&(this.toggleButton.innerHTML="◀"));}createNavigationItems(){var t;if(!this.navigationContainer)return;const n=this.navigationContainer.querySelector(".navigation-items-container");if(!n)return;n.innerHTML="";const e=this.filteredItems.length>0?this.filteredItems:this.items;if(0===e.length){const e=document.createElement("div");return e.className="navigation-empty-state",e.textContent=(null==(t=this.searchInput)?void 0:t.value)?"未找到匹配的商品":"暂无商品",void n.appendChild(e)}e.forEach((t,e)=>{const{data:i,element:o,variations:s}=t,r=s.length,a=s.reduce((t,n)=>t+n.data.salesCount,0),l=i.favoritesCount,c=document.createElement("div");c.className="navigation-item",c.setAttribute("data-item-id",i.id);const d=document.createElement("div");if(d.className="navigation-thumbnail",i.thumbnail){const t=document.createElement("img");t.src=i.thumbnail,t.onerror=()=>{d.innerHTML='<div style="color: #999; font-size: 10px;">无图</div>';},d.appendChild(t);}else d.innerHTML='<div style="color: #999; font-size: 10px;">无图</div>';const h=document.createElement("div");h.className="navigation-item-info";const u=document.createElement("div");u.className="navigation-item-name-row";const p=document.createElement("span");p.className="navigation-item-name",p.textContent=i.name;const m=document.createElement("span");m.className="navigation-item-variant-count",m.textContent=r+"变体",u.appendChild(p),u.appendChild(m);const g=document.createElement("div");g.className="navigation-item-stats-row";const v=document.createElement("div");v.className="navigation-item-stats-left";const f=document.createElement("span");f.className="navigation-item-sales "+(a>0?"has-sales":"no-sales"),f.textContent="销量: "+a;const w=document.createElement("span");w.className="navigation-item-favorites "+(l>0?"has-favorites":"no-favorites"),w.innerHTML='<span style="color: inherit;">❤️</span> '+l,v.appendChild(f),v.appendChild(w);const x=document.createElement("span");x.className="navigation-item-index",x.textContent="#"+(e+1),g.appendChild(v),g.appendChild(x),h.appendChild(g),h.appendChild(u),c.appendChild(d),c.appendChild(h),c.onclick=()=>this.scrollToItem(o,c),n.appendChild(c);});}filterItems(){if(!this.searchInput)return;const t=this.searchInput.value.toLowerCase().trim();this.filteredItems=""===t?[]:this.items.filter(n=>{const{data:e}=n;return e.name.toLowerCase().includes(t)||e.id.includes(t)}),this.createNavigationItems();}scrollToItem(t,n){try{this.scrollTimeout&&clearTimeout(this.scrollTimeout),this.setActiveItem(n),this.isScrolling=!0,window.matchMedia("(max-width: 768px)").matches&&!this.isExpanded&&this.showNavigation(),t.scrollIntoView({behavior:"smooth",block:"center"}),this.scrollTimeout=window.setTimeout(()=>{this.highlightItem(t),this.setActiveItem(n),this.isScrolling=!1,this.scrollTimeout=null;},800);}catch(e){Dt();}}setActiveItem(t){var n;null==(n=this.navigationContainer)||n.querySelectorAll(".navigation-item").forEach(t=>{t.classList.remove("active");}),t.classList.add("active");}highlightItem(t){t.style.outline="2px solid #2196f3",t.style.outlineOffset="2px",t.style.transition="outline 0.3s ease",setTimeout(()=>{t.style.outline="",t.style.outlineOffset="";},3e3);}setupScrollListener(){let t=false;const n=()=>{if(!this.navigationContainer||this.isScrolling)return;const n=window.innerHeight;let e=null,i=1/0;if(Array.from(document.querySelectorAll(".item-wrapper")).forEach(t=>{const o=t.getBoundingClientRect();if(o.top<n&&o.bottom>0){const s=o.top+o.height/2,r=Math.abs(s-n/2);i>r&&(i=r,e=t);}}),e){const t=e.getAttribute("data-id");if(t){const n=this.navigationContainer.querySelector(`[data-item-id="${t}"]`);n instanceof HTMLElement&&this.setActiveItem(n);}}t=false;},e=()=>{t||(requestAnimationFrame(n),t=true);};window.addEventListener("scroll",e),this.scrollListener=e;}}class qt extends Lt{constructor(t){super(t);}initialize(t){t.getItems().forEach(t=>{this.addToItem(t);});}addToItem(t){try{const{element:n,variationsUl:e,variations:i}=t;if(!e||!i.length)return;this.addNumbersToVariations(i),this.setupVariationObserver(n,e,i);}catch(n){Dt();}}addNumbersToVariations(t){t.forEach((t,n)=>{const e=t.element.querySelector(".dashboard-items-variation-label");if(!e)return;let i=t.element.querySelector(".variation-number");i||(i=document.createElement("span"),i.className="variation-number",i.style.cssText="margin-right: 8px; color: #666;",e.insertBefore(i,e.firstChild)),i.textContent="#"+(n+1);});}setupVariationObserver(t,n,e){const i=new MutationObserver(Vt.throttle((t,n)=>{e.some((t,n)=>{const e=t.element.querySelector(".variation-number");return !e||e.textContent!=="#"+(n+1)})&&requestAnimationFrame(()=>this.addNumbersToVariations(e));},100));i.observe(n,{childList:true,subtree:false}),t.variationObserver=i;}}class Gt extends A{constructor(t){super(t),n(this,"modules",[]);}shouldExecute(){return "/items"===this.path||"/items/"===this.path}createAPI(){return new Ht}async initialize(){this.api&&this.modules.push(new Rt(this.api),new $t(this.api),new Jt(this.api),new qt(this.api));}}class Ut extends S{constructor(){super();}shouldActivate(){return  true}load(){}extractCookieInfo(t){var n,e;const i=t.split("\n").find(t=>t.toLowerCase().startsWith("set-cookie:")&&t.includes("_plaza_session_nktz7u="));if(!i)return null;const o=i.split(";")[0].split("=").slice(1).join("=").trim(),s=null==(e=null==(n=i.match(/expires=([^;]+)/i))?void 0:n[1])?void 0:e.trim();return {value:o,expires:s?new Date(s).toISOString():null}}async getSession(){return new Promise(t=>{mt({method:"GET",url:"https://manage.booth.pm/orders",headers:{Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"ja,en-US;q=0.9,en;q=0.8"},onload:n=>{const e=this.extractCookieInfo(n.responseHeaders);if(e){const n={L:e.value,updated_at:(new Date).toISOString(),expires_at:e.expires};t({success:true,data:n});}else t({success:false,error:"未找到有效的 Session"});},onerror:n=>{t({success:false,error:"请求出错: "+(n.error||"网络错误")});}});})}async getSessionJSON(){const t=await this.getSession();return t.success&&t.data?JSON.stringify(t.data,null,2):null}}class Yt extends A{constructor(t){super(t);}shouldExecute(){return  true}createAPI(){return new Ut}async initialize(){ht("获取Booth Session",()=>this.getSessionAndCopy());}getNotificationText(t){return t?"Session已复制\n过期时间: "+new Date(t).toLocaleString():"Session已复制到剪贴板"}async getSessionAndCopy(){const t=this.getAPI();if(!t)return;const n=await t.getSession();if(n.success&&n.data){const t=JSON.stringify(n.data,null,2);ut(t,"Booth Session"),dt({text:this.getNotificationText(n.data.expires_at),title:"获取成功",timeout:3e3});}else dt({text:n.error||"未找到有效的 Session",title:"获取失败",timeout:3e3});}}(new class{constructor(){n(this,"context",{observers:new Map,cachedElements:new Map}),n(this,"features",[new Pt(this.context),new Gt(this.context),new Yt(this.context)]);}async init(){try{for(const n of this.features)try{n.shouldExecute()&&await n.execute();}catch(t){Dt();}}catch(t){Dt(0,()=>{});}}}).init();

		})
	};
}));

System.register("./TagTab-BWhxAzYP-BU1Pytah.js", ['vue', './useTreeTab-B3BkgX7f-CasvKy8u.js', './__monkey.entry-cNiwjrQq.js'], (function (exports, module) {
	'use strict';
	var defineComponent, computed, createElementBlock, openBlock, createVNode, unref, withCtx, createCommentVNode, createElementVNode, Fragment, renderList, toDisplayString, withModifiers, withDirectives, withKeys, vModelText, createTextVNode, le, ee, ne, H$1, Ct, G$1, U$1, nt;
	return {
		setters: [module => {
			defineComponent = module.defineComponent;
			computed = module.computed;
			createElementBlock = module.createElementBlock;
			openBlock = module.openBlock;
			createVNode = module.createVNode;
			unref = module.unref;
			withCtx = module.withCtx;
			createCommentVNode = module.createCommentVNode;
			createElementVNode = module.createElementVNode;
			Fragment = module.Fragment;
			renderList = module.renderList;
			toDisplayString = module.toDisplayString;
			withModifiers = module.withModifiers;
			withDirectives = module.withDirectives;
			withKeys = module.withKeys;
			vModelText = module.vModelText;
			createTextVNode = module.createTextVNode;
		}, module => {
			le = module.l;
			ee = module.e;
			ne = module.n;
		}, module => {
			H$1 = module.H;
			Ct = module.C;
			G$1 = module.G;
			U$1 = module.U;
			nt = module.n;
		}],
		execute: (function () {

			const x={class:"tag-preset-tab"},H={key:0,class:"tag-custom-content"},L={class:"tag-badges-wrapper"},S={class:"tag-text"},_=["onClick"],A=["innerHTML"],U={key:0},V={key:1},N={class:"form-group"},j={class:"form-group"},I={key:2},J={key:3},K={class:"modal-message"},O={key:4},q={key:0,class:"modal-message-with-margin"},B=["placeholder"],F={key:5},D={key:0,class:"modal-message-with-margin"},E=["placeholder"],z={key:6},G={class:"modal-message"},P=["innerHTML"],Q=["innerHTML"],R=["innerHTML"],W=["innerHTML"],X=["innerHTML"],Y=exports("default", H$1(defineComponent({t:"TagTab",props:{api:{}},setup(e){const C=e,{data:Y,createNode:Z,renameNode:$}=Ct(),ee$1=computed(()=>Y.value.tagTree);function te(e){var t;return !!e&&(!!((null==(t=e.data)?void 0:t.tags)&&Array.isArray(e.data.tags)&&e.data.tags.length>0)||!(!e.children||0===e.children.length)&&e.children.some(e=>{const t=ee$1.value.nodes[e];return t&&te(t)}))}function ne$1(e,t){var n;(null==(n=e.data)?void 0:n.tags)&&Array.isArray(e.data.tags)&&e.data.tags.forEach(e=>t.add(e)),e.children&&e.children.length>0&&e.children.forEach(e=>{const n=ee$1.value.nodes[e];n&&ne$1(n,t);});}const oe=computed(()=>[{label:"应用标签",action:(e,t)=>{const n=new Set;t&&t.length>0?t.forEach(e=>ne$1(e,n)):e&&ne$1(e,n),n.size>0&&C.api.addTags(Array.from(n));},show:(e,t)=>t&&t.length>0?t.some(te):te(e)},{label:"移除标签",action:(e,t)=>{const n=new Set;t&&t.length>0?t.forEach(e=>ne$1(e,n)):e&&ne$1(e,n),n.size>0&&C.api.removeTags(Array.from(n));},show:(e,t)=>t&&t.length>0?t.some(te):te(e),danger:true}]),ae=le({tree:()=>Y.value.tagTree,onCreateFolder:e=>Z(ee$1.value,"新建文件夹",void 0,e).id,onCreateItem:e=>Z(ee$1.value,"新建 Tag 预设",{tags:[]},e).id,onEditItem:async e=>{const t=Y.value.tagTree.nodes[e];if(!t||!t.data)return;const n=await ae.modal.openModal({type:"createTag",title:"编辑 Tag 预设",formData:{name:t.name,tagsText:t.data.tags.join("\n")}});if(n&&n.name&&n.tagsText){const o=(e=>{const t=e.trim();if(t.startsWith("[")&&t.endsWith("]"))try{const e=JSON.parse(t);if(Array.isArray(e))return e.map(e=>(e+"").trim()).filter(e=>e.length>0)}catch(n){}return t.split(/[,\n]+/).map(e=>e.trim()).filter(e=>e.length>0)})(n.tagsText);o.length>0&&($(ee$1.value,e,n.name.trim()),t.data.tags=o);}}});return (e,t)=>(openBlock(),createElementBlock("div",x,[createVNode(ee,{tree:unref(ae).tree.value,"search-placeholder":"搜索 Tag...","search-filter":unref(ne),"custom-menu-items":oe.value,"on-create-folder":unref(ae).handleCreateFolder,"on-create-item":unref(ae).handleCreateItem,"on-rename":unref(ae).handleRename,"on-delete":unref(ae).handleDelete,"on-edit":unref(ae).handleEditItem,onSelectionChange:unref(ae).handleSelect},{default:withCtx(({node:e})=>{var t;return [(null==(t=e.data)?void 0:t.tags)?(openBlock(),createElementBlock("div",H,[createElementVNode("div",L,[(openBlock(true),createElementBlock(Fragment,null,renderList(e.data.tags,(t,a)=>(openBlock(),createElementBlock("span",{key:a,class:"tag-badge"},[createElementVNode("span",S,toDisplayString(t),1),createElementVNode("button",{class:"tag-delete-btn",onClick:withModifiers(t=>((e,t)=>{var n;const o=null==(n=e.data)?void 0:n.tags;if(o&&Array.isArray(o)){const n=[...o];n.splice(t,1),e.data={tags:n};}})(e,a),["stop"]),title:"删除此标签"},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U$1).close,12)},null,8,A)],8,_)]))),128))])])):createCommentVNode("",true)]}),o:1},8,["tree","search-filter","custom-menu-items","on-create-folder","on-create-item","on-rename","on-delete","on-edit","onSelectionChange"]),createVNode(nt,{show:unref(ae).modal.state.value.show,title:unref(ae).modal.state.value.title,"teleport-to":".booth-enhancer-sidebar",onClose:unref(ae).modal.closeModal},{footer:withCtx(()=>["alert"!==unref(ae).modal.state.value.type?(openBlock(),createElementBlock("button",{key:0,class:"booth-btn booth-btn-md booth-btn-icon booth-btn-secondary",onClick:t[9]||(t[9]=(...e)=>unref(ae).modal.closeModal&&unref(ae).modal.closeModal(...e)),title:"取消"},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U$1).close,18)},null,8,P)])):createCommentVNode("",true),"createTag"===unref(ae).modal.state.value.type?(openBlock(),createElementBlock("button",{key:1,class:"booth-btn booth-btn-md booth-btn-icon booth-btn-primary",onClick:t[10]||(t[10]=e=>unref(ae).modal.confirmModal(unref(ae).modal.state.value.formData)),title:"确定"},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U$1).check,18)},null,8,Q)])):"delete"===unref(ae).modal.state.value.type?(openBlock(),createElementBlock("button",{key:2,class:"booth-btn booth-btn-md booth-btn-icon booth-btn-danger",onClick:t[11]||(t[11]=e=>unref(ae).modal.confirmModal(true)),title:"删除"},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U$1).trash,18)},null,8,R)])):"alert"===unref(ae).modal.state.value.type?(openBlock(),createElementBlock("button",{key:3,class:"booth-btn booth-btn-md booth-btn-icon booth-btn-primary",onClick:t[12]||(t[12]=e=>unref(ae).modal.confirmModal()),title:"确定"},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U$1).check,18)},null,8,W)])):(openBlock(),createElementBlock("button",{key:4,class:"booth-btn booth-btn-md booth-btn-icon booth-btn-primary",onClick:t[13]||(t[13]=e=>unref(ae).modal.confirmModal()),title:"确定"},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U$1).check,18)},null,8,X)]))]),default:withCtx(()=>["createFolder"===unref(ae).modal.state.value.type?(openBlock(),createElementBlock("div",U,[withDirectives(createElementVNode("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>unref(ae).modal.state.value.inputValue=e),type:"text",placeholder:"文件夹名称",onKeyup:t[1]||(t[1]=withKeys(e=>unref(ae).modal.confirmModal(),["enter"]))},null,544),[[vModelText,unref(ae).modal.state.value.inputValue]])])):"createTag"===unref(ae).modal.state.value.type?(openBlock(),createElementBlock("div",V,[createElementVNode("div",N,[t[14]||(t[14]=createElementVNode("label",null,[createTextVNode("预设名称 "),createElementVNode("span",{class:"required"},"*")],-1)),withDirectives(createElementVNode("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>unref(ae).modal.state.value.formData.name=e),type:"text",placeholder:"例如：イチゴ配布物"},null,512),[[vModelText,unref(ae).modal.state.value.formData.name]])]),createElementVNode("div",j,[t[15]||(t[15]=createElementVNode("label",null,[createTextVNode("标签列表 "),createElementVNode("span",{class:"required"},"*")],-1)),withDirectives(createElementVNode("textarea",{"onUpdate:modelValue":t[3]||(t[3]=e=>unref(ae).modal.state.value.formData.tagsText=e),class:"modal-textarea-code-small",placeholder:'支持两种格式：\n1. JSON 数组（从 Booth 复制）：["アクセサリー","眼鏡","イチゴ"]\n2. 普通文本（逗号/换行/空格分隔）：アクセサリー,眼鏡,イチゴ',rows:"4"},null,512),[[vModelText,unref(ae).modal.state.value.formData.tagsText]]),t[16]||(t[16]=createElementVNode("small",{class:"form-hint-small"},' 💡 直接粘贴从 Booth "复制标签"功能得到的 JSON 数据，或手动输入 ',-1))])])):"rename"===unref(ae).modal.state.value.type?(openBlock(),createElementBlock("div",I,[withDirectives(createElementVNode("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>unref(ae).modal.state.value.inputValue=e),type:"text",placeholder:"新名称",onKeyup:t[5]||(t[5]=withKeys(e=>unref(ae).modal.confirmModal(),["enter"]))},null,544),[[vModelText,unref(ae).modal.state.value.inputValue]])])):"delete"===unref(ae).modal.state.value.type?(openBlock(),createElementBlock("div",J,[createElementVNode("p",K,toDisplayString(unref(ae).modal.state.value.formData.message),1)])):"input"===unref(ae).modal.state.value.type?(openBlock(),createElementBlock("div",O,[unref(ae).modal.state.value.message?(openBlock(),createElementBlock("p",q,toDisplayString(unref(ae).modal.state.value.message),1)):createCommentVNode("",true),withDirectives(createElementVNode("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>unref(ae).modal.state.value.inputValue=e),type:"text",placeholder:unref(ae).modal.state.value.placeholder,onKeyup:t[7]||(t[7]=withKeys(e=>unref(ae).modal.confirmModal(),["enter"]))},null,40,B),[[vModelText,unref(ae).modal.state.value.inputValue]])])):"textarea"===unref(ae).modal.state.value.type?(openBlock(),createElementBlock("div",F,[unref(ae).modal.state.value.message?(openBlock(),createElementBlock("p",D,toDisplayString(unref(ae).modal.state.value.message),1)):createCommentVNode("",true),withDirectives(createElementVNode("textarea",{"onUpdate:modelValue":t[8]||(t[8]=e=>unref(ae).modal.state.value.inputValue=e),class:"modal-textarea-code",placeholder:unref(ae).modal.state.value.placeholder,rows:"4"},null,8,E),[[vModelText,unref(ae).modal.state.value.inputValue]])])):"alert"===unref(ae).modal.state.value.type?(openBlock(),createElementBlock("div",z,[createElementVNode("p",G,toDisplayString(unref(ae).modal.state.value.message),1)])):createCommentVNode("",true)]),o:1},8,["show","title","onClose"])]))}}),[["__scopeId","data-v-7caba342"]]));

		})
	};
}));

System.register("./ItemTab-DUKS-646-D6sp1L6a.js", ['vue', './useTreeTab-B3BkgX7f-CasvKy8u.js', './__monkey.entry-cNiwjrQq.js'], (function (exports, module) {
	'use strict';
	var defineComponent, computed, createElementBlock, openBlock, createVNode, unref, withCtx, createCommentVNode, createElementVNode, toDisplayString, withDirectives, withKeys, vModelText, createTextVNode, le, ee, te, H$1, Ct, nt, G$1, U$1;
	return {
		setters: [module => {
			defineComponent = module.defineComponent;
			computed = module.computed;
			createElementBlock = module.createElementBlock;
			openBlock = module.openBlock;
			createVNode = module.createVNode;
			unref = module.unref;
			withCtx = module.withCtx;
			createCommentVNode = module.createCommentVNode;
			createElementVNode = module.createElementVNode;
			toDisplayString = module.toDisplayString;
			withDirectives = module.withDirectives;
			withKeys = module.withKeys;
			vModelText = module.vModelText;
			createTextVNode = module.createTextVNode;
		}, module => {
			le = module.l;
			ee = module.e;
			te = module.t;
		}, module => {
			H$1 = module.H;
			Ct = module.C;
			nt = module.n;
			G$1 = module.G;
			U$1 = module.U;
		}],
		execute: (function () {

			const M={class:"item-data-tab"},C={key:0,class:"item-custom-content"},x={class:"item-field"},H={class:"item-field"},L={key:0},U={key:1},I={class:"form-group"},w={class:"form-group"},V={class:"form-group"},_={key:2},N={key:3},j={class:"modal-message"},K={key:4},F={key:0,class:"modal-message-with-margin"},S=["placeholder"],q={key:5},D={key:0,class:"modal-message-with-margin"},E=["placeholder"],z={key:6},A={class:"modal-message"},B=["innerHTML"],G=["innerHTML"],J=["innerHTML"],O=["innerHTML"],P=["innerHTML"],Q=exports("default", H$1(defineComponent({t:"ItemTab",setup(e){const{data:g,createNode:Q,renameNode:R}=Ct(),W=le({tree:()=>g.value.itemTree,onCreateFolder:e=>Q(g.value.itemTree,"新建文件夹",void 0,e).id,onCreateItem:e=>Q(g.value.itemTree,"新建商品数据",{authorName:"",itemName:"",itemUrl:""},e).id,onEditItem:async e=>{var t;const o=g.value.itemTree.nodes[e];if(!o||!o.data)return;const n=await W.modal.openModal({type:"createItem",title:"编辑商品数据",formData:{name:o.name,authorName:o.data.authorName||"",itemUrl:o.data.itemUrl||""}});if(null==(t=null==n?void 0:n.name)?void 0:t.trim()){const t=n.name.trim();R(g.value.itemTree,e,t),o.data.authorName=n.authorName.trim(),o.data.itemName=t,o.data.itemUrl=n.itemUrl.trim();}}}),X=computed(()=>[]);return (e,t)=>(openBlock(),createElementBlock("div",M,[createVNode(unref(ee),{tree:unref(W).tree.value,"search-placeholder":"搜索商品数据...","search-filter":unref(te),"on-create-folder":unref(W).handleCreateFolder,"on-create-item":unref(W).handleCreateItem,"on-rename":unref(W).handleRename,"on-delete":unref(W).handleDelete,"on-edit":unref(W).handleEditItem,"custom-menu-items":X.value,onSelectionChange:unref(W).handleSelect},{default:withCtx(({node:e})=>{var a,l;return [(null==(a=e.data)?void 0:a.authorName)||(null==(l=e.data)?void 0:l.itemUrl)?(openBlock(),createElementBlock("div",C,[createElementVNode("span",x,toDisplayString(e.data.authorName||"—"),1),t[15]||(t[15]=createElementVNode("span",{class:"item-separator"},"·",-1)),createElementVNode("span",H,toDisplayString(e.name),1)])):createCommentVNode("",true)]}),o:1},8,["tree","search-filter","on-create-folder","on-create-item","on-rename","on-delete","on-edit","custom-menu-items","onSelectionChange"]),createVNode(nt,{show:unref(W).modal.state.value.show,title:unref(W).modal.state.value.title,"teleport-to":".booth-enhancer-sidebar",onClose:unref(W).modal.closeModal},{footer:withCtx(()=>["alert"!==unref(W).modal.state.value.type?(openBlock(),createElementBlock("button",{key:0,class:"booth-btn booth-btn-md booth-btn-icon booth-btn-secondary",onClick:t[10]||(t[10]=(...e)=>unref(W).modal.closeModal&&unref(W).modal.closeModal(...e)),title:"取消"},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U$1).close,18)},null,8,B)])):createCommentVNode("",true),"createItem"===unref(W).modal.state.value.type?(openBlock(),createElementBlock("button",{key:1,class:"booth-btn booth-btn-md booth-btn-icon booth-btn-primary",onClick:t[11]||(t[11]=e=>unref(W).modal.confirmModal(unref(W).modal.state.value.formData)),title:"确定"},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U$1).check,18)},null,8,G)])):"delete"===unref(W).modal.state.value.type?(openBlock(),createElementBlock("button",{key:2,class:"booth-btn booth-btn-md booth-btn-icon booth-btn-danger",onClick:t[12]||(t[12]=e=>unref(W).modal.confirmModal(true)),title:"删除"},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U$1).trash,18)},null,8,J)])):"alert"===unref(W).modal.state.value.type?(openBlock(),createElementBlock("button",{key:3,class:"booth-btn booth-btn-md booth-btn-icon booth-btn-primary",onClick:t[13]||(t[13]=e=>unref(W).modal.confirmModal()),title:"确定"},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U$1).check,18)},null,8,O)])):(openBlock(),createElementBlock("button",{key:4,class:"booth-btn booth-btn-md booth-btn-icon booth-btn-primary",onClick:t[14]||(t[14]=e=>unref(W).modal.confirmModal()),title:"确定"},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U$1).check,18)},null,8,P)]))]),default:withCtx(()=>["createFolder"===unref(W).modal.state.value.type?(openBlock(),createElementBlock("div",L,[withDirectives(createElementVNode("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>unref(W).modal.state.value.inputValue=e),type:"text",placeholder:"文件夹名称",onKeyup:t[1]||(t[1]=withKeys(e=>unref(W).modal.confirmModal(),["enter"]))},null,544),[[vModelText,unref(W).modal.state.value.inputValue]])])):"createItem"===unref(W).modal.state.value.type?(openBlock(),createElementBlock("div",U,[createElementVNode("div",I,[t[16]||(t[16]=createElementVNode("label",null,[createTextVNode("商品名称 "),createElementVNode("span",{class:"required"},"*")],-1)),withDirectives(createElementVNode("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>unref(W).modal.state.value.formData.name=e),type:"text",placeholder:"例如：イチゴ - Ichigo"},null,512),[[vModelText,unref(W).modal.state.value.formData.name]])]),createElementVNode("div",w,[t[17]||(t[17]=createElementVNode("label",null,"作者名称",-1)),withDirectives(createElementVNode("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>unref(W).modal.state.value.formData.authorName=e),type:"text",placeholder:"例如：みゅ"},null,512),[[vModelText,unref(W).modal.state.value.formData.authorName]])]),createElementVNode("div",V,[t[18]||(t[18]=createElementVNode("label",null,"商品链接",-1)),withDirectives(createElementVNode("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>unref(W).modal.state.value.formData.itemUrl=e),type:"text",placeholder:"https://booth.pm/..."},null,512),[[vModelText,unref(W).modal.state.value.formData.itemUrl]])])])):"rename"===unref(W).modal.state.value.type?(openBlock(),createElementBlock("div",_,[withDirectives(createElementVNode("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>unref(W).modal.state.value.inputValue=e),type:"text",placeholder:"新名称",onKeyup:t[6]||(t[6]=withKeys(e=>unref(W).modal.confirmModal(),["enter"]))},null,544),[[vModelText,unref(W).modal.state.value.inputValue]])])):"delete"===unref(W).modal.state.value.type?(openBlock(),createElementBlock("div",N,[createElementVNode("p",j,toDisplayString(unref(W).modal.state.value.formData.message),1)])):"input"===unref(W).modal.state.value.type?(openBlock(),createElementBlock("div",K,[unref(W).modal.state.value.message?(openBlock(),createElementBlock("p",F,toDisplayString(unref(W).modal.state.value.message),1)):createCommentVNode("",true),withDirectives(createElementVNode("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>unref(W).modal.state.value.inputValue=e),type:"text",placeholder:unref(W).modal.state.value.placeholder,onKeyup:t[8]||(t[8]=withKeys(e=>unref(W).modal.confirmModal(),["enter"]))},null,40,S),[[vModelText,unref(W).modal.state.value.inputValue]])])):"textarea"===unref(W).modal.state.value.type?(openBlock(),createElementBlock("div",q,[unref(W).modal.state.value.message?(openBlock(),createElementBlock("p",D,toDisplayString(unref(W).modal.state.value.message),1)):createCommentVNode("",true),withDirectives(createElementVNode("textarea",{"onUpdate:modelValue":t[9]||(t[9]=e=>unref(W).modal.state.value.inputValue=e),class:"modal-textarea-code",placeholder:unref(W).modal.state.value.placeholder,rows:"4"},null,8,E),[[vModelText,unref(W).modal.state.value.inputValue]])])):"alert"===unref(W).modal.state.value.type?(openBlock(),createElementBlock("div",z,[createElementVNode("p",A,toDisplayString(unref(W).modal.state.value.message),1)])):createCommentVNode("",true)]),o:1},8,["show","title","onClose"])]))}}),[["__scopeId","data-v-6c6b3856"]]));

		})
	};
}));

System.register("./useTreeTab-B3BkgX7f-CasvKy8u.js", ['vue', './__monkey.entry-cNiwjrQq.js', './useModal-CEDTPuIh-FnhElVKI.js'], (function (exports, module) {
	'use strict';
	var ref, computed, defineComponent, onMounted, onUnmounted, createElementBlock, openBlock, createCommentVNode, createVNode, withDirectives, createElementVNode, vModelText, renderSlot, Fragment, renderList, createBlock, createSlots, withCtx, mergeProps, withModifiers, normalizeClass, watch, resolveComponent, normalizeStyle, unref, toDisplayString, nextTick, H, Ct, kt, $$1, U$1, G$1, t;
	return {
		setters: [module => {
			ref = module.ref;
			computed = module.computed;
			defineComponent = module.defineComponent;
			onMounted = module.onMounted;
			onUnmounted = module.onUnmounted;
			createElementBlock = module.createElementBlock;
			openBlock = module.openBlock;
			createCommentVNode = module.createCommentVNode;
			createVNode = module.createVNode;
			withDirectives = module.withDirectives;
			createElementVNode = module.createElementVNode;
			vModelText = module.vModelText;
			renderSlot = module.renderSlot;
			Fragment = module.Fragment;
			renderList = module.renderList;
			createBlock = module.createBlock;
			createSlots = module.createSlots;
			withCtx = module.withCtx;
			mergeProps = module.mergeProps;
			withModifiers = module.withModifiers;
			normalizeClass = module.normalizeClass;
			watch = module.watch;
			resolveComponent = module.resolveComponent;
			normalizeStyle = module.normalizeStyle;
			unref = module.unref;
			toDisplayString = module.toDisplayString;
			nextTick = module.nextTick;
		}, module => {
			H = module.H;
			Ct = module.C;
			kt = module.k;
			$$1 = module.$;
			U$1 = module.U;
			G$1 = module.G;
		}, module => {
			t = module.t;
		}],
		execute: (function () {

			exports({
				l: le,
				n: ne,
				t: te
			});

			const S={class:"tree-item"},E=["innerHTML"],F={key:1,class:"expand-icon placeholder"},j=["innerHTML"],O=["innerHTML"],U=["innerHTML"],V=["innerHTML"],q={class:"name"},A={key:2,class:"count"},K={key:3,class:"node-header-extra"},P={key:2,class:"tree-children"},$=H(defineComponent({t:"TreeNode",props:{node:{},tree:{},level:{},editingNodeId:{},showChildren:{type:Boolean,default:true},selection:{},activeNodeId:{},selectable:{type:Boolean,default:true},selectableFilter:{}},emits:["select","contextmenu","rename"],setup(e,{emit:_}){const T=e,L=_,H=kt.getInstance(),R=computed(()=>T.level||0),B=ref(false),N=ref(null),$=computed(()=>T.editingNodeId===T.node.id),z=ref(""),G=ref(null),J=computed(()=>{const e=T.tree.nodes;return T.node.children.map(n=>e[n]).filter(Boolean)}),Q=computed(()=>T.node.children.length>0),W=computed(()=>{var e;return (null==(e=T.selection)?void 0:e.has(T.node.id))||false}),X=computed(()=>T.activeNodeId===T.node.id),Y=computed(()=>!!T.selectable&&(!T.selectableFilter||T.selectableFilter(T.node))),Z=computed(()=>{const e=!!T.node.data,n=Q.value;return e?n?U$1.files:U$1.file:n?U$1.folderFilled:U$1.folderEmpty}),ee=()=>{T.node.expanded=!T.node.expanded;},ne=e=>{e.dataTransfer&&(e.dataTransfer.setData("text/plain",T.node.id),e.dataTransfer.effectAllowed="move");},te=()=>{B.value=false,N.value=null;},le=e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer&&(e.dataTransfer.dropEffect="move");const n=e.currentTarget.getBoundingClientRect(),t=e.clientY-n.top,l=n.height;N.value=.25*l>t?"before":t>.75*l?"after":"inside",B.value=true;},oe=e=>{const n=e.currentTarget.getBoundingClientRect(),t=e.clientX,l=e.clientY;t>=n.left&&t<n.right&&l>=n.top&&l<n.bottom||(B.value=false,N.value=null);},ae=e=>{var n;e.preventDefault(),e.stopPropagation();const t=null==(n=e.dataTransfer)?void 0:n.getData("text/plain");if(!t)return B.value=false,void(N.value=null);if(t===T.node.id)return B.value=false,void(N.value=null);if(re(t,T.node.id))return B.value=false,void(N.value=null);const l=N.value;if("inside"===l)H.moveNode(T.tree,t,T.node.id),T.node.expanded||(T.node.expanded=true);else {const e=T.node.parentId,n=(e?T.tree.nodes[e].children:T.tree.rootIds).indexOf(T.node.id),o="before"===l?n:n+1;H.insertNodeAt(T.tree,t,e,o);}B.value=false,N.value=null;},re=(e,n)=>{let t=T.tree.nodes[n];for(;t;){if(t.id===e)return  true;if(!t.parentId)break;t=T.tree.nodes[t.parentId];}return  false};async function ie(){z.value=T.node.name,await nextTick(),setTimeout(()=>{G.value&&(G.value.focus(),G.value.select());},0);}watch($,async e=>{e&&await ie();},{immediate:true}),watch(()=>T.editingNodeId,async e=>{e===T.node.id&&await ie();});const se=()=>{const e=z.value.trim();e&&e!==T.node.name?L("rename",T.node.id,e):L("rename",T.node.id,T.node.name);},ce=e=>{"Enter"===e.key?(e.preventDefault(),se()):"Escape"===e.key&&(e.preventDefault(),L("rename",T.node.id,T.node.name));},de=e=>{if($.value)return;const n=e.target;n.closest("button, a, .action-icon")||(n.closest("input, textarea, select")?!Y.value||e.ctrlKey||e.shiftKey||e.metaKey||L("select",T.node,e):Y.value&&L("select",T.node,e));};return (e,n)=>{const t=resolveComponent("TreeNode",true);return openBlock(),createElementBlock("div",S,[B.value&&"before"===N.value?(openBlock(),createElementBlock("div",{key:0,class:"drop-indicator drop-indicator-before",style:normalizeStyle({paddingLeft:20*R.value+"px"})},null,4)):createCommentVNode("",true),createElementVNode("div",{class:normalizeClass(["tree-node-wrapper",{"drag-over":B.value,"drag-over-inside":"inside"===N.value}]),draggable:"true",onDragstart:ne,onDragend:te,onDragover:le,onDragleave:oe,onDrop:ae},[createElementVNode("div",{class:normalizeClass(["node-item",{"has-custom-content":e.$slots.default,"is-editing":$.value,selected:W.value,active:X.value,selectable:Y.value}]),onClick:de,onContextmenu:n[3]||(n[3]=withModifiers(n=>{return t=n,l=e.node,void($.value||(t.stopPropagation(),L("contextmenu",t,l)));var t,l;},["prevent"]))},[createElementVNode("div",{class:normalizeClass(["tree-node-content",{expanded:e.node.expanded,"has-children":Q.value}]),style:normalizeStyle({paddingLeft:20*R.value+"px"})},[$.value?(openBlock(),createElementBlock(Fragment,{key:0},[e.showChildren&&Q.value?(openBlock(),createElementBlock("span",{key:0,class:"expand-icon",onClick:n[0]||(n[0]=withModifiers(e=>ee(),["stop"])),innerHTML:unref(G$1)(e.node.expanded?unref(U$1).chevronDown:unref(U$1).chevronRight,12)},null,8,E)):(openBlock(),createElementBlock("span",F)),createElementVNode("span",{class:"icon",innerHTML:unref(G$1)(Z.value,16),style:normalizeStyle({color:e.node.data?"#94a3b8":"#fbbf24"})},null,12,j),withDirectives(createElementVNode("input",{ref_key:"inputRef",ref:G,"onUpdate:modelValue":n[1]||(n[1]=e=>z.value=e),class:"node-name-input",onBlur:se,onKeydown:ce},null,544),[[vModelText,z.value]])],64)):(openBlock(),createElementBlock(Fragment,{key:1},[e.showChildren&&Q.value?(openBlock(),createElementBlock("div",{key:0,class:"toggle-area",onClick:n[2]||(n[2]=withModifiers(e=>ee(),["stop"]))},[createElementVNode("span",{class:"expand-icon",innerHTML:unref(G$1)(e.node.expanded?unref(U$1).chevronDown:unref(U$1).chevronRight,12)},null,8,O),createElementVNode("span",{class:"icon",innerHTML:unref(G$1)(Z.value,16),style:normalizeStyle({color:e.node.data?"#94a3b8":"#fbbf24"})},null,12,U)])):(openBlock(),createElementBlock(Fragment,{key:1},[n[7]||(n[7]=createElementVNode("span",{class:"expand-icon placeholder"},null,-1)),createElementVNode("span",{class:"icon",innerHTML:unref(G$1)(Z.value,16),style:normalizeStyle({color:e.node.data?"#94a3b8":"#fbbf24"})},null,12,V)],64)),createElementVNode("span",q,toDisplayString(e.node.name),1),Q.value?(openBlock(),createElementBlock("span",A,"("+toDisplayString(e.node.children.length)+")",1)):createCommentVNode("",true),e.$slots.header?(openBlock(),createElementBlock("div",K,[renderSlot(e.$slots,"header",{node:e.node,level:R.value},void 0,true)])):createCommentVNode("",true)],64))],6),e.$slots.default?(openBlock(),createElementBlock("div",{key:0,class:"node-custom-content",style:normalizeStyle({paddingLeft:20*R.value+36+"px"})},[renderSlot(e.$slots,"default",{node:e.node,level:R.value},void 0,true)],4)):createCommentVNode("",true)],34)],34),B.value&&"after"===N.value?(openBlock(),createElementBlock("div",{key:1,class:"drop-indicator drop-indicator-after",style:normalizeStyle({paddingLeft:20*R.value+"px"})},null,4)):createCommentVNode("",true),e.showChildren&&e.node.expanded&&Q.value?(openBlock(),createElementBlock("div",P,[(openBlock(true),createElementBlock(Fragment,null,renderList(J.value,l=>(openBlock(),createBlock(t,{key:l.id,node:l,tree:e.tree,level:R.value+1,"editing-node-id":e.editingNodeId,"show-children":e.showChildren,selection:e.selection,"active-node-id":e.activeNodeId,selectable:e.selectable,"selectable-filter":e.selectableFilter,onSelect:n[4]||(n[4]=(e,n)=>L("select",e,n)),onContextmenu:n[5]||(n[5]=(e,n)=>L("contextmenu",e,n)),onRename:n[6]||(n[6]=(e,n)=>L("rename",e,n))},createSlots({l:2},[renderList(e.$slots,(n,t)=>({name:t,fn:withCtx(n=>[renderSlot(e.$slots,t,mergeProps({ref_for:true},n),void 0,true)])}))]),1032,["node","tree","level","editing-node-id","show-children","selection","active-node-id","selectable","selectable-filter"]))),128))])):createCommentVNode("",true)])}}}),[["__scopeId","data-v-fbb1ef76"]]),z={key:0,class:"tree-search"},G=["placeholder"],J={key:0,class:"tree-search-toolbar"},Q={key:1,class:"search-results"},W={key:0,class:"search-results-list"},X={key:1,class:"search-empty"},Y={key:0,class:"empty-state"},Z={key:1,class:"tree-content"},ee=exports("e", H(defineComponent({t:"Tree",props:{tree:{},parentId:{},mode:{default:"tree"},searchPlaceholder:{},searchFilter:{},customMenuItems:{},selectable:{type:Boolean,default:true},selectableFilter:{},onCreateFolder:{},onCreateItem:{},onRename:{},onDelete:{},onEdit:{}},emits:["selectionChange"],setup(e,{emit:l}){const o=e,c=l,p=kt.getInstance(),y=ref(""),C=ref(new Set),I=ref(null),D=ref(null),H=computed(()=>y.value.trim().length>0),B=computed(()=>H.value&&o.searchFilter?Object.values(o.tree.nodes).filter(e=>o.searchFilter(e,y.value.trim())):[]),N=computed(()=>B.value.length>0),S=ref({show:false,targetId:null,x:0,y:0}),E=ref(null),F=ref(null),j=e=>{o.selectable&&0!==C.value.size&&F.value&&(F.value.contains(e.target)||be());};onMounted(()=>{document.addEventListener("click",j);}),onUnmounted(()=>{document.removeEventListener("click",j);});const O=computed(()=>{var e;const n=o.tree.nodes;return "list"===o.mode?Object.values(n).filter(e=>e.data).sort((e,n)=>n.updatedAt-e.updatedAt):(o.parentId?(null==(e=n[o.parentId])?void 0:e.children)||[]:o.tree.rootIds).map(e=>n[e]).filter(Boolean)}),U=computed(()=>S.value.targetId?o.tree.nodes[S.value.targetId]:null);function V(e){if(!o.customMenuItems||0===o.customMenuItems.length)return [];const n=pe();return o.customMenuItems.filter(t=>!t.show||t.show(e,n))}const q=computed(()=>V(U.value)),A=computed(()=>V(null));function K(e,n,t,l){0!==n.length&&(e.length>0&&(e[e.length-1].separator=true),n.forEach(n=>{e.push({label:n.label,action:()=>n.action(t,l),danger:n.danger,separator:n.separator});}));}const P=computed(()=>{const e=[],n=pe();return function(e){"tree"===o.mode&&e.push({label:"新建文件夹节点",action:te}),e.push({label:"新建数据节点",action:le,separator:true});}(e),U.value?(e.push({label:"重命名",action:ae}),U.value.data&&o.onEdit&&e.push({label:"编辑",action:oe}),K(e,q.value,U.value,n),e.length>0&&(e[e.length-1].separator=true),e.push({label:"删除",action:ie,danger:true})):K(e,A.value,null,n),e}),ee=()=>{if(!S.value.targetId)return null;const e=U.value;return e?e.id:null},ne=(e,n)=>{S.value={show:true,targetId:(null==n?void 0:n.id)||null,x:e.clientX,y:e.clientY};},te=()=>{var e;const n=ee(),t=null==(e=o.onCreateFolder)?void 0:e.call(o,n);t&&(E.value=t);},le=()=>{var e;const n=ee(),t=null==(e=o.onCreateItem)?void 0:e.call(o,n);t&&(E.value=t);},oe=()=>{var e;S.value.targetId&&(null==(e=o.onEdit)||e.call(o,S.value.targetId));},ae=()=>{S.value.targetId&&(E.value=S.value.targetId);},re=(e,n)=>{var t;null==(t=o.onRename)||t.call(o,e,n),E.value=null;},ie=async()=>{var e;if(S.value.targetId)try{await(null==(e=o.onDelete)?void 0:e.call(o,S.value.targetId));}catch(n){}},se=ref(false),ce=e=>{e.target.closest(".tree-node-wrapper")||(e.preventDefault(),e.stopPropagation(),e.dataTransfer&&(e.dataTransfer.dropEffect="move"),se.value=true);},de=e=>{e.target.closest(".node-tree")||(se.value=false);},ue=e=>{var n;if(e.target.closest(".tree-node-wrapper"))return;e.preventDefault(),e.stopPropagation();const t=null==(n=e.dataTransfer)?void 0:n.getData("text/plain");t&&p.moveNode(o.tree,t,o.parentId||null),se.value=false;},ve=e=>{e.target.closest(".tree-node-content")||ne(e,null);},fe=e=>{e.target.closest(".node-item")||C.value.size>0&&be();},pe=()=>Array.from(C.value).map(e=>o.tree.nodes[e]).filter(Boolean),me=()=>{const e=pe();c("selectionChange",e);},ye=(e,n)=>{if(o.selectableFilter&&!o.selectableFilter(e))return;const t=(null==n?void 0:n.ctrlKey)||(null==n?void 0:n.metaKey),l=null==n?void 0:n.shiftKey,a=new Set(C.value);if(l&&D.value){const n=(()=>{var e;const n=[],t=e=>{for(const l of e){const e=o.tree.nodes[l];e&&(n.push(e),e.expanded&&e.children.length>0&&t(e.children));}};return "list"===o.mode?n.push(...O.value):H.value?n.push(...B.value):t(o.parentId?(null==(e=o.tree.nodes[o.parentId])?void 0:e.children)||[]:o.tree.rootIds),n})(),t=n.findIndex(e=>e.id===D.value),l=n.findIndex(n=>n.id===e.id);if(-1!==t&&-1!==l){a.clear();const r=Math.min(t,l),i=Math.max(t,l);for(let e=r;i>=e;e++){const t=n[e];o.selectableFilter&&!o.selectableFilter(t)||a.add(t.id);}I.value=e.id;}}else t?a.has(e.id)?(a.delete(e.id),I.value===e.id&&(I.value=null)):(a.add(e.id),I.value=e.id,D.value=e.id):(a.clear(),a.add(e.id),I.value=e.id,D.value=e.id);C.value=a,me();},be=()=>{C.value=new Set,I.value=null,D.value=null,me();},he=(e,n)=>{C.value.has(n.id)||ye(n),ne(e,n);};return (e,n)=>(openBlock(),createElementBlock("div",{class:"tree-wrapper",ref_key:"treeRootRef",ref:F},[e.searchFilter?(openBlock(),createElementBlock("div",z,[withDirectives(createElementVNode("input",{"onUpdate:modelValue":n[0]||(n[0]=e=>y.value=e),type:"text",placeholder:e.searchPlaceholder||"搜索...",class:"search-input"},null,8,G),[[vModelText,y.value]]),e.$slots.toolbar?(openBlock(),createElementBlock("div",J,[renderSlot(e.$slots,"toolbar",{},void 0,true)])):createCommentVNode("",true)])):createCommentVNode("",true),H.value?(openBlock(),createElementBlock("div",Q,[N.value?(openBlock(),createElementBlock("div",W,[(openBlock(true),createElementBlock(Fragment,null,renderList(B.value,n=>(openBlock(),createBlock($,{key:n.id,node:n,tree:e.tree,level:0,"editing-node-id":E.value,"show-children":false,selection:C.value,"active-node-id":I.value,selectable:e.selectable,"selectable-filter":e.selectableFilter,onSelect:ye,onContextmenu:he,onRename:re},createSlots({l:2},[renderList(e.$slots,(n,t)=>({name:t,fn:withCtx(n=>[renderSlot(e.$slots,t,mergeProps({ref_for:true},n||{}),void 0,true)])}))]),1032,["node","tree","editing-node-id","selection","active-node-id","selectable","selectable-filter"]))),128))])):(openBlock(),createElementBlock("div",X," 没有找到匹配的结果 "))])):(openBlock(),createElementBlock("div",{key:2,class:normalizeClass(["node-tree",{"tree-drag-over":se.value}]),onContextmenu:withModifiers(ve,["prevent"]),onClick:fe,onDragover:ce,onDragleave:de,onDrop:ue},[0===O.value.length?(openBlock(),createElementBlock("div",Y," 暂无数据，右键新建 ")):(openBlock(),createElementBlock("div",Z,[(openBlock(true),createElementBlock(Fragment,null,renderList(O.value,n=>(openBlock(),createBlock($,{key:n.id,node:n,tree:e.tree,level:0,"editing-node-id":E.value,"show-children":"tree"===e.mode,selection:C.value,"active-node-id":I.value,selectable:e.selectable,"selectable-filter":e.selectableFilter,onSelect:ye,onContextmenu:he,onRename:re},createSlots({l:2},[renderList(e.$slots,(n,t)=>({name:t,fn:withCtx(n=>[renderSlot(e.$slots,t,mergeProps({ref_for:true},n||{}),void 0,true)])}))]),1032,["node","tree","editing-node-id","show-children","selection","active-node-id","selectable","selectable-filter"]))),128))]))],34)),createVNode($$1,{show:S.value.show,x:S.value.x,y:S.value.y,items:P.value,onClose:n[1]||(n[1]=e=>S.value.show=false)},null,8,["show","x","y","items"])],512))}}),[["__scopeId","data-v-b7665db9"]]));function ne(e,n){var t;if(!(null==(t=e.data)?void 0:t.tags))return  false;const l=n.toLowerCase(),o=e.name.toLowerCase(),a=e.data.tags.join(" ").toLowerCase();return o.includes(l)||a.includes(l)}function te(e,n){var t,l,o,a,r,i;if(!(null==(t=e.data)?void 0:t.authorName)&&!(null==(l=e.data)?void 0:l.itemUrl))return  false;const s=n.toLowerCase(),c=e.name.toLowerCase(),d=(null==(a=null==(o=e.data)?void 0:o.authorName)?void 0:a.toLowerCase())||"",u=(null==(i=null==(r=e.data)?void 0:r.itemUrl)?void 0:i.toLowerCase())||"";return c.includes(s)||d.includes(s)||u.includes(s)}function le(e){const{renameNode:l,deleteNode:o}=Ct(),a=t(),r=ref(null),i=computed(()=>"function"==typeof e.tree?e.tree():e.tree);return {selectedNodeId:r,tree:i,handleSelect:function(e){e.length>0&&(r.value=e[0].id);},handleCreateFolder:function(n){return e.onCreateFolder?e.onCreateFolder(n):Ct().createNode(i.value,"新建文件夹",void 0,n).id},handleCreateItem:function(n){if(e.onCreateItem)return e.onCreateItem(n);throw Error("onCreateItem is required")},handleEditItem:async function(n){e.onEditItem&&await e.onEditItem(n);},handleRename:function(e,n){const t=n.trim();t&&l(i.value,e,t);},handleDelete:async function(e){const n=i.value.nodes[e];n&&await a.openModal({type:"delete",title:"确认删除",formData:{message:`确定要删除"${n.name}"吗？`}})&&o(i.value,e);},modal:a}}

		})
	};
}));

System.register("./EditTab-R0NUwsoO-CPQSm_db.js", ['vue', './useModal-CEDTPuIh-FnhElVKI.js', './__monkey.entry-cNiwjrQq.js'], (function (exports, module) {
	'use strict';
	var defineComponent, computed, ref, watch, onMounted, createElementBlock, openBlock, Fragment, createVNode, createCommentVNode, unref, withCtx, createElementVNode, withDirectives, createTextVNode, withKeys, vModelText, vModelSelect, toDisplayString, renderList, normalizeStyle, renderSlot, createBlock, withModifiers, vModelCheckbox, normalizeClass, nextTick, useSlots, t, H, Ct$1, wt$1, xt$1, Tt$1, nt$1, G$1, U, gt$1, ft$1;
	return {
		setters: [module => {
			defineComponent = module.defineComponent;
			computed = module.computed;
			ref = module.ref;
			watch = module.watch;
			onMounted = module.onMounted;
			createElementBlock = module.createElementBlock;
			openBlock = module.openBlock;
			Fragment = module.Fragment;
			createVNode = module.createVNode;
			createCommentVNode = module.createCommentVNode;
			unref = module.unref;
			withCtx = module.withCtx;
			createElementVNode = module.createElementVNode;
			withDirectives = module.withDirectives;
			createTextVNode = module.createTextVNode;
			withKeys = module.withKeys;
			vModelText = module.vModelText;
			vModelSelect = module.vModelSelect;
			toDisplayString = module.toDisplayString;
			renderList = module.renderList;
			normalizeStyle = module.normalizeStyle;
			renderSlot = module.renderSlot;
			createBlock = module.createBlock;
			withModifiers = module.withModifiers;
			vModelCheckbox = module.vModelCheckbox;
			normalizeClass = module.normalizeClass;
			nextTick = module.nextTick;
			useSlots = module.useSlots;
		}, module => {
			t = module.t;
		}, module => {
			H = module.H;
			Ct$1 = module.C;
			wt$1 = module.w;
			xt$1 = module.x;
			Tt$1 = module.T;
			nt$1 = module.n;
			G$1 = module.G;
			U = module.U;
			gt$1 = module.g;
			ft$1 = module.f;
		}],
		execute: (function () {

			const N={class:"file-selector"},j=["onClick"],O={class:"be-text-sm be-font-medium"},A={key:1,class:"empty-hint be-text-center be-text-secondary be-py-md"},E=H(defineComponent({t:"FileSelector",props:{files:{},selectedFileIds:{},emptyText:{},columns:{},maxHeight:{}},emits:["update:selectedFileIds"],setup(e,{emit:u}){const d=e,p=u,b=computed(()=>d.columns||2),m=computed(()=>d.emptyText||"暂无文件，请先上传文件");return (e,t)=>(openBlock(),createElementBlock("div",N,[e.files.length>0?(openBlock(),createElementBlock("div",{key:0,class:"file-grid",style:normalizeStyle({gridTemplateColumns:`repeat(${b.value}, 1fr)`,maxHeight:e.maxHeight||"300px"})},[(openBlock(true),createElementBlock(Fragment,null,renderList(e.files,e=>{return openBlock(),createElementBlock("button",{key:e.id,class:normalizeClass(["file-item booth-btn booth-btn-sm booth-btn-ghost be-justify-start",{"is-selected":(t=e.id,d.selectedFileIds.includes(t))}]),type:"button",onClick:t=>function(e){const t=[...d.selectedFileIds],n=t.indexOf(e);n>-1?t.splice(n,1):t.push(e),p("update:selectedFileIds",t);}(e.id)},[createElementVNode("span",O,toDisplayString(e.name),1)],10,j);var t;}),128))],4)):(openBlock(),createElementBlock("div",A,toDisplayString(m.value),1))]))}}),[["__scopeId","data-v-43c71f00"]]),z={class:"preview-box be-flex be-flex-column be-gap-xs"},q={key:0,class:"be-text-xs be-text-secondary"},K={key:1,class:"be-text-secondary"},G={key:2,class:"be-whitespace-pre-wrap be-break-words be-m-0"},J={key:3},Q=H(defineComponent({t:"PreviewBox",props:{label:{},type:{},isEmpty:{type:Boolean},emptyText:{}},setup:e=>(e,t)=>(openBlock(),createElementBlock("div",z,[e.label?(openBlock(),createElementBlock("div",q,toDisplayString(e.label),1)):createCommentVNode("",true),e.isEmpty?(openBlock(),createElementBlock("div",K,toDisplayString(e.emptyText||"暂无内容"),1)):"pre"===e.type?(openBlock(),createElementBlock("pre",G,[t[0]||(t[0]=createTextVNode("      ",-1)),renderSlot(e.$slots,"default",{},void 0,true),t[1]||(t[1]=createTextVNode("\n    ",-1))])):(openBlock(),createElementBlock("div",J,[renderSlot(e.$slots,"default",{},void 0,true)]))]))}),[["__scopeId","data-v-93d09832"]]),W={key:0,class:"section-header"},X={key:0,class:"be-text-base be-font-bold"},Y={key:1,class:"actions"},Z={class:"section-content"},ee=H(defineComponent({t:"SectionHeader",props:{title:{default:""},noBorder:{type:Boolean,default:false}},setup(e){const l=e,a=useSlots(),s=computed(()=>l.title||a.title||a.actions);return (e,t)=>(openBlock(),createElementBlock("section",{class:normalizeClass(["section-header-container",{"no-header":!s.value,"no-border":e.noBorder}])},[s.value?(openBlock(),createElementBlock("div",W,[e.title||e.$slots.title?(openBlock(),createElementBlock("div",X,[renderSlot(e.$slots,"title",{},()=>[createTextVNode(toDisplayString(e.title),1)],true)])):createCommentVNode("",true),e.$slots.actions?(openBlock(),createElementBlock("div",Y,[renderSlot(e.$slots,"actions",{},void 0,true)])):createCommentVNode("",true)])):createCommentVNode("",true),createElementVNode("div",Z,[renderSlot(e.$slots,"default",{},void 0,true)])],2))}}),[["__scopeId","data-v-5643104c"]]),te={class:"template-selector"},ne={key:0,class:"template-selector-label"},oe=["value"],le={key:2,class:"empty-hint"},ae=H(defineComponent({t:"TemplateSelector",props:{modelValue:{},templates:{default:()=>[]},label:{default:"选择模板"},placeholder:{default:"请选择模板"},emptyHint:{default:"暂无可用模板"}},emits:["update:modelValue"],setup(e,{emit:l}){const i=e,r=l,d=computed({get:()=>i.modelValue,set(e){r("update:modelValue",e);}});return watch(()=>i.templates,function(e){e&&0!==e.length?e.some(e=>e.id===i.modelValue)||r("update:modelValue",e[0].id):r("update:modelValue","");},{immediate:true}),(e,t)=>(openBlock(),createElementBlock("div",te,[e.label?(openBlock(),createElementBlock("label",ne,toDisplayString(e.label),1)):createCommentVNode("",true),e.templates&&e.templates.length>0?withDirectives((openBlock(),createElementBlock("select",{key:1,"onUpdate:modelValue":t[0]||(t[0]=e=>d.value=e),class:"template-selector-select"},[(openBlock(true),createElementBlock(Fragment,null,renderList(e.templates,e=>(openBlock(),createElementBlock("option",{key:e.id,value:e.id},toDisplayString(e.name),9,oe))),128))],512)),[[vModelSelect,d.value]]):(openBlock(),createElementBlock("div",le,toDisplayString(e.emptyHint),1))]))}}),[["__scopeId","data-v-08bcafdd"]]),se={class:"draggable-card-list"},ie=["onDragstart","onDrop"],re={class:"card-actions"},ce=["innerHTML"],ue={class:"card-number"},de={class:"actions-content"},pe=["onClick"],be=["innerHTML"],me={class:"card-content"},fe=H(defineComponent({t:"DraggableCardList",props:{items:{},keyExtractor:{type:Function,default:(e,t)=>void 0!==(null==e?void 0:e.id)?e.id:t}},emits:["remove","reorder"],setup(e,{emit:t}){const l=t,i=ref(null);function u(e){e.preventDefault();}return (e,t)=>(openBlock(),createElementBlock("div",se,[(openBlock(true),createElementBlock(Fragment,null,renderList(e.items,(t,a)=>(openBlock(),createElementBlock("div",{key:e.keyExtractor(t,a),class:"draggable-card",draggable:"true",onDragstart:e=>function(e){i.value=e;}(a),onDragover:u,onDrop:e=>{return t=a,e.preventDefault(),void(null!==i.value&&i.value!==t?(l("reorder",i.value,t),i.value=null):i.value=null);var t;}},[createElementVNode("div",re,[createElementVNode("span",{class:"drag-handle",innerHTML:unref(G$1)(unref(U).moreVertical,14)},null,8,ce),createElementVNode("span",ue,"#"+toDisplayString(a+1),1),createElementVNode("div",de,[renderSlot(e.$slots,"actions",{item:t,index:a},void 0,true)]),createElementVNode("button",{class:"booth-btn booth-btn-ghost booth-btn-icon booth-btn-sm",onClick:e=>function(e){l("remove",e);}(a),title:"删除"},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).trash,14)},null,8,be)],8,pe)]),createElementVNode("div",me,[renderSlot(e.$slots,"content",{item:t,index:a},void 0,true)])],40,ie))),128))]))}}),[["__scopeId","data-v-6cf94b77"]]);function he(e){const{templates:t,defaultTemplate:n,minTemplates:o=1}=e;return {addTemplate:function(){const e=t.value||(t.value=[]),o={id:crypto.randomUUID(),name:"模板 "+(e.length+1),isDefault:false,...n};e.push(o);},removeTemplate:function(e){const n=t.value;n&&n.length>o&&n.splice(e,1);},setDefaultTemplate:function(e){const n=t.value;n&&n.forEach((t,n)=>{t.isDefault=n===e;});},onReorder:function(e,n){const o=t.value;if(!o)return;const[l]=o.splice(e,1);o.splice(n,0,l);}}}function ye(e,t){return t.enabled&&0!==t.discountPercent?Math.round(e*(1-t.discountPercent/100)):e}const ve={"商品名":"itemName","支持数":"supportCount","商品类型":"itemTypeName","商品类型复数":"itemTypePlural","变体数量":"variationCount","首个变体名":"firstName","智能标题":"smartTitle","折扣标识":"discountIndicator","原价":"originalPrice","折扣价":"discountedPrice","折扣百分比":"discountPercent","Fullset原价":"fullsetOriginalPrice","Fullset折扣价":"fullsetDiscountedPrice","折扣开始时间":"startDate","折扣结束时间":"endDate","日期":"date","内容":"content","作者名":"authorName","商品链接":"itemUrl"};function xe(e,t){let n=e;return Object.entries(ve).forEach(([e,o])=>{const l=t[o];if(null!=l){const t=RegExp(`\\{${e}\\}`,"g");n=n.replace(t,l+"");}}),n}function ge(e){const t=new Date(e);return `${t.getFullYear()}/${t.getMonth()+1}/${t.getDate()}`}function Te(e){return e.filter(e=>!e.isFullset).reduce((e,t)=>t.fileItemMap?e+Object.keys(t.fileItemMap).filter(e=>t.fileItemMap[e]).length:e,0)}function ke(e,t){if(1===t)return e;const n=e.toLowerCase();return /[sxz]$|[cs]h$/.test(n)?e+"es":/[^aeiou]y$/.test(n)?e.slice(0,-1)+"ies":e+"s"}function we(e,t){var n,o,l,a;const s=crypto.randomUUID();switch(e){case "normal":return {id:s,type:"normal",headline:"",body:""};case "log":return {id:s,type:"log",headline:"更新日志",logEntries:[],logTemplateId:(null==(o=null==(n=t.logTemplates)?void 0:n[0])?void 0:o.id)||""};case "iteminfo":return {id:s,type:"iteminfo",headline:"対応アバター",itemInfoTemplateId:(null==(a=null==(l=t.itemInfoTemplates)?void 0:l[0])?void 0:a.id)||""}}}function _e(e,t,n){switch(e.type||(e.type="normal"),e.type){case "normal":return function(e,t){if(e.templateId&&t){const n=t.find(t=>t.id===e.templateId);if(n)return {headline:e.headline??n.headline,body:e.body??n.body??""}}return {headline:e.headline??"",body:e.body??""}}(e,t.sectionTemplates);case "log":return function(e,t){const n=e.headline??"更新日志",o=null==t?void 0:t.find(t=>t.id===e.logTemplateId),l=(null==o?void 0:o.template)||"{日期} - {内容}";return {headline:n,body:e.logEntries.map(e=>xe(l,{date:ge(e.date),content:e.content})).join("\n\n")}}(e,t.logTemplates);case "iteminfo":return function(e,t,n){const o=e.headline??"対応アバター",l=null==t?void 0:t.find(t=>t.id===e.itemInfoTemplateId),a=(null==l?void 0:l.template)||"⟡ {作者名}\nʚ {商品名} ɞ\n- {商品链接} -";return {headline:o,body:function(e,t){const n=function(e){const t=new Map;return e.forEach(e=>{const n=e.authorName||"未知作者";t.has(n)||t.set(n,[]),t.get(n).push(e);}),t}(e),o=[];return n.forEach(e=>{e.forEach(e=>{const n=xe(t,{authorName:e.authorName,itemName:e.itemName,itemUrl:e.itemUrl});o.push(n);});}),o.join("\n\n")}(function(e,t){const n=[],o=new Set;return e.forEach(e=>{e.fileItemMap&&Object.values(e.fileItemMap).forEach(e=>{if(e&&!o.has(e)){const l=t.nodes[e];(null==l?void 0:l.data)&&(n.push(l.data),o.add(e));}});}),n}(n.variations,n.itemTree),a)}}(e,t.itemInfoTemplates,n);default:return {headline:e.headline||"",body:e.body||""}}}const Me={basic:"基础: {商品名}, {支持数}, {商品类型}, {商品类型复数}, {变体数量}, {首个变体名}",smart:"智能: {智能标题}, {折扣标识}",log:"可用变量: {日期}, {内容}",discount:"可用变量: {原价}, {折扣价}, {折扣百分比}, {Fullset原价}, {Fullset折扣价}, {折扣开始时间}, {折扣结束时间}",get full(){return `${this.basic}\n${this.smart}`}},He={addButton:"booth-btn booth-btn-ghost booth-btn-icon booth-btn-sm",closeButton:"booth-btn booth-btn-md booth-btn-icon booth-btn-secondary",saveButton:"booth-btn booth-btn-md booth-btn-icon booth-btn-primary"},Le=["innerHTML"],Ce=["innerHTML"],Ve=["onUpdate:modelValue"],Ue={class:"form-group"},Ie=["onUpdate:modelValue"],Se={key:1,class:"empty-hint"},De=defineComponent({t:"DescriptionTemplateModal",props:{show:{type:Boolean},globalTemplates:{}},emits:["close"],setup(e,{emit:l}){const a=e,s=l,c=computed({get(){var e;return (e=a.globalTemplates).descriptionTemplates||(e.descriptionTemplates=[])},set(e){a.globalTemplates.descriptionTemplates=e;}}),{addTemplate:u,removeTemplate:d,onReorder:p}=he({templates:c,defaultTemplate:{template:""}});return (e,t)=>(openBlock(),createBlock(nt$1,{show:e.show,title:"描述模板配置",width:"600px","teleport-to":".booth-enhancer-sidebar",onClose:t[1]||(t[1]=e=>s("close"))},{"header-actions":withCtx(()=>[createElementVNode("button",{class:normalizeClass(unref(He).addButton),onClick:t[0]||(t[0]=(...e)=>unref(u)&&unref(u)(...e)),title:"添加模板",type:"button"},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).plus,18)},null,8,Le)],2)]),default:withCtx(()=>[createVNode(unref(ee),null,{default:withCtx(()=>[createElementVNode("p",{class:"form-hint",innerHTML:unref(Me).full.replace("\n","<br>")},null,8,Ce),e.globalTemplates.descriptionTemplates&&e.globalTemplates.descriptionTemplates.length>0?(openBlock(),createBlock(unref(fe),{key:0,items:e.globalTemplates.descriptionTemplates,"key-extractor":e=>e.id,onRemove:unref(d),onReorder:unref(p)},{actions:withCtx(({item:e})=>[withDirectives(createElementVNode("input",{"onUpdate:modelValue":t=>e.name=t,type:"text",placeholder:"输入模板名称",style:{flex:"1","min-width":"0"}},null,8,Ve),[[vModelText,e.name]])]),content:withCtx(({item:e})=>[createElementVNode("div",Ue,[t[2]||(t[2]=createElementVNode("label",null,"模板内容",-1)),withDirectives(createElementVNode("textarea",{"onUpdate:modelValue":t=>e.template=t,rows:"1",placeholder:"输入模板内容"},null,8,Ie),[[vModelText,e.template]])])]),o:1},8,["items","key-extractor","onRemove","onReorder"])):(openBlock(),createElementBlock("div",Se,' 暂无模板，点击"添加模板"创建 '))]),o:1})]),o:1},8,["show"]))}}),Re=["innerHTML"],$e=["innerHTML"],Pe=defineComponent({t:"ItemDescriptionSection",props:{itemConfig:{},globalTemplates:{},templateVars:{},api:{},modal:{},currentItemId:{},onDescriptionUpdated:{type:Function}},emits:["applied"],setup(e,{expose:n,emit:l}){const a=e,s=l,i=computed(()=>{const e=[],t=xe(wt$1(a.globalTemplates,a.itemConfig),a.templateVars);if(t&&e.push(t),a.itemConfig.customDescription&&e.push(a.itemConfig.customDescription),a.itemConfig.discount.enabled){const t=a.itemConfig.pricing.normalVariationPrice,n=ye(t,a.itemConfig.discount),o=a.itemConfig.pricing.fullsetPrice,l=ye(o,a.itemConfig.discount),s=e=>{if(!e)return "";const t=new Date(e);return `${(t.getMonth()+1+"").padStart(2,"0")}/${(t.getDate()+"").padStart(2,"0")} ${(t.getHours()+"").padStart(2,"0")}:${(t.getMinutes()+"").padStart(2,"0")}`},i=xe(xt$1(a.globalTemplates,a.itemConfig),{...a.templateVars,originalPrice:t,discountedPrice:n,discountPercent:a.itemConfig.discount.discountPercent,fullsetOriginalPrice:o,fullsetDiscountedPrice:l,startDate:s(a.itemConfig.discount.startDate),endDate:s(a.itemConfig.discount.endDate)});e.push(i);}return e.join("\n\n")});async function u(){const e=await a.modal.openModal({type:"editDescription",title:"编辑描述",formData:{customDescription:a.itemConfig.customDescription}});e&&a.onDescriptionUpdated(e.customDescription);}function p(){a.api.setDescription(i.value),Tt$1.success("已应用描述"),s("applied");}return n({applyDescription:p}),(e,t)=>(openBlock(),createBlock(unref(ee),{title:"商品描述"},{actions:withCtx(()=>[createElementVNode("button",{class:"booth-btn booth-btn-sm booth-btn-secondary",type:"button",title:"编辑描述",onClick:u},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).edit,14)},null,8,Re)]),createElementVNode("button",{class:"booth-btn booth-btn-sm booth-btn-primary",type:"button",title:"应用到页面",onClick:p},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).send,14)},null,8,$e)])]),default:withCtx(()=>[createVNode(unref(Q),{label:"预览:",type:"pre","is-empty":!i.value,"empty-text":'暂无描述，点击"编辑描述"添加'},{default:withCtx(()=>[createTextVNode(toDisplayString(i.value),1)]),o:1},8,["is-empty"])]),o:1}))}}),Fe=["innerHTML"],Be=["innerHTML"],Ne=["onUpdate:modelValue"],je={class:"be-flex be-flex-column be-gap-sm"},Oe={class:"form-group"},Ae=["onUpdate:modelValue"],Ee={key:1,class:"empty-hint"},ze=defineComponent({t:"NameTemplateModal",props:{show:{type:Boolean},globalTemplates:{}},emits:["close"],setup(e,{emit:l}){const a=e,s=l,c=computed({get(){var e;return (e=a.globalTemplates).nameTemplates||(e.nameTemplates=[])},set(e){a.globalTemplates.nameTemplates=e;}}),{addTemplate:u,removeTemplate:d,onReorder:p}=he({templates:c,defaultTemplate:{template:"{smartTitle}"}});return (e,t)=>(openBlock(),createBlock(nt$1,{show:e.show,title:"商品名模板配置",width:"600px","teleport-to":".booth-enhancer-sidebar",onClose:t[1]||(t[1]=e=>s("close"))},{"header-actions":withCtx(()=>[createElementVNode("button",{class:normalizeClass(unref(He).addButton),onClick:t[0]||(t[0]=(...e)=>unref(u)&&unref(u)(...e)),title:"添加模板",type:"button"},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).plus,18)},null,8,Fe)],2)]),default:withCtx(()=>[createVNode(unref(ee),null,{default:withCtx(()=>[createElementVNode("p",{class:"form-hint",innerHTML:unref(Me).full.replace("\n","<br>")},null,8,Be),e.globalTemplates.nameTemplates&&e.globalTemplates.nameTemplates.length>0?(openBlock(),createBlock(unref(fe),{key:0,items:e.globalTemplates.nameTemplates,"key-extractor":e=>e.id,onRemove:unref(d),onReorder:unref(p)},{actions:withCtx(({item:e})=>[withDirectives(createElementVNode("input",{"onUpdate:modelValue":t=>e.name=t,type:"text",placeholder:"输入模板名称",style:{flex:"1","min-width":"0"}},null,8,Ne),[[vModelText,e.name]])]),content:withCtx(({item:e})=>[createElementVNode("div",je,[createElementVNode("div",Oe,[t[2]||(t[2]=createElementVNode("label",null,"模板内容",-1)),withDirectives(createElementVNode("textarea",{"onUpdate:modelValue":t=>e.template=t,rows:"1",placeholder:"输入模板内容"},null,8,Ae),[[vModelText,e.template]])])])]),o:1},8,["items","key-extractor","onRemove","onReorder"])):(openBlock(),createElementBlock("div",Ee,' 暂无模板，点击"添加模板"创建 '))]),o:1})]),o:1},8,["show"]))}}),qe=["innerHTML"],Ke={class:"modal-content"},Ge={class:"form-group"},Je={class:"form-group"},Qe={class:"form-group"},We={key:0,class:"form-group"},Xe=["innerHTML"],Ye=["value"],Ze=["innerHTML"],et=["innerHTML"],tt=defineComponent({t:"NameModal",props:{show:{type:Boolean},itemConfig:{},globalTemplates:{},totalSupport:{}},emits:["close","save"],setup(e,{emit:l}){const s=e,c=l;onMounted(function(){var e,t,n,o,l,a;s.itemConfig.selectedTemplates||(s.itemConfig.selectedTemplates={nameTemplateId:(null==(t=null==(e=s.globalTemplates.nameTemplates)?void 0:e[0])?void 0:t.id)||"",descriptionTemplateId:(null==(o=null==(n=s.globalTemplates.descriptionTemplates)?void 0:n[0])?void 0:o.id)||"",discountTemplateId:(null==(a=null==(l=s.globalTemplates.discountTemplates)?void 0:l[0])?void 0:a.id)||""});});const p=ref(false),b=computed(()=>ft$1(s.globalTemplates,s.itemConfig));function m(){c("save"),c("close");}return (e,t)=>(openBlock(),createElementBlock(Fragment,null,[createVNode(nt$1,{show:e.show,title:"编辑商品名","teleport-to":".booth-enhancer-sidebar",onClose:t[7]||(t[7]=e=>c("close")),width:"500px"},{"header-actions":withCtx(()=>[createElementVNode("button",{class:normalizeClass(unref(He).addButton),onClick:t[0]||(t[0]=e=>p.value=true),title:"模板配置",type:"button"},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).settings,18)},null,8,qe)],2)]),footer:withCtx(()=>[createElementVNode("button",{class:normalizeClass(unref(He).closeButton),onClick:t[6]||(t[6]=e=>c("close")),title:"取消"},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).close,18)},null,8,Ze)],2),createElementVNode("button",{class:normalizeClass(unref(He).saveButton),onClick:m,title:"保存"},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).check,18)},null,8,et)],2)]),default:withCtx(()=>[createElementVNode("div",Ke,[createElementVNode("div",Ge,[t[9]||(t[9]=createElementVNode("label",null,"商品基础名称",-1)),withDirectives(createElementVNode("input",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.itemConfig.itemName=t),type:"text",placeholder:"输入商品名称"},null,512),[[vModelText,e.itemConfig.itemName]])]),createElementVNode("div",Je,[t[11]||(t[11]=createElementVNode("label",null,"商品类型",-1)),withDirectives(createElementVNode("select",{"onUpdate:modelValue":t[2]||(t[2]=t=>e.itemConfig.itemType=t)},t[10]||(t[10]=[createElementVNode("option",{value:"normal"},"普通商品",-1),createElementVNode("option",{value:"adaptation"},"适配商品",-1)]),512),[[vModelSelect,e.itemConfig.itemType]])]),createElementVNode("div",Qe,[t[12]||(t[12]=createElementVNode("label",null,[createTextVNode("商品类型名称 "),createElementVNode("span",{class:"label-hint"},"(用于生成复数形式，如 Avatar → Avatars)")],-1)),withDirectives(createElementVNode("input",{"onUpdate:modelValue":t[3]||(t[3]=t=>e.itemConfig.itemTypeName=t),type:"text",placeholder:"如: Avatar, Model, Texture"},null,512),[[vModelText,e.itemConfig.itemTypeName]])]),createVNode(ae,{modelValue:e.itemConfig.selectedTemplates.nameTemplateId,"onUpdate:modelValue":t[4]||(t[4]=t=>e.itemConfig.selectedTemplates.nameTemplateId=t),templates:e.globalTemplates.nameTemplates,label:"选择模板","empty-hint":"请先在全局模板配置中添加商品名模板"},null,8,["modelValue","templates"]),e.globalTemplates.nameTemplates&&e.globalTemplates.nameTemplates.length>0?(openBlock(),createElementBlock("div",We,[t[13]||(t[13]=createElementVNode("label",null,[createTextVNode("模板内容 "),createElementVNode("span",{class:"label-hint"},"(编辑当前选中模板)")],-1)),createElementVNode("p",{class:"form-hint",innerHTML:unref(Me).full.replace("\n","<br>")},null,8,Xe),createElementVNode("input",{value:b.value,onInput:t[5]||(t[5]=e=>function(e){var t;const n=s.globalTemplates.nameTemplates,o=null==(t=s.itemConfig.selectedTemplates)?void 0:t.nameTemplateId;if(!n||!o)return;const l=e.target,a=n.find(e=>e.id===o);a&&(a.template=l.value);}(e)),type:"text",placeholder:"如: {智能标题}"},null,40,Ye)])):createCommentVNode("",true)])]),o:1},8,["show"]),createVNode(ze,{show:p.value,"global-templates":e.globalTemplates,onClose:t[8]||(t[8]=e=>p.value=false)},null,8,["show","global-templates"])],64))}}),nt=["innerHTML"],ot=["innerHTML"],lt={class:"form-group"},at={class:"be-text-primary"},st=defineComponent({t:"ItemNameSection",props:{itemConfig:{},globalTemplates:{},templateVars:{},api:{},totalSupport:{}},emits:["applied"],setup(e,{expose:l,emit:s}){const i=e,d=s,p=ref(false),b=computed(()=>xe(ft$1(i.globalTemplates,i.itemConfig),i.templateVars));function m(){i.api.setName(b.value),Tt$1.success("已应用商品名"),d("applied");}return l({applyName:m}),(e,t)=>(openBlock(),createElementBlock(Fragment,null,[createVNode(unref(ee),{title:"商品名称"},{actions:withCtx(()=>[createElementVNode("button",{class:"booth-btn booth-btn-sm booth-btn-secondary",type:"button",title:"模板设置",onClick:t[0]||(t[0]=e=>p.value=true)},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).edit,14)},null,8,nt)]),createElementVNode("button",{class:"booth-btn booth-btn-sm booth-btn-primary",type:"button",title:"应用到页面",onClick:m},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).send,14)},null,8,ot)])]),default:withCtx(()=>[createElementVNode("div",lt,[withDirectives(createElementVNode("input",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.itemConfig.itemName=t),type:"text",placeholder:"输入商品名称"},null,512),[[vModelText,e.itemConfig.itemName]])]),b.value?(openBlock(),createBlock(unref(Q),{key:0,label:"预览:",type:"text"},{default:withCtx(()=>[createElementVNode("span",at,toDisplayString(b.value),1)]),o:1})):createCommentVNode("",true)]),o:1}),createVNode(tt,{show:p.value,"item-config":e.itemConfig,"global-templates":e.globalTemplates,"total-support":e.totalSupport,onClose:t[2]||(t[2]=e=>p.value=false),onSave:t[3]||(t[3]=e=>p.value=false)},null,8,["show","item-config","global-templates","total-support"])],64))}}),it=["innerHTML"],rt={class:"be-flex be-flex-column be-gap-sm"},ct=["onUpdate:modelValue"],ut={class:"be-flex be-flex-column be-gap-sm"},dt={class:"form-group"},pt=["onUpdate:modelValue"],bt={key:1,class:"empty-hint"},mt=defineComponent({t:"ItemInfoTemplateModal",props:{show:{type:Boolean},globalTemplates:{}},emits:["close"],setup(e,{emit:l}){const a=e,s=l,c=he({templates:computed({get(){var e;return (e=a.globalTemplates).itemInfoTemplates||(e.itemInfoTemplates=[])},set(e){a.globalTemplates.itemInfoTemplates=e;}}),defaultTemplate:{template:"⟡ {作者名}\nʚ {商品名} ɞ\n- {商品链接} -"}});return (e,t)=>(openBlock(),createBlock(nt$1,{show:e.show,title:"商品信息模板配置",width:"700px","teleport-to":".booth-enhancer-sidebar",onClose:t[1]||(t[1]=e=>s("close"))},{"header-actions":withCtx(()=>[createElementVNode("button",{class:normalizeClass(unref(He).addButton),onClick:t[0]||(t[0]=e=>unref(c).addTemplate()),title:"添加模板",type:"button"},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).plus,18)},null,8,it)],2)]),default:withCtx(()=>[createElementVNode("div",rt,[createVNode(unref(ee),null,{default:withCtx(()=>[t[3]||(t[3]=createElementVNode("p",{class:"form-hint"},"可用变量: {作者名}, {商品名}, {商品链接}",-1)),t[4]||(t[4]=createElementVNode("p",{class:"form-hint"},"系统会自动按作者分组并循环渲染所有关联商品",-1)),t[5]||(t[5]=createElementVNode("p",{class:"form-hint"},"示例：⟡ {作者名}\\nʚ {商品名} ɞ\\n- {商品链接} -",-1)),e.globalTemplates.itemInfoTemplates&&e.globalTemplates.itemInfoTemplates.length>0?(openBlock(),createBlock(unref(fe),{key:0,items:e.globalTemplates.itemInfoTemplates,"key-extractor":e=>e.id,onRemove:unref(c).removeTemplate,onReorder:unref(c).onReorder},{actions:withCtx(({item:e})=>[withDirectives(createElementVNode("input",{"onUpdate:modelValue":t=>e.name=t,type:"text",placeholder:"输入模板名称",style:{flex:"1","min-width":"0"}},null,8,ct),[[vModelText,e.name]])]),content:withCtx(({item:e})=>[createElementVNode("div",ut,[createElementVNode("div",dt,[t[2]||(t[2]=createElementVNode("label",null,"模板内容",-1)),withDirectives(createElementVNode("textarea",{"onUpdate:modelValue":t=>e.template=t,rows:"3",placeholder:"输入模板内容"},null,8,pt),[[vModelText,e.template]])])])]),o:1},8,["items","key-extractor","onRemove","onReorder"])):(openBlock(),createElementBlock("div",bt,' 暂无模板，点击"添加模板"创建 '))]),o:1,l:[3,4,5]})])]),o:1},8,["show"]))}}),ft=["innerHTML"],ht={class:"be-flex be-flex-column be-gap-sm"},yt=["onUpdate:modelValue"],vt={class:"be-flex be-flex-column be-gap-sm"},xt={class:"form-group"},gt=["onUpdate:modelValue"],Tt={key:1,class:"empty-hint"},kt=defineComponent({t:"LogTemplateModal",props:{show:{type:Boolean},globalTemplates:{}},emits:["close"],setup(e,{emit:l}){const a=e,s=l,c=he({templates:computed({get(){var e;return (e=a.globalTemplates).logTemplates||(e.logTemplates=[])},set(e){a.globalTemplates.logTemplates=e;}}),defaultTemplate:{template:"⟡ {日期}\n　・ {内容}"}});return (e,t)=>(openBlock(),createBlock(nt$1,{show:e.show,title:"日志模板配置",width:"700px","teleport-to":".booth-enhancer-sidebar",onClose:t[1]||(t[1]=e=>s("close"))},{"header-actions":withCtx(()=>[createElementVNode("button",{class:normalizeClass(unref(He).addButton),onClick:t[0]||(t[0]=e=>unref(c).addTemplate()),title:"添加模板",type:"button"},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).plus,18)},null,8,ft)],2)]),default:withCtx(()=>[createElementVNode("div",ht,[createVNode(unref(ee),null,{default:withCtx(()=>[t[3]||(t[3]=createElementVNode("p",{class:"form-hint"},"可用变量: {日期}, {内容}",-1)),t[4]||(t[4]=createElementVNode("p",{class:"form-hint"},"示例：⟡ {日期}\\n　・ {内容}",-1)),e.globalTemplates.logTemplates&&e.globalTemplates.logTemplates.length>0?(openBlock(),createBlock(unref(fe),{key:0,items:e.globalTemplates.logTemplates,"key-extractor":e=>e.id,onRemove:unref(c).removeTemplate,onReorder:unref(c).onReorder},{actions:withCtx(({item:e})=>[withDirectives(createElementVNode("input",{"onUpdate:modelValue":t=>e.name=t,type:"text",placeholder:"输入模板名称",style:{flex:"1","min-width":"0"}},null,8,yt),[[vModelText,e.name]])]),content:withCtx(({item:e})=>[createElementVNode("div",vt,[createElementVNode("div",xt,[t[2]||(t[2]=createElementVNode("label",null,"模板内容",-1)),withDirectives(createElementVNode("textarea",{"onUpdate:modelValue":t=>e.template=t,rows:"2",placeholder:"输入模板内容"},null,8,gt),[[vModelText,e.template]])])])]),o:1},8,["items","key-extractor","onRemove","onReorder"])):(openBlock(),createElementBlock("div",Tt,' 暂无模板，点击"添加模板"创建 '))]),o:1,l:[3,4]})])]),o:1},8,["show"]))}}),wt=["innerHTML"],_t={class:"be-flex be-flex-column be-gap-sm"},Mt=["innerHTML"],Ht=["onUpdate:modelValue"],Lt=["onUpdate:modelValue"],Ct={class:"be-flex be-flex-column be-gap-sm"},Vt={class:"form-group"},Ut=["onUpdate:modelValue"],It={key:0,class:"form-group"},St=["onUpdate:modelValue"],Dt={key:1,class:"form-hint be-text-xs be-text-secondary"},Rt={key:2,class:"form-hint be-text-xs be-text-secondary"},$t={key:1,class:"empty-hint"},Pt=defineComponent({t:"SectionTemplateModal",props:{show:{type:Boolean},globalTemplates:{}},emits:["close"],setup(e,{emit:l}){const a=e,s=l,c=he({templates:computed({get(){var e;return (e=a.globalTemplates).sectionTemplates||(e.sectionTemplates=[])},set(e){a.globalTemplates.sectionTemplates=e;}}),defaultTemplate:{type:"normal",headline:"",body:""}});return (e,t)=>(openBlock(),createBlock(nt$1,{show:e.show,title:"Section 模板配置",width:"700px","teleport-to":".booth-enhancer-sidebar",onClose:t[1]||(t[1]=e=>s("close"))},{"header-actions":withCtx(()=>[createElementVNode("button",{class:normalizeClass(unref(He).addButton),onClick:t[0]||(t[0]=e=>unref(c).addTemplate()),title:"添加模板",type:"button"},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).plus,18)},null,8,wt)],2)]),default:withCtx(()=>[createElementVNode("div",_t,[createVNode(unref(ee),null,{default:withCtx(()=>[createElementVNode("p",{class:"form-hint",innerHTML:unref(Me).full.replace("\n","<br>")},null,8,Mt),t[5]||(t[5]=createElementVNode("p",{class:"form-hint be-text-xs be-text-secondary"},[createElementVNode("strong",null,"模板类型说明："),createElementVNode("br"),createTextVNode(" • "),createElementVNode("strong",null,"普通"),createTextVNode("：常规 Section，可包含任意内容"),createElementVNode("br"),createTextVNode(" • "),createElementVNode("strong",null,"日志"),createTextVNode("：更新日志 Section，内容由日志条目动态生成（只需配置 Headline）"),createElementVNode("br"),createTextVNode(" • "),createElementVNode("strong",null,"商品信息"),createTextVNode("：自动从 Variations 关联的商品生成信息列表 ")],-1)),e.globalTemplates.sectionTemplates&&e.globalTemplates.sectionTemplates.length>0?(openBlock(),createBlock(unref(fe),{key:0,items:e.globalTemplates.sectionTemplates,"key-extractor":e=>e.id,onRemove:unref(c).removeTemplate,onReorder:unref(c).onReorder},{actions:withCtx(({item:e})=>[withDirectives(createElementVNode("select",{"onUpdate:modelValue":t=>e.type=t,class:"be-p-xs be-px-sm be-text-base",style:{height:"28px",width:"auto","flex-shrink":"0"}},t[2]||(t[2]=[createElementVNode("option",{value:"normal"},"普通",-1),createElementVNode("option",{value:"log"},"日志",-1),createElementVNode("option",{value:"iteminfo"},"商品信息",-1)]),8,Ht),[[vModelSelect,e.type]]),withDirectives(createElementVNode("input",{"onUpdate:modelValue":t=>e.name=t,type:"text",placeholder:"输入模板名称",style:{flex:"1","min-width":"0"}},null,8,Lt),[[vModelText,e.name]])]),content:withCtx(({item:e})=>[createElementVNode("div",Ct,[createElementVNode("div",Vt,[t[3]||(t[3]=createElementVNode("label",null,"Headline",-1)),withDirectives(createElementVNode("input",{"onUpdate:modelValue":t=>e.headline=t,type:"text",placeholder:"输入 Headline"},null,8,Ut),[[vModelText,e.headline]])]),"normal"!==e.type&&e.type?"log"===e.type?(openBlock(),createElementBlock("p",Dt," 日志类型的 Section 内容由日志条目动态生成，无需手动填写 Body ")):"iteminfo"===e.type?(openBlock(),createElementBlock("p",Rt," 商品信息类型的 Section 内容将自动从 Variations 关联的商品生成，无需手动填写 Body ")):createCommentVNode("",true):(openBlock(),createElementBlock("div",It,[t[4]||(t[4]=createElementVNode("label",null,"Body",-1)),withDirectives(createElementVNode("textarea",{"onUpdate:modelValue":t=>e.body=t,rows:"1",placeholder:"输入 Body"},null,8,St),[[vModelText,e.body]])]))])]),o:1},8,["items","key-extractor","onRemove","onReorder"])):(openBlock(),createElementBlock("div",$t,' 暂无模板，点击"添加模板"创建 '))]),o:1,l:[5]})])]),o:1},8,["show"]))}}),Ft={class:"be-flex be-flex-column be-gap-sm"},Bt={class:"template-grid"},Nt={class:"be-flex be-align-center be-gap-xs"},jt=["innerHTML"],Ot=["onClick"],At={class:"be-flex be-flex-column",style:{gap:"4px"}},Et={class:"be-flex be-align-center be-gap-xs"},zt={class:"be-text-sm be-font-medium"},qt={key:0,class:"be-text-xs be-text-secondary be-truncate"},Kt=H(defineComponent({t:"SectionTemplateSelectorModal",props:{show:{type:Boolean},globalTemplates:{}},emits:["close","select"],setup(e,{emit:t}){const i=t,d={normal:{background:"rgba(107, 114, 128, 0.1)",color:"#6b7280",label:"普通"},log:{background:"rgba(16, 185, 129, 0.1)",color:"#10b981",label:"日志"},iteminfo:{background:"rgba(59, 130, 246, 0.1)",color:"#3b82f6",label:"商品信息"}};function p(e){return d[e]||d.normal}function b(){i("select",null);}return (e,t)=>(openBlock(),createBlock(nt$1,{show:e.show,title:"选择 Section 模板",width:"500px","teleport-to":".booth-enhancer-sidebar",onClose:t[0]||(t[0]=e=>i("close"))},{default:withCtx(()=>[createElementVNode("div",Ft,[t[2]||(t[2]=createElementVNode("p",{class:"form-hint be-text-xs be-text-secondary"}," 点击创建空白 Section 或从模板快速创建 ",-1)),createElementVNode("div",Bt,[createElementVNode("button",{class:"template-item booth-btn booth-btn-sm booth-btn-ghost be-justify-start",type:"button",onClick:b},[createElementVNode("div",Nt,[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).plus,14)},null,8,jt),t[1]||(t[1]=createElementVNode("span",{class:"be-text-sm be-font-medium"},"创建空 Section",-1))])]),(openBlock(true),createElementBlock(Fragment,null,renderList(e.globalTemplates.sectionTemplates,e=>(openBlock(),createElementBlock("button",{key:e.id,class:"template-item booth-btn booth-btn-sm booth-btn-ghost be-justify-start",type:"button",onClick:t=>function(e){i("select",e);}(e)},[createElementVNode("div",At,[createElementVNode("div",Et,[createElementVNode("span",zt,toDisplayString(e.name||"未命名模板"),1),createElementVNode("span",{class:"be-text-xs be-px-xs be-py-1 be-rounded",style:normalizeStyle({background:p(e.type).background,color:p(e.type).color})},toDisplayString(p(e.type).label),5)]),e.headline?(openBlock(),createElementBlock("div",qt,toDisplayString(e.headline),1)):createCommentVNode("",true)])],8,Ot))),128))])])]),o:1},8,["show"]))}}),[["__scopeId","data-v-b9c3c0a1"]]),Gt=["innerHTML"],Jt=["innerHTML"],Qt=["innerHTML"],Wt=["innerHTML"],Xt={key:0,class:"empty-hint"},Yt=["value","onChange"],Zt=["onUpdate:modelValue"],en=["innerHTML"],tn=["innerHTML"],nn=["onClick"],on=["innerHTML"],ln={key:0,class:"form-group"},an=["onUpdate:modelValue"],sn={key:1,class:"be-flex be-flex-column be-gap-sm"},rn=["onClick"],cn=["innerHTML"],un={key:0,class:"empty-hint"},dn=["onUpdate:modelValue","placeholder"],pn={class:"form-group"},bn=["onUpdate:modelValue"],mn={key:2,class:"be-flex be-flex-column be-gap-sm"},fn=H(defineComponent({t:"SectionsListSection",props:{itemConfig:{},globalTemplates:{},templateVars:{},api:{},modal:{},itemTree:{}},emits:["applied"],setup(e,{expose:l,emit:s}){const i=e,p=s,b=ref(false),m=ref(false),h=ref(false),w=ref(false),M=computed(()=>{const e={variations:i.itemConfig.variations,itemTree:i.itemTree};return i.itemConfig.sections.map(t=>{const n=_e(t,i.globalTemplates,e);return {headline:xe(n.headline,i.templateVars),body:xe(n.body,i.templateVars)}})});function H(){const e=i.api.sections;0!==e.length?(i.itemConfig.sections=e.map(()=>we("normal",i.globalTemplates)),e.forEach((e,t)=>{var n,o;const l=i.itemConfig.sections[t];l&&"normal"===l.type&&(l.headline=(null==(n=e.headlineInput)?void 0:n.value)||"",l.body=(null==(o=e.bodyTextarea)?void 0:o.value)||"");}),Tt$1.success(`已导入 ${e.length} 个 Sections`)):Tt$1.info("页面没有 Sections");}function L(e){if(null===e){const e=we("normal",i.globalTemplates);i.itemConfig.sections.push(e);}else {const t=function(e,t){var n,o,l,a;const s=e.type||"normal",i=crypto.randomUUID();switch(s){case "iteminfo":const s=(null==(o=null==(n=t.itemInfoTemplates)?void 0:n[0])?void 0:o.id)||"";return {id:i,type:"iteminfo",headline:e.headline||"対応アバター",itemInfoTemplateId:s};case "log":const r=(null==(a=null==(l=t.logTemplates)?void 0:l[0])?void 0:a.id)||"";return {id:i,type:"log",headline:e.headline||"更新日志",logEntries:[],logTemplateId:r};default:return {id:i,type:"normal",templateId:e.id,headline:e.headline,body:e.body||""}}}(e,i.globalTemplates);i.itemConfig.sections.push(t);}m.value=false;}function C(e){i.itemConfig.sections.splice(e,1);}async function V(){const e=M.value,t=e.length-i.api.sections.length;if(t>0){for(let n=0;t>n;n++)if(!(await i.api.addSection()))return void Tt$1.error("添加 Section 失败")}else if(0>t)for(let n=0;-t>n;n++)if(!(await i.api.removeSection(i.api.sections.length-1)))return void Tt$1.error("删除 Section 失败");e.forEach((e,t)=>{i.api.updateSection(t,{headline:e.headline,body:e.body});}),Tt$1.success(`已应用 ${e.length} 个 Sections`),p("applied");}function S(e,t){const[n]=i.itemConfig.sections.splice(e,1);i.itemConfig.sections.splice(t,0,n);}return l({applySections:V}),(e,t)=>(openBlock(),createElementBlock(Fragment,null,[createVNode(unref(ee),{title:`Sections (${e.itemConfig.sections.length})`},{actions:withCtx(()=>[createElementVNode("button",{class:"booth-btn booth-btn-sm booth-btn-ghost",type:"button",title:"从页面导入",onClick:H},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).download,14)},null,8,Gt)]),createElementVNode("button",{class:"booth-btn booth-btn-sm booth-btn-secondary",type:"button",title:"添加",onClick:t[0]||(t[0]=e=>{m.value=true;})},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).plus,14)},null,8,Jt)]),createElementVNode("button",{class:"booth-btn booth-btn-sm booth-btn-secondary",type:"button",title:"模板配置",onClick:t[1]||(t[1]=e=>b.value=true)},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).edit,14)},null,8,Qt)]),createElementVNode("button",{class:"booth-btn booth-btn-sm booth-btn-primary",type:"button",title:"应用到页面",onClick:V},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).send,14)},null,8,Wt)])]),default:withCtx(()=>[0===e.itemConfig.sections.length?(openBlock(),createElementBlock("div",Xt,' 暂无 Sections，点击"添加"或"从页面导入" ')):(openBlock(),createBlock(unref(fe),{key:1,items:e.itemConfig.sections,onRemove:C,onReorder:S},{actions:withCtx(({item:e,index:l})=>[createElementVNode("select",{value:e.type,class:"be-p-xs be-px-sm be-text-base",style:{height:"28px",width:"auto","flex-shrink":"0"},onChange:e=>function(e,t){const n=i.itemConfig.sections[e],o=we(t,i.globalTemplates);("normal"===n.type&&n.headline||"log"===n.type&&n.headline||"iteminfo"===n.type&&n.headline)&&(o.headline=n.headline),i.itemConfig.sections.splice(e,1,o);}(l,e.target.value)},t[8]||(t[8]=[createElementVNode("option",{value:"normal"},"普通",-1),createElementVNode("option",{value:"log"},"日志",-1),createElementVNode("option",{value:"iteminfo"},"商品信息",-1)]),40,Yt),withDirectives(createElementVNode("input",{"onUpdate:modelValue":t=>e.headline=t,type:"text",class:"be-flex-1 be-p-xs be-px-sm be-text-base be-min-w-0",style:{height:"28px"},placeholder:"输入 Headline"},null,8,Zt),[[vModelText,e.headline]]),"log"===e.type?(openBlock(),createElementBlock("button",{key:0,class:"booth-btn booth-btn-ghost booth-btn-icon booth-btn-sm",type:"button",title:"配置日志模板",onClick:t[2]||(t[2]=withModifiers(e=>{h.value=true;},["stop","prevent"]))},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).edit,14)},null,8,en)])):createCommentVNode("",true),"iteminfo"===e.type?(openBlock(),createElementBlock("button",{key:1,class:"booth-btn booth-btn-ghost booth-btn-icon booth-btn-sm",type:"button",title:"配置商品信息模板",onClick:t[3]||(t[3]=withModifiers(e=>w.value=true,["stop","prevent"]))},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).edit,14)},null,8,tn)])):createCommentVNode("",true),createElementVNode("button",{class:"booth-btn booth-btn-ghost booth-btn-icon booth-btn-sm",type:"button",title:"预览",onClick:withModifiers(e=>function(e){i.modal.openModal({type:"alert",title:"Section 预览",formData:{sectionIndex:e}});}(l),["stop","prevent"])},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).eye,14)},null,8,on)],8,nn)]),content:withCtx(({item:l,index:a})=>["normal"===l.type?(openBlock(),createElementBlock("div",ln,[withDirectives(createElementVNode("textarea",{"onUpdate:modelValue":e=>l.body=e,rows:"1",placeholder:"输入 Body"},null,8,an),[[vModelText,l.body]])])):"log"===l.type?(openBlock(),createElementBlock("div",sn,[createVNode(unref(ee),null,{default:withCtx(()=>[createVNode(ae,{modelValue:l.logTemplateId,"onUpdate:modelValue":e=>l.logTemplateId=e,templates:e.globalTemplates.logTemplates,label:"选择日志模板","empty-hint":"请先添加日志模板"},null,8,["modelValue","onUpdate:modelValue","templates"])]),o:2},1024),createVNode(unref(ee),{"no-border":""},{title:withCtx(()=>[createTextVNode("日志条目 ("+toDisplayString(l.logEntries.length)+")",1)]),actions:withCtx(()=>[createElementVNode("button",{class:"booth-btn booth-btn-sm booth-btn-secondary",type:"button",title:"添加日志",onClick:e=>function(e){const t=i.itemConfig.sections[e];"log"===t.type&&t.logEntries.unshift({id:crypto.randomUUID(),date:Date.now(),content:""});}(a)},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).plus,14)},null,8,cn)],8,rn)]),default:withCtx(()=>[0===l.logEntries.length?(openBlock(),createElementBlock("div",un,' 暂无日志，点击"添加日志"创建 ')):(openBlock(),createBlock(unref(fe),{key:1,items:l.logEntries,onRemove:e=>function(e,t){const n=i.itemConfig.sections[e];"log"===n.type&&n.logEntries.splice(t,1);}(a,e),onReorder:(e,t)=>function(e,t,n){const o=i.itemConfig.sections[e];if("log"!==o.type)return;const[l]=o.logEntries.splice(t,1);o.logEntries.splice(n,0,l);}(a,e,t)},{actions:withCtx(({item:e})=>[withDirectives(createElementVNode("input",{"onUpdate:modelValue":t=>e.date=t,type:"number",class:"be-flex-1 be-p-xs be-px-sm be-text-base",style:{height:"28px","min-width":"120px"},placeholder:unref(ge)(Date.now())},null,8,dn),[[vModelText,e.date,void 0,{number:true}]])]),content:withCtx(({item:e})=>[createElementVNode("div",pn,[withDirectives(createElementVNode("textarea",{"onUpdate:modelValue":t=>e.content=t,rows:"1",placeholder:"输入日志内容"},null,8,bn),[[vModelText,e.content]])])]),o:2},1032,["items","onRemove","onReorder"]))]),o:2},1024)])):"iteminfo"===l.type?(openBlock(),createElementBlock("div",mn,[createVNode(unref(ee),null,{default:withCtx(()=>[createVNode(ae,{modelValue:l.itemInfoTemplateId,"onUpdate:modelValue":e=>l.itemInfoTemplateId=e,templates:e.globalTemplates.itemInfoTemplates,label:"选择商品信息模板","empty-hint":"请先添加商品信息模板"},null,8,["modelValue","onUpdate:modelValue","templates"])]),o:2},1024),t[9]||(t[9]=createElementVNode("p",{class:"form-hint be-text-xs be-text-secondary"}," 商品信息会自动从 Variations 关联的商品中收集并按作者分组显示 ",-1))])):createCommentVNode("",true)]),o:1},8,["items"]))]),o:1},8,["title"]),createVNode(Kt,{show:m.value,"global-templates":e.globalTemplates,onClose:t[4]||(t[4]=e=>m.value=false),onSelect:L},null,8,["show","global-templates"]),createVNode(Pt,{show:b.value,"global-templates":e.globalTemplates,onClose:t[5]||(t[5]=e=>b.value=false)},null,8,["show","global-templates"]),createVNode(kt,{show:h.value,"global-templates":e.globalTemplates,onClose:t[6]||(t[6]=e=>h.value=false)},null,8,["show","global-templates"]),createVNode(mt,{show:w.value,"global-templates":e.globalTemplates,onClose:t[7]||(t[7]=e=>w.value=false)},null,8,["show","global-templates"])],64))}}),[["__scopeId","data-v-268f4e4d"]]),hn=["innerHTML"],yn={class:"tag-badges-wrapper"},vn={class:"tag-text"},xn=H(defineComponent({t:"TagsSection",props:{itemConfig:{},api:{},itemTree:{},tagTree:{}},emits:["applied"],setup(e,{expose:l,emit:i}){const u=e,d=i,p=computed(()=>{var e;const t=new Set,n=u.itemConfig.tagNodeIds||[],o=n.length;for(let l=0;o>l;l++){const o=n[l],a=u.tagTree.nodes[o];(null==(e=null==a?void 0:a.data)?void 0:e.tags)&&a.data.tags.forEach(e=>t.add(e));}return Array.from(t)});async function b(){var e;const t=new Set,n=u.itemConfig.tagNodeIds||[];for(const l of n){const n=u.tagTree.nodes[l];(null==(e=null==n?void 0:n.data)?void 0:e.tags)&&n.data.tags.forEach(e=>t.add(e));}if(0===t.size)return void Tt$1.info("没有可应用的标签");const o=Array.from(t).filter(e=>!u.api.hasTag(e));o.length>0?(await u.api.addTags(o),Tt$1.success(`已添加 ${o.length} 个新标签`),d("applied")):Tt$1.info("所有标签已存在，无需添加");}return watch(()=>u.itemConfig.variations,()=>{!function(e=false){var t;const n=new Set;for(const l of u.itemConfig.variations){if(l.isFullset||!l.fileItemMap)continue;const e=Object.values(l.fileItemMap);for(const o of e){const e=u.itemTree.nodes[o];if(!(null==e?void 0:e.data))continue;const{itemName:l,authorName:a}=e.data;for(const o in u.tagTree.nodes){const e=u.tagTree.nodes[o];if(!(null==(t=e.data)?void 0:t.tags)||0===e.data.tags.length)continue;const s=e.name.toLowerCase(),i=(null==l?void 0:l.toLowerCase())||"",r=(null==a?void 0:a.toLowerCase())||"";(i&&s.includes(i)||r&&s.includes(r))&&n.add(o);}}}const o=Array.from(n);u.itemConfig.tagNodeIds||(u.itemConfig.tagNodeIds=[]),u.itemConfig.tagNodeIds.splice(0,u.itemConfig.tagNodeIds.length,...o),!e&&n.size>0&&Tt$1.success(`已匹配 ${n.size} 个标签节点`);}(true);},{deep:true,immediate:true}),l({applyTags:b}),(e,t)=>(openBlock(),createBlock(unref(ee),{title:"Tags"},{actions:withCtx(()=>[createElementVNode("button",{class:"booth-btn booth-btn-sm booth-btn-primary",type:"button",title:"应用到页面",onClick:b},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).send,14)},null,8,hn)])]),default:withCtx(()=>[createVNode(unref(Q),{"is-empty":0===p.value.length,"empty-text":"标签会根据 Variations 中的商品自动匹配"},{default:withCtx(()=>[createElementVNode("div",yn,[(openBlock(true),createElementBlock(Fragment,null,renderList(p.value,(e,t)=>(openBlock(),createElementBlock("span",{key:t,class:"tag-badge"},[createElementVNode("span",vn,toDisplayString(e),1)]))),128))])]),o:1},8,["is-empty"])]),o:1}))}}),[["__scopeId","data-v-f3247bf3"]]),gn=["innerHTML"],Tn=["innerHTML"],kn=["onUpdate:modelValue"],wn={class:"form-group"},_n=["onUpdate:modelValue"],Mn={key:1,class:"empty-hint"},Hn=defineComponent({t:"DiscountTemplateModal",props:{show:{type:Boolean},globalTemplates:{}},emits:["close"],setup(e,{emit:l}){const a=e,s=l,c=computed({get(){var e;return (e=a.globalTemplates).discountTemplates||(e.discountTemplates=[])},set(e){a.globalTemplates.discountTemplates=e;}}),{addTemplate:u,removeTemplate:d,onReorder:p}=he({templates:c,defaultTemplate:{template:""}});return (e,t)=>(openBlock(),createBlock(nt$1,{show:e.show,title:"折扣模板配置",width:"600px","teleport-to":".booth-enhancer-sidebar",onClose:t[1]||(t[1]=e=>s("close"))},{"header-actions":withCtx(()=>[createElementVNode("button",{class:normalizeClass(unref(He).addButton),onClick:t[0]||(t[0]=(...e)=>unref(u)&&unref(u)(...e)),title:"添加模板",type:"button"},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).plus,18)},null,8,gn)],2)]),default:withCtx(()=>[createVNode(unref(ee),null,{default:withCtx(()=>[createElementVNode("p",{class:"form-hint",innerHTML:unref(Me).discount.replace("\n","<br>")},null,8,Tn),e.globalTemplates.discountTemplates&&e.globalTemplates.discountTemplates.length>0?(openBlock(),createBlock(unref(fe),{key:0,items:e.globalTemplates.discountTemplates,"key-extractor":e=>e.id,onRemove:unref(d),onReorder:unref(p)},{actions:withCtx(({item:e})=>[withDirectives(createElementVNode("input",{"onUpdate:modelValue":t=>e.name=t,type:"text",placeholder:"输入模板名称",style:{flex:"1","min-width":"0"}},null,8,kn),[[vModelText,e.name]])]),content:withCtx(({item:e})=>[createElementVNode("div",wn,[t[2]||(t[2]=createElementVNode("label",null,"模板内容",-1)),withDirectives(createElementVNode("textarea",{"onUpdate:modelValue":t=>e.template=t,rows:"3",placeholder:"输入模板内容"},null,8,_n),[[vModelText,e.template]])])]),o:1},8,["items","key-extractor","onRemove","onReorder"])):(openBlock(),createElementBlock("div",Mn,' 暂无模板，点击"添加模板"创建 '))]),o:1})]),o:1},8,["show"]))}}),Ln={class:"be-flex be-flex-column be-gap-sm"},Cn={class:"form-group"},Vn={class:"form-group"},Un={class:"form-hint"},In={class:"be-flex be-gap-sm be-flex-wrap"},Sn={class:"be-p-xs be-px-sm be-text-sm be-text-secondary"},Dn={class:"be-flex be-align-center be-gap-sm"},Rn={class:"booth-toggle",title:"启用打折功能"},$n=["innerHTML"],Pn={key:0,class:"discount-config"},Fn={class:"form-group"},Bn={class:"be-flex be-gap-sm"},Nn={class:"form-group be-flex-1"},jn={class:"form-group be-flex-1"},On={class:"be-flex be-flex-column be-gap-xs"},An={class:"be-flex be-justify-between"},En={class:"be-flex be-justify-between"},zn={class:"be-text-xs be-text-secondary be-mb-xs"},qn=["innerHTML"],Kn=["innerHTML"],Gn=H(defineComponent({t:"VariationConfigModal",props:{show:{type:Boolean},itemConfig:{},globalTemplates:{},availableFiles:{}},emits:["close"],setup(e,{emit:l}){const s=e,i=l,p=ref([]),b=ref(false);function h(){s.itemConfig.commonFiles=p.value,i("close");}watch(()=>s.show,e=>{e&&(p.value=[...s.itemConfig.commonFiles||[]]);});const x=computed(()=>Te(s.itemConfig.variations)),w=computed(()=>function(e,t,n){return ye(e*t,n)}(s.itemConfig.pricing.normalVariationPrice,x.value,s.itemConfig.discount)),_=computed(()=>s.itemConfig.pricing.normalVariationPrice),H=computed(()=>ye(_.value,s.itemConfig.discount)),L=computed(()=>s.itemConfig.pricing.fullsetPrice),C=computed(()=>ye(L.value,s.itemConfig.discount));function V(e){if(!e)return "";const t=new Date(e);return `${(t.getMonth()+1+"").padStart(2,"0")}/${(t.getDate()+"").padStart(2,"0")} ${(t.getHours()+"").padStart(2,"0")}:${(t.getMinutes()+"").padStart(2,"0")}`}const D=computed(()=>s.itemConfig.discount.enabled?xe(xt$1(s.globalTemplates,s.itemConfig),{originalPrice:_.value,discountedPrice:H.value,discountPercent:s.itemConfig.discount.discountPercent,fullsetOriginalPrice:L.value,fullsetDiscountedPrice:C.value,startDate:V(s.itemConfig.discount.startDate),endDate:V(s.itemConfig.discount.endDate)}):"");return (e,t)=>(openBlock(),createElementBlock(Fragment,null,[createVNode(nt$1,{show:e.show,title:"Variation 配置","teleport-to":".booth-enhancer-sidebar",onClose:t[10]||(t[10]=e=>i("close")),width:"500px"},{footer:withCtx(()=>[createElementVNode("button",{class:"booth-btn booth-btn-md booth-btn-icon booth-btn-secondary",type:"button",title:"取消",onClick:t[9]||(t[9]=e=>i("close"))},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).close,18)},null,8,qn)]),createElementVNode("button",{class:"booth-btn booth-btn-md booth-btn-icon booth-btn-primary",type:"button",title:"保存",onClick:h},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).check,18)},null,8,Kn)])]),default:withCtx(()=>[createElementVNode("div",Ln,[createVNode(unref(ee),{title:"价格配置"},{default:withCtx(()=>[createElementVNode("div",Cn,[t[12]||(t[12]=createElementVNode("label",null,"普通 Variation 价格 (¥)",-1)),withDirectives(createElementVNode("input",{"onUpdate:modelValue":t[0]||(t[0]=t=>e.itemConfig.pricing.normalVariationPrice=t),type:"number",min:"0",placeholder:"0"},null,512),[[vModelText,e.itemConfig.pricing.normalVariationPrice,void 0,{number:true}]])]),createElementVNode("div",Vn,[t[13]||(t[13]=createElementVNode("label",null,"Fullset 价格 (¥)",-1)),createElementVNode("p",Un,"建议: ¥"+toDisplayString(w.value),1),withDirectives(createElementVNode("input",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.itemConfig.pricing.fullsetPrice=t),type:"number",min:"0",placeholder:"0"},null,512),[[vModelText,e.itemConfig.pricing.fullsetPrice,void 0,{number:true}]])]),createElementVNode("div",In,[createElementVNode("span",Sn,[t[14]||(t[14]=createTextVNode(" 总支持数: ",-1)),createElementVNode("strong",null,toDisplayString(x.value),1)])])]),o:1}),createVNode(unref(ee),{title:"折扣配置"},{default:withCtx(()=>[createElementVNode("div",Dn,[createElementVNode("label",Rn,[withDirectives(createElementVNode("input",{"onUpdate:modelValue":t[2]||(t[2]=t=>e.itemConfig.discount.enabled=t),type:"checkbox"},null,512),[[vModelCheckbox,e.itemConfig.discount.enabled]]),t[15]||(t[15]=createElementVNode("span",{class:"toggle-slider"},null,-1)),t[16]||(t[16]=createElementVNode("span",{class:"toggle-label"},"启用打折",-1))]),e.itemConfig.discount.enabled?(openBlock(),createElementBlock("button",{key:0,class:"booth-btn booth-btn-ghost booth-btn-icon booth-btn-sm",type:"button",title:"配置折扣模板",onClick:t[3]||(t[3]=e=>b.value=true)},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).settings,14)},null,8,$n)])):createCommentVNode("",true)]),e.itemConfig.discount.enabled?(openBlock(),createElementBlock("div",Pn,[createVNode(ae,{modelValue:e.itemConfig.selectedTemplates.discountTemplateId,"onUpdate:modelValue":t[4]||(t[4]=t=>e.itemConfig.selectedTemplates.discountTemplateId=t),templates:e.globalTemplates.discountTemplates,label:"选择折扣模板","empty-hint":"请先在折扣模板配置中添加模板"},null,8,["modelValue","templates"]),createElementVNode("div",Fn,[t[17]||(t[17]=createElementVNode("label",null,"折扣百分比 (%)",-1)),withDirectives(createElementVNode("input",{"onUpdate:modelValue":t[5]||(t[5]=t=>e.itemConfig.discount.discountPercent=t),type:"number",min:"0",max:"100",placeholder:"0"},null,512),[[vModelText,e.itemConfig.discount.discountPercent,void 0,{number:true}]])]),createElementVNode("div",Bn,[createElementVNode("div",Nn,[t[18]||(t[18]=createElementVNode("label",null,"折扣开始时间",-1)),withDirectives(createElementVNode("input",{"onUpdate:modelValue":t[6]||(t[6]=t=>e.itemConfig.discount.startDate=t),type:"datetime-local"},null,512),[[vModelText,e.itemConfig.discount.startDate]])]),createElementVNode("div",jn,[t[19]||(t[19]=createElementVNode("label",null,"折扣结束时间",-1)),withDirectives(createElementVNode("input",{"onUpdate:modelValue":t[7]||(t[7]=t=>e.itemConfig.discount.endDate=t),type:"datetime-local"},null,512),[[vModelText,e.itemConfig.discount.endDate]])])]),createVNode(unref(Q),{label:"折扣描述预览:",type:"pre"},{default:withCtx(()=>[createTextVNode(toDisplayString(D.value),1)]),o:1}),createVNode(unref(Q),{label:"价格预览:",type:"text"},{default:withCtx(()=>[createElementVNode("div",On,[createElementVNode("div",An,[t[20]||(t[20]=createElementVNode("span",null,"普通 Variation:",-1)),createElementVNode("span",null,"¥"+toDisplayString(_.value)+" → ¥"+toDisplayString(H.value),1)]),createElementVNode("div",En,[t[21]||(t[21]=createElementVNode("span",null,"Fullset:",-1)),createElementVNode("span",null,"¥"+toDisplayString(L.value)+" → ¥"+toDisplayString(C.value),1)])])]),o:1})])):createCommentVNode("",true)]),o:1}),createVNode(unref(ee),{title:"通用文件配置"},{default:withCtx(()=>[t[24]||(t[24]=createElementVNode("p",{class:"form-hint be-text-xs be-text-secondary be-mb-sm"}," 选择所有 variation 共享的通用文件（如材质、配饰等），这些文件会在应用时自动添加到每个 variation ",-1)),createElementVNode("div",zn,[t[22]||(t[22]=createTextVNode(" 已选择: ",-1)),createElementVNode("strong",null,toDisplayString(p.value.length),1),t[23]||(t[23]=createTextVNode(" 个文件 ",-1))]),createVNode(unref(E),{files:e.availableFiles,"selected-file-ids":p.value,"onUpdate:selectedFileIds":t[8]||(t[8]=e=>p.value=e)},null,8,["files","selected-file-ids"])]),o:1,l:[24]})])]),o:1},8,["show"]),createVNode(Hn,{show:b.value,"global-templates":e.globalTemplates,onClose:t[11]||(t[11]=e=>b.value=false)},null,8,["show","global-templates"])],64))}}),[["__scopeId","data-v-9e5fca5f"]]),Jn=["innerHTML"],Qn=["innerHTML"],Wn=["innerHTML"],Xn=["innerHTML"],Yn=["innerHTML"],Zn={key:0,class:"common-files-preview be-mb-sm"},eo={class:"be-flex be-align-center be-gap-xs be-flex-wrap be-p-xs be-px-sm",style:{background:"var(--be-color-bg-secondary)","border-radius":"var(--be-radius-sm)",border:"1px solid var(--be-color-border)"}},to={key:1,class:"empty-hint"},no={class:"be-flex be-align-center be-gap-sm",style:{flex:"1"}},oo=["onUpdate:modelValue"],lo={key:0,class:"booth-toggle",title:"将此 Variation 设为 Fullset（合集包）"},ao=["checked","onChange"],so=["onClick"],io=["innerHTML"],ro={class:"be-flex be-flex-column be-gap-xs"},co={class:"be-flex be-align-center be-gap-sm"},uo={key:0,class:"be-text-base be-text-primary"},po={class:"be-text-base be-text-primary be-flex-shrink-0"},bo={class:"booth-toggle be-flex-shrink-0",title:"自定义此 Variation 的价格"},mo=["onUpdate:modelValue"],fo=["onUpdate:modelValue"],ho={class:"be-text-sm be-text-secondary be-flex-shrink-0"},yo={class:"item-card-header"},vo={class:"item-card-title"},xo=["onClick"],go=["innerHTML"],To={class:"item-card-content"},ko=["onClick"],wo=["innerHTML"],_o={class:"item-select-text"},Mo=H(defineComponent({t:"VariationsListSection",props:{itemConfig:{},globalTemplates:{},api:{},modal:{},itemTree:{}},emits:["applied"],setup(e,{expose:l,emit:d}){const p=e,b=d,m=ref(false),h=ref(null),w=ref([]),L=ref([]),C=ref(null),V=computed(()=>p.itemConfig.variations.some(e=>e.isFullset)),S=computed(()=>p.api.files);async function D(){const e=p.api.variations;if(0===e.length)return void Tt$1.info("页面没有 Variations");p.itemConfig.variations=e.map((e,t)=>{var n,o;const l=(null==(n=e.nameInput)?void 0:n.value)||"",a=l.toLowerCase().includes("fullset"),s=(null==(o=e.priceInput)?void 0:o.value)||"0";return {name:l,price:parseInt(s.replace(/\D/g,""))||0,isFullset:a,fileIds:p.api.getVariationFiles(t),fileItemMap:{}}}),p.itemConfig.variations.forEach((e,t)=>{e.fileIds&&e.fileIds.length>0&&z(t,e.fileIds);});const t=new Set;p.itemConfig.variations.forEach(e=>{e.fileIds&&e.fileIds.forEach(e=>t.add(e));});const n=new Set;p.itemConfig.variations.forEach(e=>{e.fileItemMap&&Object.keys(e.fileItemMap).forEach(t=>{e.fileItemMap[t]&&n.add(t);});});const o=[];t.forEach(e=>{n.has(e)||o.push(e);}),o.length>0?p.itemConfig.commonFiles=o:p.itemConfig.commonFiles=[];const l=[`已导入 ${e.length} 个 Variations`];o.length>0&&l.push(`检测到 ${o.length} 个通用文件`),Tt$1.success(l.join("，"));}function R(){var e;const t=S.value;if(0===t.length)return void Tt$1.info("暂无可用文件");let n=0,o=0;const l=[];for(const a of t){const t=q(a.name);if(t){const o=p.itemTree.nodes[t],l=(null==(e=null==o?void 0:o.data)?void 0:e.itemName)||(null==o?void 0:o.name)||a.name;p.itemConfig.variations.push({name:l,price:0,isFullset:false,fileIds:[a.id],fileItemMap:{[a.id]:t}}),n++;}else l.push(a.id),o++;}l.length>0&&(p.itemConfig.commonFiles||(p.itemConfig.commonFiles=[]),p.itemConfig.commonFiles=Array.from(new Set([...p.itemConfig.commonFiles,...l]))),n>0||o>0?Tt$1.success(`已创建 ${n} 个 Variations，${o} 个文件划分为通用文件`):Tt$1.info("没有可创建的 Variations");}function P(){const e=ye(p.itemConfig.pricing.normalVariationPrice,p.itemConfig.discount);p.itemConfig.variations.push({name:"",price:e,isFullset:false,useCustomPrice:false,fileIds:[],fileItemMap:{}});}function F(e){p.itemConfig.variations.splice(e,1);}function B(e,t){const[n]=p.itemConfig.variations.splice(e,1);p.itemConfig.variations.splice(t,0,n);}function N(e){const{pricing:t,discount:n}=p.itemConfig;return e.isFullset?ye(t.fullsetPrice,n):e.useCustomPrice&&void 0!==e.customPrice?ye(e.customPrice,n):ye(t.normalVariationPrice,n)}function j(e){return e.isFullset?1:e.fileItemMap?Object.keys(e.fileItemMap).filter(t=>e.fileItemMap[t]).length:0}function O(e){const t=S.value.find(t=>t.id===e);return t?t.name:"File #"+e}function A(e,t){var n;return null==(n=p.itemConfig.variations[e].fileItemMap)?void 0:n[t]}function E(e,t){const n=A(e,t);if(!n)return "";const o=p.itemTree.nodes[n];if(!o)return "未知商品";const l=o.data;return l?l.itemName:o.name}function z(e,t){const n=p.itemConfig.variations[e];n.fileItemMap||(n.fileItemMap={});for(const o of t){if(n.fileItemMap[o])continue;const e=S.value.find(e=>e.id===o);if(!e)continue;const t=q(e.name);t&&(n.fileItemMap[o]=t);}}function q(e){var t;if(!e||!p.itemTree)return null;const n=K(e);let o=null;for(const[l,a]of Object.entries(p.itemTree.nodes)){const e=a;if(!(null==(t=e.data)?void 0:t.itemName))continue;const s=G(n,K(e.data.itemName));0>=s||o&&s<=o.score||(o={itemId:l,score:s});}return o&&o.score>=.4?o.itemId:null}function K(e){return e.toLowerCase().replace(/\.(zip|rar|7z|unitypackage)$/i,"").replace(/[_\-\s]?v?\d+[\._]\d+[\._]?\d*/gi,"").replace(/[(\[（【][^)\]）】]*[)\]）】]/g,"").replace(/[\s\-_\.]/g,"").trim()}function G(e,t){if(!t||!e)return 0;if(e===t)return 1;if(e.startsWith(t))return .95;if(e.includes(t))return .9-e.indexOf(t)/e.length*.2;if(t.includes(e))return .6;const n=function(e,t){if(!e||!t)return "";const n=e.length,o=t.length;let l=0,a=0;const s=Array(o+1).fill(0);for(let i=1;n>=i;i++){let n=0;for(let r=1;o>=r;r++){const o=s[r];e[i-1]===t[r-1]?(s[r]=n+1,s[r]>l&&(l=s[r],a=i)):s[r]=0,n=o;}}return l>0?e.substring(a-l,a):""}(e,t);if(0===n.length)return 0;if(n.length>=.8*t.length)return .5+n.length/t.length*.3;const o=Math.min(t.length,e.length);return n.length/o*.5}async function J(){const e=p.itemConfig.variations,t=new Set,n=e.length-p.api.variations.length;if(n>0){const e=p.api.variations.length;for(let o=0;n>o;o++){if(!(await p.api.addVariation()))return void Tt$1.error("添加 Variation 失败");t.add(e+o);}}else if(0>n)for(let s=0;-n>s;s++)if(!(await p.api.removeVariation(p.api.variations.length-1)))return void Tt$1.error("删除 Variation 失败");await nextTick(),e.forEach((e,t)=>{p.api.updateVariation(t,{name:e.name,price:e.price.toString()});}),await nextTick(),await new Promise(e=>setTimeout(e,1e3));for(let s=0;s<e.length;s++){const n=[...e[s].fileIds||[],...p.itemConfig.commonFiles||[]];if(n.length>0){const e=await p.api.setVariationFiles(s,n,"replace");if(!e.success)return void Tt$1.error(`Variation ${s} 文件选择失败`);e.updated&&t.add(s);}}await nextTick();const o=p.api.variations.length,l=e.length;if(o>l){const e=o-l;for(let t=0;e>t;t++)await p.api.removeVariation(p.api.variations.length-1);}const a=t.size+Math.max(0,-n);a>0?Tt$1.success(`已应用 ${a} 个 Variations`):Tt$1.success("所有 Variations 已是最新"),b("applied");}return l({applyVariations:J}),(e,t)=>(openBlock(),createElementBlock(Fragment,null,[createVNode(unref(ee),{title:`Variations (${e.itemConfig.variations.length})`,"no-border":""},{actions:withCtx(()=>[createElementVNode("button",{class:"booth-btn booth-btn-sm booth-btn-ghost",type:"button",title:"从页面导入",onClick:D},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).download,14)},null,8,Jn)]),createElementVNode("button",{class:"booth-btn booth-btn-sm booth-btn-ghost",type:"button",title:"根据文件自动创建",onClick:R},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).magic,14)},null,8,Qn)]),createElementVNode("button",{class:"booth-btn booth-btn-sm booth-btn-secondary",type:"button",title:"添加",onClick:P},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).plus,14)},null,8,Wn)]),createElementVNode("button",{class:"booth-btn booth-btn-sm booth-btn-secondary",type:"button",title:"配置价格与通用文件",onClick:t[0]||(t[0]=e=>m.value=true)},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).edit,14)},null,8,Xn)]),createElementVNode("button",{class:"booth-btn booth-btn-sm booth-btn-primary",type:"button",title:"应用到页面",onClick:J},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).send,14)},null,8,Yn)])]),default:withCtx(()=>[e.itemConfig.commonFiles&&e.itemConfig.commonFiles.length>0?(openBlock(),createElementBlock("div",Zn,[createElementVNode("div",eo,[t[2]||(t[2]=createElementVNode("span",{class:"be-text-xs be-text-secondary be-font-semibold"},"通用文件:",-1)),(openBlock(true),createElementBlock(Fragment,null,renderList(e.itemConfig.commonFiles,e=>(openBlock(),createElementBlock("span",{key:e,class:"file-tag be-text-xs be-px-xs be-py-1",style:{background:"var(--be-color-bg)",border:"1px solid var(--be-color-border)","border-radius":"4px"}},toDisplayString(O(e)),1))),128))])])):createCommentVNode("",true),0===e.itemConfig.variations.length?(openBlock(),createElementBlock("div",to,' 暂无 Variations，点击"编辑价格"添加 ')):(openBlock(),createBlock(unref(fe),{key:2,items:e.itemConfig.variations,onRemove:F,onReorder:B},{actions:withCtx(({item:e,index:l})=>[createElementVNode("div",no,[withDirectives(createElementVNode("input",{"onUpdate:modelValue":t=>e.name=t,type:"text",class:"be-flex-1 be-p-xs be-px-sm be-text-base",style:{height:"28px"},placeholder:"Variation 名称"},null,8,oo),[[vModelText,e.name]]),!V.value||e.isFullset?(openBlock(),createElementBlock("label",lo,[createElementVNode("input",{type:"checkbox",checked:e.isFullset,onChange:t=>function(e,t){e.isFullset?e.isFullset=false:(p.itemConfig.variations.forEach((e,n)=>{n!==t&&e.isFullset&&(e.isFullset=false,e.fileIds||(e.fileIds=[]));}),e.isFullset=true);}(e,l)},null,40,ao),t[3]||(t[3]=createElementVNode("span",{class:"toggle-slider"},null,-1))])):createCommentVNode("",true),e.isFullset?createCommentVNode("",true):(openBlock(),createElementBlock("button",{key:1,class:"booth-btn booth-btn-ghost booth-btn-icon booth-btn-sm",type:"button",title:"选择关联文件",onClick:withModifiers(e=>async function(e){h.value=e;const t=p.itemConfig.variations[e];if(0===S.value.length)return Tt$1.error("无法获取文件列表，请先上传文件"),void(h.value=null);L.value=t.fileIds?[...t.fileIds]:[];const n=await p.modal.openModal({type:"selectFile",title:"选择文件（可多选）"});if(!(null==n?void 0:n.fileIds))return void(h.value=null);const o=n.fileIds,l=t.fileIds||[],a=o.filter(e=>!l.includes(e));t.fileIds=o,a.length>0&&z(e,a),h.value=null,L.value=[];}(l),["stop","prevent"])},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).folder,14)},null,8,io)],8,so))])]),content:withCtx(({item:e,index:l})=>[createElementVNode("div",ro,[createElementVNode("div",co,[e.isFullset?(openBlock(),createElementBlock("span",uo," ¥"+toDisplayString(N(e)),1)):(openBlock(),createElementBlock(Fragment,{key:1},[createElementVNode("span",po," ¥"+toDisplayString(N(e)),1),createElementVNode("label",bo,[withDirectives(createElementVNode("input",{type:"checkbox","onUpdate:modelValue":t=>e.useCustomPrice=t},null,8,mo),[[vModelCheckbox,e.useCustomPrice]]),t[4]||(t[4]=createElementVNode("span",{class:"toggle-slider"},null,-1))]),e.useCustomPrice?withDirectives((openBlock(),createElementBlock("input",{key:0,"onUpdate:modelValue":t=>e.customPrice=t,type:"number",class:"be-flex-1 be-p-xs be-px-sm be-text-base",style:{height:"28px","min-width":"80px"},min:"0",placeholder:"价格"},null,8,fo)),[[vModelText,e.customPrice,void 0,{number:true}]]):createCommentVNode("",true),createElementVNode("span",ho," 支持数: "+toDisplayString(j(e)),1)],64))]),!e.isFullset&&e.fileIds&&e.fileIds.length>0?(openBlock(),createElementBlock("div",{key:0,class:normalizeClass(["item-cards-grid",{"single-item":1===e.fileIds.length}])},[(openBlock(true),createElementBlock(Fragment,null,renderList(e.fileIds,e=>(openBlock(),createElementBlock("div",{key:e,class:"item-card"},[createElementVNode("div",yo,[createElementVNode("span",vo,toDisplayString(O(e)),1),createElementVNode("button",{class:"item-card-delete-btn",type:"button",title:"取消关联",onClick:t=>function(e,t){const n=p.itemConfig.variations[e];n.fileIds&&(n.fileIds=n.fileIds.filter(e=>e!==t)),n.fileItemMap&&delete n.fileItemMap[t];}(l,e)},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).close,12)},null,8,go)],8,xo)]),createElementVNode("div",To,[createElementVNode("button",{class:normalizeClass(["item-select-btn",{"has-item":A(l,e)}]),type:"button",onClick:t=>async function(e,t){var n;const o=p.itemConfig.variations[e],l=null==(n=o.fileItemMap)?void 0:n[t];w.value=l?[l]:[],C.value={variationIndex:e,fileId:t};const a=await p.modal.openModal({type:"selectItem",title:`为 ${O(t)} 选择商品（单选）`});if(null==a?void 0:a.itemIds){o.fileItemMap||(o.fileItemMap={});const e=a.itemIds;0===e.length?delete o.fileItemMap[t]:o.fileItemMap[t]=e[0];}C.value=null,w.value=[];}(l,e)},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).file,12)},null,8,wo),createElementVNode("span",_o,toDisplayString(A(l,e)?E(l,e):"选择商品"),1)],10,ko)])]))),128))],2)):createCommentVNode("",true)])]),o:1},8,["items"]))]),o:1},8,["title"]),createVNode(Gn,{show:m.value,"item-config":e.itemConfig,"global-templates":e.globalTemplates,"available-files":S.value,onClose:t[1]||(t[1]=e=>m.value=false)},null,8,["show","item-config","global-templates","available-files"])],64))}}),[["__scopeId","data-v-526d6f5f"]]),Ho=["innerHTML"],Lo={key:0},Co={class:"form-group"},Vo={class:"form-group"},Uo={key:1,class:"be-flex be-flex-column be-gap-sm"},Io={class:"form-group"},So=["innerHTML"],Do=["disabled"],Ro=["innerHTML"],$o=["innerHTML"],Po={key:0,class:"empty-state"},Fo=["innerHTML"],Bo={key:1,class:"empty-state"},No=["innerHTML"],jo=["innerHTML"],Oo={key:2,class:"edit-tab"},Ao={class:"edit-tab-scrollable"},Eo={key:0,class:"be-flex be-flex-column be-gap-sm"},zo={class:"be-text-base be-font-bold be-text-primary"},qo={class:"be-text-base be-text-secondary be-whitespace-pre-wrap be-break-words be-m-0"},Ko={class:"be-flex be-flex-column be-gap-sm"},Go={class:"form-hint be-text-xs be-text-secondary"},Jo={key:0,class:"item-select-list",style:{display:"grid","grid-template-columns":"repeat(2, 1fr)",gap:"8px"}},Qo=["onClick"],Wo={class:"be-flex be-flex-column",style:{gap:"2px"}},Xo={class:"be-text-sm be-font-medium"},Yo={class:"be-text-xs be-text-secondary"},Zo={key:1,class:"empty-hint"},el=["innerHTML"],tl=["innerHTML"],nl={class:"be-flex be-flex-column be-gap-sm"},ol={class:"form-hint be-text-xs be-text-secondary"},ll=["innerHTML"],al=["innerHTML"],sl=exports("default", H(defineComponent({t:"EditTab",props:{api:{}},setup(e,{expose:i}){const{data:p}=Ct$1(),b=t(),x=computed(()=>b.state.value),_=computed(()=>{var e;const t=x.value;return "alert"===t.type&&void 0!==(null==(e=t.formData)?void 0:e.sectionIndex)}),M=computed(()=>{var e;return null==(e=x.value.formData)?void 0:e.sectionIndex}),H=ref(false),V=computed(()=>{const e=window.location.pathname.match(/\/items\/(\d+)\/edit/);return e?e[1]:null}),P=computed(()=>V.value&&p.value.itemConfigs[V.value]||null),N=computed(()=>null!==P.value),j=computed(()=>p.value.globalTemplates),O=computed(()=>P.value?Te(P.value.variations):0),A=computed(()=>{const e=P.value;if(!e)return {itemName:"",supportCount:0};const t=e.variations.filter(e=>!e.isFullset),n=t[0],o=O.value,l=e.itemTypeName||"Item",a=(null==n?void 0:n.fileItemMap)?Object.values(n.fileItemMap)[0]:null,s=(null==n?void 0:n.name)||a&&(e=>{const t=p.value.itemTree.nodes[e];if(!t)return "未知商品";const n=t.data;return n?n.itemName:t.name})(a)||e.itemName,i=t.length>1||o>1?`${o} ${ke(l,o)}`:s;return {itemName:e.itemName||"",supportCount:o,itemTypeName:l,itemTypePlural:ke(l,o),variationCount:t.length,firstName:s,smartTitle:i,discountIndicator:e.discount.enabled?"[SALE] ":""}}),z=computed(()=>{if(!P.value)return [];const e={variations:P.value.variations,itemTree:p.value.itemTree};return P.value.sections.map(t=>{const n=_e(t,j.value,e);return {headline:xe(n.headline,A.value),body:xe(n.body,A.value)}})}),q=computed(()=>{var e;if(!P.value)return "";const t=[],n=xe(wt$1(j.value,P.value),A.value);n&&t.push(n);const o="editDescription"===x.value.type?null==(e=x.value.formData)?void 0:e.customDescription:P.value.customDescription;if(o&&t.push(o),P.value.discount.enabled){const e=P.value.pricing.normalVariationPrice,n=ye(e,P.value.discount),o=P.value.pricing.fullsetPrice,l=ye(o,P.value.discount),a=e=>{if(!e)return "";const t=new Date(e);return `${(t.getMonth()+1+"").padStart(2,"0")}/${(t.getDate()+"").padStart(2,"0")} ${(t.getHours()+"").padStart(2,"0")}:${(t.getMinutes()+"").padStart(2,"0")}`},s=xe(xt$1(j.value,P.value),{...A.value,originalPrice:e,discountedPrice:n,discountPercent:P.value.discount.discountPercent,fullsetOriginalPrice:o,fullsetDiscountedPrice:l,startDate:a(P.value.discount.startDate),endDate:a(P.value.discount.endDate)});t.push(s);}return t.join("\n\n")});async function K(){var e;const t=await b.openModal({type:"createItem",title:"创建商品配置",formData:{itemName:"",itemType:"adaptation"}});if((null==(e=null==t?void 0:t.itemName)?void 0:e.trim())&&V.value){const e=gt$1(V.value);e.itemName=t.itemName.trim(),e.itemType=t.itemType,p.value.itemConfigs[V.value]=e,Tt$1.success("已创建商品配置");}}function G(e){V.value&&(p.value.itemConfigs[V.value].customDescription=e);}const J=ref([]),W=ref([]);function X(e){return J.value.includes(e)}watch(()=>P.value?{pricing:P.value.pricing,discount:P.value.discount}:null,()=>{var e,t,n;P.value&&(e=P.value.variations,t=P.value.pricing,n=P.value.discount,e.forEach(e=>{const o=e.isFullset?t.fullsetPrice:t.normalVariationPrice;e.price=ye(o,n);}));},{deep:true}),onMounted(()=>{V.value||Tt$1.error("无法获取商品 ID");});const Y=ref(null),Z=ref(null),ee=ref(null),te=ref(null),ne=ref(null);return i({applyAll:async function(){var e,t,n,o,l;if(P.value)try{await(null==(e=Y.value)?void 0:e.applyName()),await(null==(t=Z.value)?void 0:t.applyDescription()),await(null==(n=ee.value)?void 0:n.applySections()),await(null==(o=te.value)?void 0:o.applyTags()),await(null==(l=ne.value)?void 0:l.applyVariations()),Tt$1.success("所有配置应用完成");}catch(a){Tt$1.error("应用配置失败");}else Tt$1.error("没有配置数据");}}),(e,t)=>(openBlock(),createElementBlock(Fragment,null,[createVNode(unref(nt$1),{show:x.value.show&&!_.value,title:x.value.title,"teleport-to":".booth-enhancer-sidebar",width:"500px",onClose:unref(b).closeModal},{"header-actions":withCtx(()=>["editDescription"===x.value.type?(openBlock(),createElementBlock("button",{key:0,class:"booth-btn booth-btn-ghost booth-btn-icon booth-btn-sm",type:"button",title:"模板配置",onClick:t[0]||(t[0]=e=>H.value=true)},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).settings,18)},null,8,Ho)])):createCommentVNode("",true)]),footer:withCtx(()=>{var e;return [createElementVNode("button",{class:"booth-btn booth-btn-md booth-btn-icon booth-btn-secondary",type:"button",title:"取消",onClick:t[5]||(t[5]=(...e)=>unref(b).closeModal&&unref(b).closeModal(...e))},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).close,18)},null,8,So)]),"createItem"===x.value.type?(openBlock(),createElementBlock("button",{key:0,class:"booth-btn booth-btn-md booth-btn-icon booth-btn-primary",type:"button",title:"创建配置",disabled:!(null==(e=x.value.formData.itemName)?void 0:e.trim()),onClick:t[6]||(t[6]=e=>unref(b).confirmModal(x.value.formData))},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).check,18)},null,8,Ro)],8,Do)):"editDescription"===x.value.type?(openBlock(),createElementBlock("button",{key:1,class:"booth-btn booth-btn-md booth-btn-icon booth-btn-primary",type:"button",title:"保存",onClick:t[7]||(t[7]=e=>unref(b).confirmModal(x.value.formData))},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).check,18)},null,8,$o)])):createCommentVNode("",true)]}),default:withCtx(()=>["createItem"===x.value.type?(openBlock(),createElementBlock("div",Lo,[t[17]||(t[17]=createElementVNode("p",{class:"hint-text"}," 为当前商品创建编辑配置，配置后可以管理商品名称、描述、Sections 和 Variations。 ",-1)),createElementVNode("div",Co,[t[14]||(t[14]=createElementVNode("label",null,[createTextVNode("商品名称 "),createElementVNode("span",{class:"required"},"*")],-1)),withDirectives(createElementVNode("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>x.value.formData.itemName=e),type:"text",placeholder:"输入商品名称",onKeyup:t[2]||(t[2]=withKeys(e=>unref(b).confirmModal(x.value.formData),["enter"]))},null,544),[[vModelText,x.value.formData.itemName]])]),createElementVNode("div",Vo,[t[16]||(t[16]=createElementVNode("label",null,"商品类型",-1)),withDirectives(createElementVNode("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>x.value.formData.itemType=e)},t[15]||(t[15]=[createElementVNode("option",{value:"normal"},"普通商品",-1),createElementVNode("option",{value:"adaptation"},"适配商品",-1)]),512),[[vModelSelect,x.value.formData.itemType]])])])):"editDescription"===x.value.type?(openBlock(),createElementBlock("div",Uo,[createElementVNode("div",Io,[t[18]||(t[18]=createElementVNode("label",null,"自定义描述 (此商品专属)",-1)),withDirectives(createElementVNode("textarea",{"onUpdate:modelValue":t[4]||(t[4]=e=>x.value.formData.customDescription=e),rows:"8",placeholder:"输入此商品的特殊说明..."},null,512),[[vModelText,x.value.formData.customDescription]])]),createVNode(unref(Q),{label:"最终描述预览",type:"pre"},{default:withCtx(()=>[createTextVNode(toDisplayString(q.value),1)]),o:1})])):createCommentVNode("",true)]),o:1},8,["show","title","onClose"]),V.value?N.value?P.value?(openBlock(),createElementBlock("div",Oo,[createElementVNode("div",Ao,[createVNode(st,{ref_key:"itemNameSectionRef",ref:Y,"item-config":P.value,"global-templates":j.value,"template-vars":A.value,api:e.api,"total-support":O.value},null,8,["item-config","global-templates","template-vars","api","total-support"]),createVNode(Pe,{ref_key:"itemDescriptionSectionRef",ref:Z,"item-config":P.value,"global-templates":j.value,"template-vars":A.value,api:e.api,modal:unref(b),"current-item-id":V.value,"on-description-updated":G},null,8,["item-config","global-templates","template-vars","api","modal","current-item-id"]),createVNode(fn,{ref_key:"sectionsListSectionRef",ref:ee,"item-config":P.value,"global-templates":j.value,"template-vars":A.value,api:e.api,modal:unref(b),"item-tree":unref(p).itemTree},null,8,["item-config","global-templates","template-vars","api","modal","item-tree"]),createVNode(xn,{ref_key:"tagsSectionRef",ref:te,"item-config":P.value,api:e.api,"item-tree":unref(p).itemTree,"tag-tree":unref(p).tagTree},null,8,["item-config","api","item-tree","tag-tree"]),createVNode(Mo,{ref_key:"variationsListSectionRef",ref:ne,"item-config":P.value,"global-templates":j.value,api:e.api,modal:unref(b),"item-tree":unref(p).itemTree},null,8,["item-config","global-templates","api","modal","item-tree"])]),createVNode(unref(nt$1),{show:x.value.show&&_.value,title:x.value.title,width:"500px","teleport-to":".booth-enhancer-sidebar",onClose:unref(b).closeModal},{default:withCtx(()=>[void 0!==M.value&&z.value[M.value]?(openBlock(),createElementBlock("div",Eo,[createElementVNode("div",zo,toDisplayString(z.value[M.value].headline),1),createElementVNode("pre",qo,toDisplayString(z.value[M.value].body),1)])):createCommentVNode("",true)]),o:1},8,["show","title","onClose"]),createVNode(unref(nt$1),{show:x.value.show&&"selectItem"===x.value.type,title:x.value.title,width:"500px","teleport-to":".booth-enhancer-sidebar",onClose:unref(b).closeModal},{footer:withCtx(()=>[createElementVNode("button",{class:"booth-btn booth-btn-md booth-btn-icon booth-btn-secondary",type:"button",title:"取消",onClick:t[8]||(t[8]=(...e)=>unref(b).closeModal&&unref(b).closeModal(...e))},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).close,18)},null,8,el)]),createElementVNode("button",{class:"booth-btn booth-btn-md booth-btn-icon booth-btn-primary",type:"button",title:"确认",onClick:t[9]||(t[9]=e=>unref(b).confirmModal({itemIds:J.value}))},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).check,18)},null,8,tl)])]),default:withCtx(()=>[createElementVNode("div",Ko,[createElementVNode("p",Go," 点击选择/取消商品关联（已选择: "+toDisplayString(J.value.length)+"） ",1),Object.keys(unref(p).itemTree.nodes).filter(e=>unref(p).itemTree.nodes[e].data).length>0?(openBlock(),createElementBlock("div",Jo,[(openBlock(true),createElementBlock(Fragment,null,renderList(Object.keys(unref(p).itemTree.nodes).filter(e=>unref(p).itemTree.nodes[e].data),e=>{var t,a;return openBlock(),createElementBlock("button",{key:e,class:"item-select-btn booth-btn booth-btn-sm booth-btn-ghost be-text-left",type:"button",style:normalizeStyle({padding:"6px 8px",backgroundColor:X(e)?"rgba(59, 130, 246, 0.1)":void 0,borderColor:X(e)?"rgba(59, 130, 246, 0.3)":void 0}),onClick:t=>function(e){const t=J.value.indexOf(e);t>-1?J.value.splice(t,1):J.value.push(e);}(e)},[createElementVNode("div",Wo,[createElementVNode("span",Xo,toDisplayString((null==(t=unref(p).itemTree.nodes[e].data)?void 0:t.itemName)||unref(p).itemTree.nodes[e].name),1),createElementVNode("span",Yo,toDisplayString(null==(a=unref(p).itemTree.nodes[e].data)?void 0:a.authorName),1)])],12,Qo)}),128))])):(openBlock(),createElementBlock("div",Zo," 暂无商品数据，请先在 ItemTab 中添加 "))])]),o:1},8,["show","title","onClose"]),createVNode(unref(nt$1),{show:x.value.show&&"selectFile"===x.value.type,title:x.value.title,width:"500px","teleport-to":".booth-enhancer-sidebar",onClose:unref(b).closeModal},{footer:withCtx(()=>[createElementVNode("button",{class:"booth-btn booth-btn-md booth-btn-icon booth-btn-secondary",type:"button",title:"取消",onClick:t[11]||(t[11]=(...e)=>unref(b).closeModal&&unref(b).closeModal(...e))},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).close,18)},null,8,ll)]),createElementVNode("button",{class:"booth-btn booth-btn-md booth-btn-icon booth-btn-primary",type:"button",title:"确认",onClick:t[12]||(t[12]=e=>unref(b).confirmModal({fileIds:W.value}))},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).check,18)},null,8,al)])]),default:withCtx(()=>[createElementVNode("div",nl,[createElementVNode("p",ol," 点击选择文件（可多选，已选择: "+toDisplayString(W.value.length)+"） ",1),createVNode(unref(E),{files:e.api.files,"selected-file-ids":W.value,"onUpdate:selectedFileIds":t[10]||(t[10]=e=>W.value=e)},null,8,["files","selected-file-ids"])])]),o:1},8,["show","title","onClose"]),createVNode(De,{show:H.value,"global-templates":j.value,onClose:t[13]||(t[13]=e=>H.value=false)},null,8,["show","global-templates"])])):createCommentVNode("",true):(openBlock(),createElementBlock("div",Bo,[createElementVNode("div",{class:"empty-icon",innerHTML:unref(G$1)(unref(U).file,64)},null,8,No),t[22]||(t[22]=createElementVNode("div",{class:"be-text-lg be-font-bold"},"未配置此商品",-1)),t[23]||(t[23]=createElementVNode("p",null,"为当前商品创建编辑配置，开始管理商品信息",-1)),createElementVNode("button",{class:"booth-btn booth-btn-lg booth-btn-primary",onClick:K},[createElementVNode("span",{innerHTML:unref(G$1)(unref(U).plus,16)},null,8,jo),t[21]||(t[21]=createTextVNode(" 创建商品配置 ",-1))])])):(openBlock(),createElementBlock("div",Po,[createElementVNode("div",{class:"empty-icon",innerHTML:unref(G$1)(unref(U).alertCircle,48)},null,8,Fo),t[19]||(t[19]=createElementVNode("div",{class:"be-text-lg be-font-bold"},"无法获取商品 ID",-1)),t[20]||(t[20]=createElementVNode("p",null,"请确保在商品编辑页面使用此功能",-1))]))],64))}}),[["__scopeId","data-v-d8a8cfef"]]));

		})
	};
}));

System.register("./useModal-CEDTPuIh-FnhElVKI.js", ['vue'], (function (exports, module) {
	'use strict';
	var ref;
	return {
		setters: [module => {
			ref = module.ref;
		}],
		execute: (function () {

			exports("t", t);

			function t(){const t=ref({show:false,type:"",title:"",message:"",inputValue:"",placeholder:"",targetId:"",formData:{}});let l=null;const o=e=>(t.value={show:true,type:e.type,title:e.title,message:e.message||"",inputValue:e.defaultValue||"",placeholder:e.placeholder||"",targetId:e.targetId||"",formData:e.formData||{}},new Promise(e=>{l=e;}));return {state:t,openModal:o,closeModal:()=>{t.value.show=false,l&&(l(void 0),l=null);},confirmModal:e=>{t.value.show=false,l&&(l(void 0!==e?e:t.value.inputValue),l=null);},confirm:(e,t)=>o({type:"delete",title:e,defaultValue:t||""}).then(e=>!!e)}}

		})
	};
}));

System.import("./__entry.js", "./");